<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ë°œí–‰-êµ¬ë… íŒ¨í„´ on Mario Blog</title><link>https://codemario318.github.io/tags/%EB%B0%9C%ED%96%89-%EA%B5%AC%EB%8F%85-%ED%8C%A8%ED%84%B4/</link><description>Recent content in ë°œí–‰-êµ¬ë… íŒ¨í„´ on Mario Blog</description><generator>Hugo -- gohugo.io</generator><language>ko</language><lastBuildDate>Tue, 04 Feb 2025 10:02:35 +0900</lastBuildDate><atom:link href="https://codemario318.github.io/tags/%EB%B0%9C%ED%96%89-%EA%B5%AC%EB%8F%85-%ED%8C%A8%ED%84%B4/index.xml" rel="self" type="application/rss+xml"/><item><title>3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°</title><link>https://codemario318.github.io/post/node/pub-sub/3/</link><pubDate>Tue, 04 Feb 2025 10:02:35 +0900</pubDate><guid>https://codemario318.github.io/post/node/pub-sub/3/</guid><description>&lt;img src="https://codemario318.github.io/post/node/pub-sub/3/cover.png" alt="Featured image of post 3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°" />&lt;p>&lt;a class="link" href="https://codemario318.github.io/post/node/pub-sub/2/" >ì´ì „ ê¸€&lt;/a>ì—ì„œ ë°œí–‰-êµ¬ë… íŒ¨í„´ì˜ ì±„ë„ì— ëŒ€í•œ ì˜¤í•´ë¥¼ ë°”ë¡œ ì¡ê³  ì´ë¥¼ ê°œì„ í•´ë´¤ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ ê³¼ì •ì„ í†µí•´ íŠ¹ì • ê´€ì‹¬ì‚¬ì¸ ì±„ë„ì„ êµ¬ë…í•˜ê²Œë˜ì–´ ì´ì „ ë³´ë‹¤ ë” ëŠìŠ¨í•œ ê²°í•©ì„ ë‹¬ì„±í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”&lt;/p>
&lt;p>ì´ì™€ ë°˜ëŒ€ë¡œ &lt;code>Broker&lt;/code>ì—ì„œ ë°œí–‰ìë¥¼ ê´€ë¦¬í•˜ì§€ ì•Šê²Œ ë˜ì–´ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œë“¤ì´ ì˜ˆìƒë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ë°œí–‰ìê°€ ë” ì´ìƒ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ì§€ ì•Šì•„ë„ ì±„ë„ì´ ìœ ì§€ë¨&lt;/li>
&lt;li>êµ¬ë…ìê°€ ì—†ì–´ë„ ì±„ë„ì´ í•­ìƒ ìœ ì§€ë¨&lt;/li>
&lt;/ul>
&lt;p>ë°œí–‰ìê°€ ë” ì´ìƒ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ì§€ ì•ŠëŠ” ìƒíƒœì— ëŒ€í•œ ì²˜ë¦¬ëŠ” í™œìš©í•˜ëŠ” êµ¬í˜„ì—ì„œ ê´€ë¦¬í•´ì•¼í•˜ëŠ” ë¬¸ì œì´ì§€ë§Œ, êµ¬ë…ìê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ì±„ë„ì´ ìœ ì§€ë˜ëŠ” ê²ƒì€ ë©”ëª¨ë¦¬ë¥¼ ë‚­ë¹„ í•  ì—¬ì§€ê°€ ìˆì–´ë³´ì´ì£ ?&lt;/p>
&lt;p>ê·¸ë˜ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” ë” ì´ìƒ êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì— ëŒ€í•œ ì •ë¦¬ë¥¼ ì¶”ê°€í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ì–´ë–¤-ë°©ë²•ë“¤ì´-ìˆì„ê¹Œ">ì–´ë–¤ ë°©ë²•ë“¤ì´ ìˆì„ê¹Œ?&lt;/h2>
&lt;p>ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ê°œì„ í•˜ê¸°ìœ„í•´ 2ê°€ì§€ ë°©ë²• ì •ë„ê°€ ë– ì˜¬ëìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>êµ¬ë… í•´ì œí•  ë•Œ, ë” ì´ìƒ êµ¬ë…ìê°€ ì—†ë‹¤ë©´ ì •ë¦¬&lt;/li>
&lt;li>ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì„ ì •ë¦¬&lt;/li>
&lt;/ul>
&lt;p>ì¥ë‹¨ì ì„ ì‚´í´ë³¼ê¹Œìš”?&lt;/p>
&lt;hr>
&lt;p>&lt;strong>êµ¬ë… í•´ì œí•  ë•Œ, ë” ì´ìƒ êµ¬ë…ìê°€ ì—†ë‹¤ë©´ ì •ë¦¬&lt;/strong>&lt;/p>
&lt;p>ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ êµ¬ë…ìê°€ í•´ë‹¹ ì±„ë„ì„ êµ¬ë… í•´ì œí•  ë•Œ, í˜„ì¬ ë‚¨ì•„ìˆëŠ” êµ¬ë…ìê°€ ìì‹  ë¿ì´ë¼ë©´ ì±„ë„ì„ ì •ë¦¬í•˜ëŠ” ë°©ì‹ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>í™œìš©í•˜ê³  ìˆëŠ” Node.jsëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ëŠ” íŠ¹ì„±ìœ¼ë¡œ ì¸í•´, êµ¬ë…ì ëª©ë¡ì„ ì €ì¥í•˜ëŠ” &lt;code>Map&lt;/code> ì¸ìŠ¤í„´ìŠ¤ì— ì—¬ëŸ¬ ì²˜ë¦¬ê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ ìì²´ì— ì ‘ê·¼í•˜ëŠ” ë™ì‹œì„± ë¬¸ì œë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ êµ¬í˜„ì´ ì‰½ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë‹¤ë§Œ, ê°ê°ì˜ êµ¬ë…ìì˜ êµ¬ë… í•´ì œ ì²˜ë¦¬ì—ì„œ êµ¬ë…í–ˆë˜ ì±„ë„ì˜ êµ¬ë…ì ëª©ë¡ì„ ê³„ì†í•´ì„œ í™•ì¸í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œê°€ ì¡°ê¸ˆ ë§ì•„ì§€ê³ , ë©”ì„œë“œê°€ ë§ì€ ì—­í• ì„ ë‹´ë‹¹í•˜ê²Œ ë˜ê² ë„¤ìš”&lt;/p>
&lt;p>ê·¸ë¦¬ê³ , êµ¬ë…ì ëª©ë¡ì„ ì •ë¦¬í•œ ì§í›„ì— êµ¬ë… ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ êµ¬ë…ì ëª©ë¡ì„ ë‹¤ì‹œ í• ë‹¹í•´ì¤˜ì•¼í•©ë‹ˆë‹¤. (ì–´ì©”ìˆ˜ ì—†ì–´ ë³´ì´ê¸´ í•˜ë„¤ìš” ğŸ˜‚)&lt;/p>
&lt;hr>
&lt;p>&lt;strong>ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì„ ì •ë¦¬&lt;/strong>&lt;/p>
&lt;p>ì¡°ê¸ˆ ë” ë³µì¡í•˜ê²Œ ì²˜ë¦¬í•˜ë ¤ë©´, &lt;code>Timmer&lt;/code> APIë¥¼ ì´ìš©í•˜ì—¬ ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ëŠ” ë°©ë²•ë„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>êµ¬ë…ì ëª©ë¡ì„ ì €ì¥í•˜ëŠ” &lt;code>Map&lt;/code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³„ë„ë¡œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— êµ¬ë… í•´ì œ ì²˜ë¦¬ì—ì„œ ì±„ë„ì„ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•˜ì§€ ì•Šê²Œë˜ì–´ êµ¬ë… í•´ì œ í•œê°€ì§€ ì¼ë§Œ í•˜ê²Œë©ë‹ˆë‹¤.&lt;/p>
&lt;p>í•˜ì§€ë§Œ, ì±„ë„ ì •ë¦¬ ì£¼ê¸°ê°€ ë„ˆë¬´ ì§§ë‹¤ë©´ ì˜¤ë²„í—¤ë“œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê³ , ë„ˆë¬´ ê¸¸ë‹¤ë©´ ì •ë¦¬í•˜ëŠ” ì´ë“ì„ ë³´ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ ì§ì ‘ ì£¼ê¸°ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>ë‹¤ë¥¸ ì¢‹ì€ ë°©ë²•ë“¤ë„ ìˆê² ì§€ë§Œ, ë‹¹ì¥ì€ ë– ì˜¤ë¥´ì§€ ì•Šë„¤ìš” ğŸ¤£&lt;/p>
&lt;p>ì €ëŠ” ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ ëª¨ë‘ë¥¼ ê³ ë ¤í•´ë³´ê² ìŠµë‹ˆë‹¤. êµ¬ë…ì ëª©ë¡ ê´€ë¦¬ë¥¼ ë³„ë„ë¡œ ë¶„ë¦¬í•˜ì—¬ ë…ë¦½ì ìœ¼ë¡œ ê°œì„  ê°€ëŠ¥í•œ í˜•íƒœë¡œ êµ¬ì„±í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ë”-ê³ ë¯¼í•´ì•¼í• -ë¶€ë¶„ì€">ë” ê³ ë¯¼í•´ì•¼í•  ë¶€ë¶„ì€?&lt;/h2>
&lt;p>ë‹¨ìˆœíˆ ì¼ì • ì‹œê°„ì„ ì£¼ê¸°ë¡œ ì±„ë„ì„ ì •ë¦¬í•œë‹¤ê³  í•´ë„, ìœ„ì—ì„œ ì‚´ì§ ì–¸ê¸‰í–ˆë˜ ë‚´ìš© ì²˜ëŸ¼ ê¸ˆë°© ì •ë¦¬ëœ ì±„ë„ì— ë‹¤ì‹œ êµ¬ë…ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ &lt;strong>ì‹œê°„ ì§€ì—­ì„±&lt;/strong>(Temporal Locality)ì„ ê³ ë ¤í•˜ì—¬ ì²˜ë¦¬í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>ì‹œê°„ ì§€ì—­ì„±(Temporal Locality)?&lt;/strong>&lt;br>
&amp;ldquo;ìµœê·¼ì— ì ‘ê·¼í•œ ë°ì´í„°ë‚˜ ì½”ë“œëŠ” ê°€ê¹Œìš´ ë¯¸ë˜ì— ë‹¤ì‹œ ì ‘ê·¼ë  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.&amp;ldquo;ëŠ” í”„ë¡œê·¸ë¨ì˜ íŠ¹ì„±&lt;/p>
&lt;/blockquote>
&lt;p>ì‹œê°„ ì§€ì—­ì„±ì€ ìºì‹œ, RDBMSì˜ ë²„í¼í’€, OSì˜ í˜ì´ì§€ êµì²´ ì•Œê³ ë¦¬ì¦˜ ë“±ì— í™œìš©ë˜ê³  ìˆëŠ”ë°, ì´ë¥¼ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ í•´ì„í•˜ë©´ ë©”ì‹œì§€ê°€ ë°œí–‰ëœ ì‹œê°„ì´ ì˜¤ë˜ë˜ì—ˆë‹¤ë©´ ì•ìœ¼ë¡œë„ í™œìš©í•˜ì§€ ì•ŠëŠ” ì±„ë„ì´ë¼ëŠ” ê°€ì„¤ì„ ì„¸ìš¸ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?&lt;/p>
&lt;p>ê·¸ë˜ì„œ ì €ëŠ” êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì˜ ë§ˆì§€ë§‰ìœ¼ë¡œ ë©”ì‹œì§€ê°€ ë°œí–‰ëœ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬ë  ìˆ˜ ìˆë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ì œê°€ êµ¬í˜„í•œ pub/subì€ ì¼ë°˜ì ì¸ í™œìš©ì„ ê°€ì •í•˜ê³  ë§Œë“  ëª¨ë“ˆì´ë¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì˜ íŠ¹ì„±ë§ˆë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— í° ì´ë“ì´ ì—†ì„ ìˆ˜ë„ ìˆê³ , ì˜¤íˆë ¤ ì˜¤ë²„í—¤ë“œê°€ ë  ìˆ˜ ìˆì„ ì—¬ì§€ë„ ìˆê² ì§€ë§Œìš” ğŸ¤£&lt;/li>
&lt;/ul>
&lt;h2 id="ì „ì²´-ì•„í‚¤í…ì²˜">ì „ì²´ ì•„í‚¤í…ì²˜&lt;/h2>
&lt;p>ì•ì„œ ë§ì”€ë“œë ¸ë˜ ê²ƒ ì²˜ëŸ¼ ì¼ì • ì£¼ê¸°ë¡œ ì •í•´ì§„ ê¸°ê°„ë™ì•ˆ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì±„ë„ì„ ì •ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì˜ êµ¬í˜„í•˜ë ¤ê³  í•˜ë‹¤ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ë§ì€ ë³€ê²½ì´ ìˆì—ˆë„¤ìš”&lt;/p>
&lt;p>ì¼ë‹¨ ë³€ê²½ëœ ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ë¨¼ì € ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
class MessageBroker~TMessage~ {
-repository: ChannelRepository
-scheduler: Scheduler
-tasks: ScheduledTask[]
+subscribe(topic: string, handler: MessageHandler)
+publish(topic: string, message: TMessage)
}
class ChannelRepository~TMessage~ {
&lt;&lt; interface >>
+findChannelByTopic(topic: string)
+findAllChannels()
+deleteChannelByTopic(topic: string)
}
class Cleanable {
&lt;&lt; interface >>
+topic: string
+lastUpdatedAt: Date
+subscriberLength: number
}
class Subjection~TMessage~ {
&lt;&lt; interface >>
+publish(message: TMessage)
+subscribe(handler: MessageHandler)
}
class ScheduledTask {
&lt;&lt; interface >>
+name: string
+interval: number
+execute()
}
class CleanableChannelRepository {
&lt;&lt; interface >>
+findAllChannels()
+deleteChannelByTopic(topic: string)
}
class Channel~TMessage~ {
-subscriptions: Subscription[]
+topic: string
+lastUpdatedAt: Date
+subscriberLength: number
+publish(message: TMessage)
+subscribe(handler: MessageHandler)
-unsubscribe(subscriptionId: string)
}
class MemoryChannelRepository~TMessage~ {
-channels: Map
+findChannelByTopic(topic: string)
+findAllChannels()
+deleteChannelByTopic(topic: string)
}
class ChannelCleaner {
+name: string
+interval: number
-staleThreshold: number
+execute()
-cleanupChannel(channel: Cleanable)
-isExpiredChannel(channel: Cleanable)
}
class Scheduler {
-timers: Map
-runningTasks: Set
-tasks: ScheduledTask[]
+registerTask(task: ScheduledTask)
+unregisterTask(taskName: string)
+start(taskName: string)
+startAll()
+stop(taskName: string)
+stopAll()
-executeTask(task: ScheduledTask)
}
MessageBroker --> ChannelRepository : uses
MessageBroker --> Scheduler : uses
MessageBroker --> ChannelCleaner : uses
MemoryChannelRepository ..|> ChannelRepository : implements
Channel ..|> Cleanable : implements
Channel ..|> Subjection : implements
ChannelCleaner ..|> ScheduledTask : implements
MemoryChannelRepository --> Channel : manages
ChannelCleaner --> CleanableChannelRepository : uses
&lt;/pre>
&lt;p>ì¶”ê°€ëœ ìš”ì†Œë“¤ì´ ë§ë‹¤ë³´ë‹ˆ í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì´ ë„ˆë¬´ ì‘ê²Œ ë³´ì´ë„¤ìš” ğŸ˜‚ í° ë³€ê²½ ì‚¬í•­ë“¤ì„ í†µí•´ ì–´ë– í•œ ë³€í™”ë“¤ì´ ìˆëŠ”ì§€ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="channelê³¼-repository">Channelê³¼ Repository&lt;/h2>
&lt;p>ì¤‘ìš”í•œ ë³€ê²½ì‚¬í•­ìœ¼ë¡œ &lt;code>Channel&lt;/code>ì„ ë„ë©”ì¸ìœ¼ë¡œ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
class MessageBroker~TMessage~ {
-repository: ChannelRepository
-scheduler: Scheduler
-tasks: ScheduledTask[]
+subscribe(topic: string, handler: MessageHandler)
+publish(topic: string, message: TMessage)
}
class ChannelRepository~TMessage~ {
&lt;&lt; interface >>
+findChannelByTopic(topic: string)
+findAllChannels()
+deleteChannelByTopic(topic: string)
}
class Subjection~TMessage~ {
&lt;&lt; interface >>
+publish(message: TMessage)
+subscribe(handler: MessageHandler)
}
class Channel~TMessage~ {
-subscriptions: Subscription[]
+topic: string
+lastUpdatedAt: Date
+subscriberLength: number
+publish(message: TMessage)
+subscribe(handler: MessageHandler)
-unsubscribe(subscriptionId: string)
}
class MemoryChannelRepository~TMessage~ {
-channels: Map
+findChannelByTopic(topic: string)
+findAllChannels()
+deleteChannelByTopic(topic: string)
}
MessageBroker --> ChannelRepository : uses
MemoryChannelRepository ..|> ChannelRepository : implements
Channel ..|> Subjection : implements
MemoryChannelRepository --> Channel : manages
&lt;/pre>
&lt;p>ì´ì „ì˜ &lt;code>MessageBroker&lt;/code>ëŠ” &lt;code>subscribe&lt;/code>ì™€ &lt;code>publish&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ ì„¤ì •í•œ &lt;code>Broker&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜€ëŠ”ë°ìš”&lt;/p>
&lt;p>&lt;code>MessageBroker&lt;/code> ì—­ì‹œ êµ¬ë…ê³¼ ë°œí–‰ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ì‹¤ì œ êµ¬ë…/ë°œí–‰ì˜ ì£¼ì²´ &lt;code>Channel&lt;/code> ì´ë¼ê³  íŒë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ê·¸ë˜ì„œ êµ¬ë…/ë°œí–‰ì— ëŒ€í•œ ì—­í• ì„ &lt;code>Subjection&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¡œ ë¶„ë¦¬í•˜ê³  &lt;code>Channel&lt;/code> í´ë˜ìŠ¤ê°€ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ ë³€ê²½í•˜ì˜€ì–´ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">Channel&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">Subjection&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span> &lt;span class="nx">Cleanable&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">topic&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="nx">subscriptions&lt;/span>: &lt;span class="kt">Subscription&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="nx">_lastUpdatedAt&lt;/span>: &lt;span class="kt">Date&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">void&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_lastUpdatedAt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">void&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">all&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">reason&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">reason&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">randomUUID&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscription&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handler&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">unsubscribe&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_lastUpdatedAt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptionId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_lastUpdatedAt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">filter&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">get&lt;/span> &lt;span class="nx">lastUpdatedAt() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">_lastUpdatedAt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">get&lt;/span> &lt;span class="nx">subscriberLength() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Channel&lt;/code>ì˜ CRUDì— ëŒ€í•´ ì—­í•  ë¶„ë¦¬ì™€, ì´í›„ ì‰½ê²Œ ë³€ê²½ ê°€ëŠ¥í•˜ê³  í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ &lt;code>ChannelRepository&lt;/code> ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³  &lt;code>MessageBroker&lt;/code>ê°€ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•˜ë„ë¡ í•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ì£¼ì…ë°›ë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ê¸°ì¡´ êµ¬í˜„ì€ &lt;code>ChannelRepository&lt;/code>ì˜ êµ¬í˜„ì²´ì¸ &lt;code>MemoryChannelRepository&lt;/code>ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">MessageBroker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">repository&lt;/span>: &lt;span class="kt">ChannelRepository&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">MemoryChannelRepository&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">topic&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">channel&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">findChannelByTopic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">topic&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscribe&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="nx">channel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">topic&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">channel&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">findChannelByTopic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">topic&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">channel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ì„¸ë¶€ êµ¬í˜„ë“¤ì„ ì£¼ì… ë°›ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— &lt;code>MessageBroker&lt;/code>ì˜ êµ¬í˜„ì€ í¬ê²Œ ë°”ë€”ê²ƒì´ ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ì–´ &lt;code>Broker&lt;/code> ì¸í„°í˜ì´ìŠ¤ëŠ” ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="schedulerì™€-scheduletask">Schedulerì™€ ScheduleTask&lt;/h2>
&lt;p>ë‹¤ìŒì€ íŠ¹ì • ì‘ì—…ì„ ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤ì¸ &lt;code>Scheduler&lt;/code>ì…ë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
direction LR
class MessageBroker~TMessage~ {
-repository: ChannelRepository
-scheduler: Scheduler
-tasks: ScheduledTask[]
+subscribe(topic: string, handler: MessageHandler)
+publish(topic: string, message: TMessage)
}
class ScheduledTask {
&lt;&lt; interface >>
+name: string
+interval: number
+execute()
}
class Scheduler {
-timers: Map
-runningTasks: Set
-tasks: ScheduledTask[]
+registerTask(task: ScheduledTask)
+unregisterTask(taskName: string)
+start(taskName: string)
+startAll()
+stop(taskName: string)
+stopAll()
-executeTask(task: ScheduledTask)
}
MessageBroker --> Scheduler : uses
Scheduler --> ScheduledTask : manages
&lt;/pre>
&lt;p>&lt;code>Scheduler&lt;/code>ëŠ” &lt;code>ScheduledTask&lt;/code> ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì˜ ëª©ë¡ì„ ì´ìš©í•˜ì—¬ ì„¤ì •ëœ ì£¼ê¸°ë¡œ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ”ë°ìš”&lt;/p>
&lt;p>&lt;code>ScheduledTask&lt;/code>ëŠ” í•´ë‹¹ ì‘ì—…ì— ëŒ€í•œ ì‹ë³„ì„ ìœ„í•œ &lt;code>name&lt;/code>ê³¼ ì‹¤í–‰í•  ì£¼ê¸°ì¸ &lt;code>interval&lt;/code>ì„ í¬í•¨í•˜ë„ë¡ í•˜ê³ , ì‹¤ì œ ì‹¤í–‰ë  ë™ì‘ì¸ &lt;code>excute()&lt;/code>ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ê³  ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>&lt;code>MessageBroker&lt;/code>ì˜ ì´ˆê¸°í™” ê³¼ì •ì—ì„œ ì£¼ì…ë°›ì€ &lt;code>ScheduledTask&lt;/code>ë“¤ì„ &lt;code>Scheduler&lt;/code>ì— ë“±ë¡í•˜ê³  ì‹¤í–‰ì‹œí‚¤ê²Œë©ë‹ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">Scheduler&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">timers&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">NodeJS.Timeout&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Map&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">runningTasks&lt;/span>: &lt;span class="kt">Set&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Set&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">private&lt;/span> &lt;span class="nx">tasks&lt;/span>: &lt;span class="kt">ScheduledTask&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[])&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="nx">registerTask&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>: &lt;span class="kt">ScheduledTask&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">find&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Task with name &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> already exists`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="nx">unregisterTask&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="nx">taskName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="nx">start&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">task&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">find&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">taskName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Task &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">taskName&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> not found`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">timers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">setInterval&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">executeTask&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">interval&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">timers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">timer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="nx">startAll() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">start&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="nx">stop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">timers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">timer&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">clearInterval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">timer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">timers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="nx">stopAll() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">executeTask&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>: &lt;span class="kt">ScheduledTask&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">runningTasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">runningTasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">execute&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">runningTasks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Scheduler&lt;/code>ê°€ &lt;code>ScheduledTask&lt;/code>ë“¤ì„ ì£¼ì…ë°›ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤ë§Œ &lt;code>MessageBroker&lt;/code>ì—ì„œë„ &lt;code>ScheduledTask&lt;/code>ë“¤ì„ ì£¼ì…ë°›ì•„ ì´ˆê¸°í™”í•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° í¸í•˜ê²Œ ë³€ê²½í•˜ë‹¤ë³´ë‹ˆ í•´ë‹¹ êµ¬ì¡°ë¥¼ ë§Œë“¤ê²Œ ë˜ì—ˆëŠ”ë°, ì´ˆê¸°í™” ë°©ë²•ì´ ì—¬ëŸ¬ê°œë¡œ ë¶„ì‚°ë˜ì–´ì„œ ì˜¤íˆë ¤ ë³µì¡í•˜ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ìƒê°ì´ ë“œë„¤ìš”&lt;/p>
&lt;p>ë” ì¢‹ì€ ë°©ë²•ì´ ìˆëŠ”ì§€ ë‹¤ì‹œ ê³ ë¯¼í•´ë´ì•¼ê² ìŠµë‹ˆë‹¤ ğŸ˜&lt;/p>
&lt;h2 id="channelcleanerì™€-cleanable">ChannelCleanerì™€ Cleanable&lt;/h2>
&lt;p>ë‹¤ìŒì€ ì±„ë„ ì •ë¦¬ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆëŠ” &lt;code>ChannelCleaner&lt;/code>ì…ë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
class Cleanable {
&lt;&lt; interface >>
+topic: string
+lastUpdatedAt: Date
+subscriberLength: number
}
class ScheduledTask {
&lt;&lt; interface >>
+name: string
+interval: number
+execute()
}
class CleanableChannelRepository {
&lt;&lt; interface >>
+findAllChannels() Promise~Cleanable[]~
+deleteChannelByTopic(topic: string)
}
class Channel~TMessage~ {
-subscriptions: Subscription[]
+topic: string
+lastUpdatedAt: Date
+subscriberLength: number
+publish(message: TMessage)
+subscribe(handler: MessageHandler)
-unsubscribe(subscriptionId: string)
}
class ChannelCleaner {
-repository: CleanableChannelRepository
+name: string
+interval: number
-staleThreshold: number
+execute()
-cleanupChannel(channel: Cleanable)
-isExpiredChannel(channel: Cleanable)
}
ChannelCleaner ..|> ScheduledTask : implements
Channel ..|> Cleanable : implements
CleanableChannelRepository --> Cleanable : manages
ChannelCleaner --> CleanableChannelRepository : uses
&lt;/pre>
&lt;p>&lt;code>ChannelCleaner&lt;/code>ëŠ” ì•ì„œ ì–¸ê¸‰í–ˆë˜ &lt;code>ScheduledTask&lt;/code>ì˜ êµ¬í˜„ì²´ë¡œ &lt;code>Scheduler&lt;/code> ê°€ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ í†µí•´ ì„¤ì •ëœ ê°„ê²©ìœ¼ë¡œ ì±„ë„ ì •ë¦¬ ì‘ì—…ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">interface&lt;/span> &lt;span class="nx">ChannelCleanerOption&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">interval?&lt;/span>: &lt;span class="kt">number&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">staleThreshold?&lt;/span>: &lt;span class="kt">number&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">ChannelCleaner&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">ScheduledTask&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">string&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Cleaner&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">interval&lt;/span>: &lt;span class="kt">number&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">staleThreshold&lt;/span>: &lt;span class="kt">number&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">repository&lt;/span>: &lt;span class="kt">CleanableChannelRepository&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">options?&lt;/span>: &lt;span class="kt">ChannelCleanerOption&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">interval&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">interval&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="nx">CLEANUP_INTERVAL_DEFAULT&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">staleThreshold&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">staleThreshold&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="nx">STALE_THRESHOLD&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">execute() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">channels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">findAllChannels&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">allSettled&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">channels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cleanupChannel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">cleanupChannel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>: &lt;span class="kt">Cleanable&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isExpiredChannel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">deleteChannelByTopic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">topic&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="nx">isExpiredChannel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>: &lt;span class="kt">Cleanable&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">threshold&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">staleThreshold&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">channel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscriberLength&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">channel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lastUpdatedAt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getTime&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">threshold&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ChannelCleanerOption&lt;/code>ì„ í†µí•´ ì‹¤í–‰ ê°„ê²©ê³¼ ì±„ë„ì˜ ìˆ˜ëª…ì„ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>&lt;code>isExpiredChannel&lt;/code> ë©”ì„œë“œë¥¼ í†µí•´ ì‚­ì œ ë˜ì–´ì•¼ í•  ì¡°ê±´ë“¤ì„ í™•ì¸í•˜ë„ë¡ êµ¬í˜„í–ˆëŠ”ë°, ì¡°ê±´ì´ ë³€ê²½ë  ê²½ìš° í•´ë‹¹ ë©”ì„œë“œì˜ ë³€ê²½ì´ ë¶ˆê°€í”¼í•´ ë³´ì´ë„¤ìš” ğŸ˜…&lt;/p>
&lt;p>ë¯¸ë“¤ì›¨ì–´ ê°™ì€ &lt;strong>ì±…ì„ ì—°ì‡„ íŒ¨í„´&lt;/strong>ì„ ì ìš©í•´ë³´ë©´ ì¢‹ì§€ ì•Šì„ê¹Œ ìƒê°ì´ ë“¤ê¸´ í•˜ì§€ë§Œ, ì•„ì§ ì´ë¥¸ ê°ì´ ìˆì–´ ë³´ì—¬ì„œ ë‹¤ìŒ ê¸°íšŒì— ì ìš©í•´ë³´ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>ì´ ì½”ë“œì—ì„œ ì¡°ê¸ˆ íŠ¹ì´í•œ ì ì€ &lt;code>ChannelRepository&lt;/code>ê°€ ì•„ë‹Œ &lt;code>CleanableChannelRepository&lt;/code> ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ë„ë¡ êµ¬ì„±í–ˆë‹¤ëŠ” ì  ì¸ë°ìš”&lt;/p>
&lt;p>&lt;code>CleanableChannelRepository&lt;/code>ëŠ” &lt;code>Channel&lt;/code>ì´ ì•„ë‹Œ &lt;code>Cleanable&lt;/code>ì„ ì²˜ë¦¬í•˜ë„ë¡ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>ì•ì„œ &lt;code>Subjection&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•œ &lt;code>Channel&lt;/code>í´ë˜ìŠ¤ëŠ” &lt;code>Cleanable&lt;/code>ë„ êµ¬í˜„í•˜ë„ë¡ í•˜ê³  ìˆëŠ”ë°, ì´ëŠ” &lt;code>ChannelCleaner&lt;/code>ê°€ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚­ì œí•˜ê¸° ìœ„í•œ ê¸°ì¤€ë“¤ì„ í¬í•¨í•˜ë„ë¡ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>&lt;code>ChannelCleaner&lt;/code>ì—ì„œ ê´€ë¦¬í•˜ê²Œ ë  &lt;code>Channal&lt;/code>ì— ëŒ€í•´ í˜„ì¬ ì‚­ì œ ê¸°ì¤€ì¸ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œì ì„ ì˜ë¯¸í•˜ëŠ” &lt;code>lastUpdatedAt&lt;/code>ê³¼ í˜„ì¬ êµ¬ë…ìë“¤ì˜ ìˆ˜ë¥¼ ì˜ë¯¸í•˜ëŠ” &lt;code>subcriberLength&lt;/code>, ê·¸ë¦¬ê³  í•´ë‹¹ ì±„ë„ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•  ìˆ˜ ìˆëŠ” &lt;code>topic&lt;/code>ì„ í†µí•´ ì •ë¦¬ë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³  &lt;code>ChannelCleaner&lt;/code>ê°€ &lt;code>Channel&lt;/code>ì„ ì§ì ‘ í™œìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆì–´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì¡°ê¸ˆ ë” ê°„ê²°í•´ì§€ëŠ” íš¨ê³¼ë„ ì–»ì„ ìˆ˜ ìˆì—ˆì–´ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">describe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ChannelCleaner&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">repository&lt;/span>: &lt;span class="kt">jest.Mocked&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ChannelRepository&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">cleaner&lt;/span>: &lt;span class="kt">ChannelCleaner&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">NOW&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">now&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">createMockChannel&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">props&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">topic?&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">lastUpdatedAt?&lt;/span>: &lt;span class="kt">Date&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscriberLength?&lt;/span>: &lt;span class="kt">number&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Channel&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">any&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">topic&lt;/span>: &lt;span class="kt">props.topic&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="s1">&amp;#39;test-topic&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">lastUpdatedAt&lt;/span>: &lt;span class="kt">props.lastUpdatedAt&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">NOW&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscriberLength&lt;/span>: &lt;span class="kt">props.subscriberLength&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">Channel&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">any&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">beforeEach&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jest&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">spyOn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Date&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;now&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">mockReturnValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">NOW&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">repository&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">findChannelByTopic&lt;/span>: &lt;span class="kt">jest.fn&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">mockResolvedValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">undefined&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">findAllChannels&lt;/span>: &lt;span class="kt">jest.fn&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">mockResolvedValue&lt;/span>&lt;span class="p">([]),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">deleteChannelByTopic&lt;/span>: &lt;span class="kt">jest.fn&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">mockResolvedValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">undefined&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cleaner&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">ChannelCleaner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">repository&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">interval&lt;/span>: &lt;span class="kt">1000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">staleThreshold&lt;/span>: &lt;span class="kt">500&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ìœ„ ì½”ë“œëŠ” &lt;code>Channel&lt;/code>ì„ í™œìš©í•  ë•Œ í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì œê°€ ìƒê°í•œ ë¬¸ì œëŠ” í™œìš©í•˜ì§€ ì•ŠëŠ” ë©”ì„œë“œì™€ ìš”ì†Œê¹Œì§€ ëª¨í‚¹í•´ì•¼í•œë‹¤ëŠ” ì  ì´ì—ˆì–´ìš”&lt;/p>
&lt;p>ë³´ì‹œëŠ” ê²ƒ ì²˜ëŸ¼ &lt;code>ChannelRepository&lt;/code>ë¥¼ ëª¨í‚¹í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” &lt;code>findChannelByTopic&lt;/code> ë©”ì„œë“œë¥¼ ëª¨í‚¹í•´ì•¼í–ˆê³ ,&lt;/p>
&lt;p>&lt;code>Channel&lt;/code>ì„ ìƒì„±í•˜ëŠ” í•¼í¼ í•¨ìˆ˜ &lt;code>createMockChannel&lt;/code> ë˜í•œ ë¶ˆí•„ìš”í•œ ìš”ì†Œë“¤ì„ ëª¨ë‘ êµ¬í˜„í•˜ì§€ ì•Šê¸° ìœ„í•´ íƒ€ì… ë‹¨ì–¸ì„ í™œìš©í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ëŸ¬í•œ ë¶€ë¶„ì´ ë¶ˆí•„ìš”í•œ ë¶€ë¶„ì— ì˜ì¡´ë˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“ ë‹¤ê³  ìƒê°í–ˆì–´ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">describe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ChannelCleaner&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">repository&lt;/span>: &lt;span class="kt">jest.Mocked&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">CleanableChannelRepository&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">cleaner&lt;/span>: &lt;span class="kt">ChannelCleaner&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">NOW&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">now&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">createMockCleanable&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">props&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">topic?&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">lastUpdatedAt?&lt;/span>: &lt;span class="kt">Date&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscriberLength?&lt;/span>: &lt;span class="kt">number&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Cleanable&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">topic&lt;/span>: &lt;span class="kt">props.topic&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="s1">&amp;#39;test-topic&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">lastUpdatedAt&lt;/span>: &lt;span class="kt">props.lastUpdatedAt&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">NOW&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscriberLength&lt;/span>: &lt;span class="kt">props.subscriberLength&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">beforeEach&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jest&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">spyOn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Date&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;now&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">mockReturnValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">NOW&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">repository&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">findAllChannels&lt;/span>: &lt;span class="kt">jest.fn&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">mockResolvedValue&lt;/span>&lt;span class="p">([]),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">deleteChannelByTopic&lt;/span>: &lt;span class="kt">jest.fn&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">mockResolvedValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">undefined&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cleaner&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">ChannelCleaner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">repository&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">interval&lt;/span>: &lt;span class="kt">1000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">staleThreshold&lt;/span>: &lt;span class="kt">500&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ì´ëŸ¬í•œ ì´ìœ ë¡œ &lt;code>Channel&lt;/code> í´ë˜ìŠ¤ê°€ &lt;code>Cleanable&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ëŠ” ë™ì‹œì— &lt;code>CleanableChannelRepository&lt;/code>ë¥¼ í†µí•´ í•„ìš”í•œ ë©”ì„œë“œë§Œ í˜¸ì¶œë˜ë„ë¡ í•˜ì—¬ íƒ€ì… ë‹¨ì–¸ì´ë‚˜ ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„ ì œê±°í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ëŸ¬í•œ êµ¬ì¡°ë¡œ ì¸í•´ ê´€ë¦¬í•´ì•¼í•  ì¸í„°í˜ì´ìŠ¤ê°€ ëŠ˜ì–´ë‚˜ê¸´ í•˜ì§€ë§Œ &lt;code>Channel&lt;/code>ì— ëœ ì˜ì¡´ì ì¸ ì½”ë“œê°€ ë” ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì—¬ ì ìš©í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬&lt;/h2>
&lt;p>ì´ë²ˆì—ëŠ” ê¸°ì¡´ pub/sub ê¸°ëŠ¥ì— &lt;strong>êµ¬ë…ìê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ì˜¤ëœ ì‹œê°„ ìœ ì§€ëœ ì±„ë„&lt;/strong>ì€ ì•ìœ¼ë¡œë„ êµ¬ë…ìê°€ ì—†ì„ ê²ƒ ì´ë¼ëŠ” ê°€ì •ì„ ê¸°ë°˜ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ëŠ¥ì„ ë„ì…í•´ë´¤ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ë¥¼ ìœ„í•´ ì¼ì • ì£¼ê¸°ë¡œ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” &lt;code>Schduler&lt;/code>ê³¼ ê²€ì¦ ì¡°ê±´ì„ í†µí•´ ì±„ë„ì„ ì‚­ì œí•˜ëŠ” ì—­í• ì„ &lt;code>ChannelCleaner&lt;/code>ë¡œ êµ¬í˜„í•˜ì—¬ ì±…ì„ì„ ìµœëŒ€í•œ ë¶„ë¦¬í•´ë³´ë ¤ ì‹œë„í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ ê³¼ì •ì—ì„œ ì£¼ìš” ê´€ì‹¬ì‚¬ì¸ &lt;code>Channel&lt;/code>ì„ ë¶„ë¦¬í•˜ì—¬ ì²˜ë¦¬ íë¦„ì´ ë”ìš± ëª…í™•íˆ ë³´ì´ë„ë¡ í–ˆê³ , &lt;code>Subjection&lt;/code>ê³¼ &lt;code>Cleanable&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ì—¬ ë™ì‘ì„ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ë ¤ í•´ë´¤ë„¤ìš”&lt;/p>
&lt;p>&lt;code>Scheduler&lt;/code>ì—ì„œ ê´€ë¦¬ë  ì‘ì—…ë“¤ì„ &lt;code>SchduledTask&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•˜ì—¬ ì¼ì • ì£¼ê¸°ë¡œ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í–ˆê³ , &lt;code>ChannelCleaner&lt;/code>ê°€ &lt;code>SchduledTask&lt;/code>ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ì—¬ ì„¤ì •í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë‹¤ ë§Œë“¤ê³  ì •ë¦¬í•˜ë‹¤ë³´ë‹ˆ ê¸°ëŠ¥ì— ë¹„í•´ ë„ˆë¬´ ë¹„ëŒ€í•œ ì½”ë“œê°€ ëœ ê²ƒì´ ì•„ë‹Œê°€ ì‹¶ê¸°ë„ í•˜ê³ , ì•„ì‰¬ìš´ ì ë„ ì¡°ê¸ˆì”© ë³´ì´ë„¤ìš”ğŸ˜…&lt;/p>
&lt;p>ì•„ì§ ì™„ì„±ëœ ê²ƒì€ ì•„ë‹ˆë‹ˆ ê³„ì†í•´ì„œ ì¡°ê¸ˆì”© ê°œì„ í•´ ë‚˜ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤! ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.ğŸ˜Š (ë‹¤ìŒ ìˆœì„œëŠ” ì‹¤íŒ¨ ë©”ì‹œì§€ ì¬ë°œì†¡ ê´€ë ¨ ê°œì„ ì„ í•´ë³´ë ¤ê³  í•´ìš”)&lt;/p></description></item><item><title>2. ë°œí–‰-êµ¬ë… íŒ¨í„´ì—ì„œ ë°œí–‰ìëŠ” ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œ?</title><link>https://codemario318.github.io/post/node/pub-sub/2/</link><pubDate>Thu, 30 Jan 2025 09:17:35 +0900</pubDate><guid>https://codemario318.github.io/post/node/pub-sub/2/</guid><description>&lt;img src="https://codemario318.github.io/post/node/pub-sub/2/cover.png" alt="Featured image of post 2. ë°œí–‰-êµ¬ë… íŒ¨í„´ì—ì„œ ë°œí–‰ìëŠ” ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œ?" />&lt;p>&lt;a class="link" href="https://codemario318.github.io/post/node/pub-sub/1/" >ì €ë²ˆ ê¸€&lt;/a>ì— ê°„ë‹¨í•œ pub/sub ëª¨ë“ˆì„ êµ¬í˜„í–ˆë˜ ë‚´ìš©ë“¤ì„ ê³µìœ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë§Œë“  ëª¨ë“ˆì„ ê°œì„ í•˜ë ¤ê³  ì—¬ëŸ¬ ìë£Œë“¤ì„ ì°¸ê³ í•´ë³´ë‹ˆ ì œê°€ êµ¬í˜„í•œ pub/sub ëª¨ë“ˆì—ì„œ ë­”ê°€ ì´ì§ˆê°ì´ ëŠê»´ì¡Œì–´ìš”&lt;/p>
&lt;p>ì˜¤ëŠ˜ì€ ê·¸ ì´ì§ˆê°ì„ ëŠê¼ˆë˜ ë¶€ë¶„ì— ëŒ€í•´ ë§ì”€ë“œë¦¬ê³  ê°œì„ í•´ë³¸ ë‚´ìš©ë“¤ì„ ê³µìœ ë“œë¦¬ë ¤ê³  í•©ë‹ˆë‹¤.&lt;/p>
&lt;h2 id="í˜„ì¬-êµ¬ì¡°">í˜„ì¬ êµ¬ì¡°&lt;/h2>
&lt;p>ì´ì „ì— êµ¬í˜„í–ˆë˜ &lt;code>Broker&lt;/code> ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬ì¡°ë¥¼ ë¨¼ì € ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
class Broker {
&lt;&lt; interface >>
subscribe(publisherId: string, handler: MessageHandler)
publish(publisherId: string, message: TMessage)
addPublisher(publisherId)
removePublisher(publisherId: string)
}
&lt;/pre>
&lt;ul>
&lt;li>&lt;code>TMessage&lt;/code>: ì‚¬ìš©ìê°€ ì •ì˜í•˜ëŠ” ì²˜ë¦¬í•  ë©”ì‹œì§€&lt;/li>
&lt;li>&lt;code>MessageHandler&lt;/code>: &lt;code>TMessage&lt;/code>ë¡œ ì •ì˜ëœ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬&lt;/li>
&lt;/ul>
&lt;p>ì²˜ìŒ ì˜ë„í–ˆë˜ ì½”ë“œëŠ” &lt;code>Broker&lt;/code>ì˜ êµ¬í˜„ì²´ì˜ &lt;code>addPublisher&lt;/code>ë¥¼ í†µí•´ ë°œí–‰ìë¥¼ ë“±ë¡í•˜ê³ , ì´í›„ êµ¬ë…ìë“¤ì´ í•´ë‹¹ ë°œí–‰ìë¥¼ êµ¬ë…í•˜ëŠ” í˜•íƒœì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ì´ì§ˆê°ì„-ëŠê¼ˆë˜-ë¶€ë¶„">ì´ì§ˆê°ì„ ëŠê¼ˆë˜ ë¶€ë¶„&lt;/h2>
&lt;p>&lt;a class="link" href="https://codemario318.github.io/post/node/pub-sub/1/" >ì´ì „ ê¸€&lt;/a>ì—ì„œ ì–¸ê¸‰í–ˆë˜ ë‚´ìš©ì²˜ëŸ¼ ì œê°€ pub/sub íŒ¨í„´ì„ ì ìš©í•œ ì´ìœ ëŠ” &lt;strong>íŠ¹ì • ê·¸ë£¹ì— ëŒ€í•œ ì›¹ì†Œì¼“ ìš”ì²­/ì‘ë‹µ ë¸Œë¡œë“œìºìŠ¤íŒ… ì²˜ë¦¬í•  ë•Œ, í•´ë‹¹ ì›¹ì†Œì¼“ ì—°ê²°ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì•Œê³ ìˆì–´ì•¼ í•œë‹¤ëŠ” ë¬¸ì œ&lt;/strong>ë¡œ ì¸í•´ ë°œìƒí•œ &lt;strong>ê²°í•©ì„ ëŠìŠ¨í•˜ê²Œ&lt;/strong> ë§Œë“¤ê¸° ìœ„í•¨ì´ì—ˆëŠ”ë°ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">MessageBroker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptionId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">randomUUID&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[...&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">subscriptionId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>&lt;span class="p">}]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>í˜„ì¬ êµ¬í˜„ëœ &lt;code>subscribe&lt;/code> ë©”ì„œë“œë¥¼ ì‚´í´ë³´ë©´, êµ¬ë…í•˜ë ¤ê³  í•˜ëŠ” ë°œí–‰ìê°€ ì—†ëŠ” ê²½ìš° ì˜ˆì™¸ë¥¼ ë˜ì§€ë„ë¡ ë˜ì–´ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ë¥¼ í•´ì„í•´ë³´ë©´ &lt;strong>êµ¬ë…ìê°€ ë°œí–‰ìì˜ ì¡´ì¬ ìœ ë¬´ì— ì˜í–¥ì„ ë°›ìŒ&lt;/strong>ì„ ì˜ë¯¸í•˜ê²Œ ëœë‹¤ê³  ìƒê°í•˜ê²Œ ë˜ì—ˆì–´ìš”&lt;/p>
&lt;p>ì‚¬ì‹¤ ì´ëŸ¬í•œ êµ¬í˜„ì€ &lt;strong>ë°œí–‰-êµ¬ë… íŒ¨í„´&lt;/strong>ì´ë¼ê³ ëŠ” ë§í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, ë©”ì‹œì§€ ë¸Œë¡œì»¤(ì´ë²¤íŠ¸ ë²„ìŠ¤)ê°€ &lt;strong>ì˜µì €ë²„ íŒ¨í„´&lt;/strong>ì˜ ì£¼ì œ(Subject)ë¥¼ ëª¨ì•„ ê´€ë¦¬ë§Œ í•´ì£¼ëŠ” í˜•íƒœê°€ ë˜ì—ˆê¸° ë•Œë¬¸ì— ì™„ë²½í•˜ê²Œ ê²°í•©ì„ ëŠìŠ¨í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤ê³ ëŠ” ë³¼ ìˆ˜ ì—†ë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ì˜µì €ë²„-íŒ¨í„´">ì˜µì €ë²„ íŒ¨í„´&lt;/h2>
&lt;p>ê°„ëµí•˜ê²Œ ì˜µì €ë²„ íŒ¨í„´ì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
direction LR
class Subject {
&lt;&lt; interface >>
attach(observer: Observer)
detach(observer: Observer)
notify()
}
class Observer {
&lt;&lt; interface >>
+update()
}
class ConcreteSubject {
-observers: Observer[]
+attach(observer: Observer)
+detach(observer: Observer)
+notify()
}
class ConcreteObserver {
+update()
}
Subject &lt;|-- ConcreteSubject
Observer &lt;|-- ConcreteObserver
Subject "1" --o "*" Observer : observers
ConcreteObserver --> ConcreteSubject
&lt;/pre>
&lt;p>ì˜µì €ë²„ íŒ¨í„´ì€ ì£¼ì œ(&lt;code>Subject&lt;/code>)ì™€ ê´€ì°°ì(&lt;code>Observer&lt;/code>)ë¡œ êµ¬ì„±ë˜ì–´, íŠ¹ì • &lt;code>Subject&lt;/code>ë¥¼ &lt;code>Observer&lt;/code> ê´€ì°°í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë§Œë“œëŠ”ë°ìš”&lt;/p>
&lt;p>&lt;code>Subject&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ &lt;code>ConcreteSubject&lt;/code> í´ë˜ìŠ¤ì—ì„œ &lt;code>Observer&lt;/code>ì˜ êµ¬í˜„ì²´ë“¤ì„ ê°€ì§€ê³  ìˆê³ , íŠ¹ì • ìƒíƒœ ë³€ê²½ì‹œ &lt;code>notify&lt;/code> ë©”ì„œë“œë¥¼ í†µí•´ &lt;code>Observer&lt;/code>ì˜ &lt;code>update&lt;/code> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬, ì›í•˜ëŠ” ê¸°ëŠ¥ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” í˜•íƒœë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.&lt;/p>
&lt;p>ê¸°ë³¸ì ì¸ êµ¬ì¡°ë¥¼ ê°„ë‹¨íˆ êµ¬í˜„í•œ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ë©´&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">Subject&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">observers&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[])&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observer&lt;/span>: &lt;span class="kt">Observer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">observers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">notify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">observers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observer&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">observer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">Observer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`ID: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> : &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">subject&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Subject&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="p">&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">observerA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Observer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">observerB&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Observer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">subject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observerA&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">subject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observerB&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">subject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">notify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;hi&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ID: A : hi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ID: B : hi
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ êµ¬í˜„ë  ìˆ˜ ìˆê³ , í•¨ìˆ˜ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆëŠ” JS/TSì˜ íŠ¹ì„±ì„ í™œìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ í‘œí˜„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">Observer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">void&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">Subject&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">observers&lt;/span>: &lt;span class="kt">Observer&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[])&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observer&lt;/span>: &lt;span class="kt">Observer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">observers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">notify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>: &lt;span class="kt">any&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">observers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">observer&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">observer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">function&lt;/span> &lt;span class="nx">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`ID: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> : &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">subject&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Subject&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="p">&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">subject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">subject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">subject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">notify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;hi&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ID: A : hi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ID: B : hi
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ì˜µì €ë²„ íŒ¨í„´ì„ ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¥ì ì„ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ê´€ì°°ìë¥¼ ì–¸ì œë“  ì¶”ê°€í•  ìˆ˜ ìˆìŒ
&lt;ul>
&lt;li>&lt;code>Observer&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê°ì²´ ëª©ë¡ì—ë§Œ ì˜ì¡´í•˜ë¯€ë¡œ, ì–¸ì œë“  ìƒˆë¡œìš´ ì˜µì €ë²„ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŒ&lt;/li>
&lt;li>ì‹¤í–‰ ì¤‘ì— í•˜ë‚˜ì˜ ì˜µì €ë²„ë¥¼ ë‹¤ë¥¸ ì˜µì €ë²„ë¡œ ë°”ê¿”ë„ ë‹¤ë¥¸ ì˜µì €ë²„ì—ê²Œ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ”ë° ì˜í–¥ì´ ì—†ìŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ìƒˆë¡œìš´ í˜•ì‹ì˜ ì˜µì €ë²„ë¥¼ ì¶”ê°€í•´ë„ ì£¼ì œë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŒ
&lt;ul>
&lt;li>&lt;code>Observer&lt;/code> ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„í•˜ë©´ ë¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ì£¼ì œì™€ ê´€ì°°ì ëª¨ë‘ ë…ë¦½ì ìœ¼ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŒ&lt;/li>
&lt;li>ì£¼ì œë‚˜ ì˜µì €ë²„ì˜ ë‚´ë¶€ êµ¬í˜„ì´ ë‹¬ë¼ì ¸ë„ ì„œë¡œì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠìŒ
&lt;ul>
&lt;li>&lt;code>Observer&lt;/code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤ëŠ” ì¡°ê±´ë§Œ ë§Œì¡±í•œë‹¤ë©´!&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ì˜µì €ë²„ íŒ¨í„´ë„ &lt;strong>ì£¼ì œê°€ ê´€ì°°ìë¼ëŠ” íŠ¹ì • ì¸í„°í˜ì´ìŠ¤(ë˜ëŠ”, íŠ¹ì • ì…ë ¥ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜)ë¥¼ êµ¬í˜„í•œë‹¤ëŠ” ì‚¬ì‹¤ë§Œ ì•Œê³  ìˆì„ ë¿&lt;/strong>ì´ë¯€ë¡œ, ì¶©ë¶„íˆ &lt;strong>ëŠìŠ¨í•œ ê²°í•©&lt;/strong>ì„ ë§Œë“ ë‹¤ê³  ë³¼ ìˆ˜ ìˆì§€ë§Œ, ì—¬ì „íˆ íŠ¹ì • ì£¼ì œì˜ êµ¬í˜„ì²´ë¥¼ ì•Œì•„ì•¼ í•œë‹¤ëŠ” ì‚¬ì‹¤(&lt;code>Subject&lt;/code> êµ¬í˜„ì²´ê°€ ì¡´ì¬í•´ì•¼í•¨, ì–´ë–»ê²Œë“  ë„˜ê²¨ì¤˜ì•¼í•¨)ì€ ë‚¨ì•„ìˆê²Œ ë©ë‹ˆë‹¤.&lt;/p>
&lt;h2 id="topic-channel">Topic, Channel&lt;/h2>
&lt;p>ì´ë ‡ê²Œ ë­”ê°€ ì°ì°í•œ(?) ê²°ê³¼ë¥¼ êµ¬í˜„í•˜ê²Œ ëœ ì´ìœ ëŠ” &lt;strong>êµ¬ë…-ë°œí–‰ íŒ¨í„´ì—ì„œ ë°œí–‰ì&lt;/strong>ê°€ &lt;strong>ì˜µì €ë²„ íŒ¨í„´ì—ì„œì˜ íŠ¹ì • ì£¼ì œ&lt;/strong>(&lt;code>Subject&lt;/code>)ê°€ ì™€ ê°™ë‹¤ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>íŠ¹íˆ ì œê°€ ì˜¤í•´í•œ ë¶€ë¶„ì€ ë°”ë¡œ &lt;strong>Topic&lt;/strong> í˜¹ì€ &lt;strong>Channel&lt;/strong>ì´ë¼ëŠ” ê°œë…ì´ì—ˆì–´ìš”&lt;/p>
&lt;p>&lt;img src="https://codemario318.github.io/post/node/pub-sub/2/img_1.png"
width="1840"
height="1118"
srcset="https://codemario318.github.io/post/node/pub-sub/2/img_1_hub46379c79e0207865306d5fb3196c10a_148103_480x0_resize_box_3.png 480w, https://codemario318.github.io/post/node/pub-sub/2/img_1_hub46379c79e0207865306d5fb3196c10a_148103_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ë°œí–‰/êµ¬ë… íŒ¨í„´"
class="gallery-image"
data-flex-grow="164"
data-flex-basis="394px"
>&lt;/p>
&lt;p>ìœ„ ê·¸ë¦¼ì²˜ëŸ¼ &lt;strong>ë©”ì‹œì§€ ë¸Œë¡œì»¤&lt;/strong>ëŠ” &lt;strong>ê° ì±„ë„ì— ë°œí–‰ëœ ë©”ì‹œì§€ë¥¼ êµ¬ë…ìì—ê²Œ ì „ë‹¬í•˜ëŠ” ì—­í• &lt;/strong>ì„ ìˆ˜í–‰í•˜ê²Œë©ë‹ˆë‹¤.&lt;/p>
&lt;p>ì €ëŠ” ì´ëŸ¬í•œ êµ¬ì¡°ë¥¼ &lt;strong>ë©”ì‹œì§€ ë¸Œë¡œì»¤&lt;/strong>ê°€ &lt;strong>ë°œí–‰ì&lt;/strong>ë“¤ê³¼ ê°ê°ì˜ &lt;strong>êµ¬ë…ìë“¤&lt;/strong>ì„ ê´€ë¦¬í•˜ëŠ” í˜•íƒœë¡œ ì˜¤í•´í–ˆë˜ ê²ƒ ì´ì—ˆì–´ìš”&lt;/p>
&lt;p>ë¬¼ë¡  ì•„ì£¼ í‹€ë ¸ë‹¤ê³  í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ&amp;hellip; ì¡°ê¸ˆ ë” ì •í™•íˆ í‘œí˜„í•˜ë©´ &lt;strong>ë©”ì‹œì§€ ë¸Œë¡œì»¤&lt;/strong>ëŠ” &lt;strong>ì˜µì €ë²„ íŒ¨í„´ì˜ &lt;code>Subject&lt;/code> êµ¬í˜„ì²´ê°€ ì•„ë‹Œ íŠ¹ì • ê´€ì‹¬ì‚¬ ìì²´ë¥¼ ê´€ë¦¬&lt;/strong>í•˜ëŠ” ê²ƒì´ê³ , &lt;strong>íŠ¹ì • ê´€ì‹¬ì‚¬ì— ëŒ€í•´ ë°œí–‰ëœ ë©”ì‹œì§€ë¥¼ ë©”ì‹œì§€ ë¸Œë¡œì»¤ê°€ êµ¬ë…ìì—ê²Œ ë„˜ê²¨ì£¼ëŠ” ê·¸ë£¹í™”ëœ íë¦„ì„ ìì²´&lt;/strong>ë¥¼ &lt;strong>Channel&lt;/strong> í˜¹ì€ &lt;strong>Topic&lt;/strong>ì´ë¼ ë¶€ë¥¸ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë¹„ìœ ë¥¼ í•´ë³´ìë©´ TVë¥¼ ë³¼ ë•Œ íŠ¹ì • ë²ˆí˜¸ë¥¼ í†µí•´ íŠ¹ì • ë°©ì†¡êµ­ì—ì„œ ë°©ì†¡ì´ ì†¡ì¶œë˜ëŠ” ì£¼íŒŒìˆ˜ ëŒ€ì—­ì— ë§ì¶”ê³  í•´ë‹¹ ë°©ì†¡êµ­ì—ì„œ ë³´ë‚´ëŠ” ì˜ìƒì„ ì‹œì²­í•˜ëŠ” ê²ƒì„ &lt;strong>ì±„ë„ì„ ë§ì¶˜ë‹¤&lt;/strong>ë¼ê³  í‘œí˜„í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ìš”&lt;/p>
&lt;p>ê³µì¤‘íŒŒ ë°©ì†¡ìœ¼ë¡œ ì œí•œí–ˆì„ ë•Œ, ë°©ì†¡êµ­ì€ íŠ¹ì • ëŒ€ìƒì— ëŒ€í•´ì„œë§Œ ë°©ì†¡ì„ ì†¡ì¶œí•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ëª¨ë“  ëŒ€ìƒì— ëŒ€í•´ì„œ ì‹ í˜¸ë¥¼ ì†¡ì¶œí•˜ê³ , ì—°ê²°ë§Œ ë˜ì–´ìˆë‹¤ë©´ ì±„ë„ì„ ë§ì¶° ì‹œì²­í•  ìˆ˜ ìˆëŠ” ê²ƒê³¼ ê°™ì€ ë§¥ë½ì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ê´€ì‹¬ì‚¬ì— ì¡°ê¸ˆ ë” ì§‘ì¤‘í•´ì„œ í‘œí˜„í•œ ë‹¨ì–´ê°€ Topic, ë©”ì‹œì§€ê°€ ì „ë‹¬ë˜ëŠ” ê³¼ì •ì— ì§‘ì¤‘í•´ì„œ í‘œí˜„í•œ ë‹¨ì–´ê°€ Channelì´ ì•„ë‹ê¹Œ ìƒê°í•´ë´…ë‹ˆë‹¤.&lt;/li>
&lt;/ul>
&lt;h2 id="ê°œì„ ">ê°œì„ &lt;/h2>
&lt;p>ì´ëŸ¬í•œ ë‚´ìš©ë“¤ì„ ë°˜ì˜í•˜ì—¬ ì•„ë˜ì™€ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡°ë¡œ ë³€ê²½í•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;pre class="mermaid" style="text-align: center;">classDiagram
class Broker {
&lt;&lt; interface >>
subscribe(channel: string, handler: MessageHandler)
publish(channel: string, message: TMessage)
}
&lt;/pre>
&lt;p>ë³€ê²½ëœ ë¶€ë¶„ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ê° í•¨ìˆ˜ì˜ ì¸ì &lt;code>publisherId&lt;/code>ë¥¼ &lt;code>channel&lt;/code>ë¡œ ë³€ê²½&lt;/li>
&lt;li>&lt;code>addSubscriber&lt;/code>, &lt;code>removeSubscriber&lt;/code> ë©”ì„œë“œ ì œê±°&lt;/li>
&lt;/ul>
&lt;p>ê²°ê³¼ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¬¼ì´ ë‚˜ì™”ìŠµë‹ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">MessageBroker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">channels&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">Subscription&lt;/span>&lt;span class="err">&amp;lt;&lt;/span>&lt;span class="na">TMessage&lt;/span>&lt;span class="p">&amp;gt;[]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Map&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getSubscriptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptionId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">randomUUID&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">channels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[...&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">subscriptionId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>&lt;span class="p">}]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getSubscriptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">subscriber&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">subscriber&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="nx">getSubscriptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">channels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">channels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">channels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getSubscriptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">channels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">channel&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>addPublisher&lt;/code>, &lt;code>removePublisher&lt;/code>ê°€ ì œê±°ë˜ë©° &lt;code>getSubscriptions&lt;/code> ë©”ì„œë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë³´ì‹œëŠ” ê²ƒê³¼ ê°™ì´ ì±„ë„ ì»¬ë ‰ì…˜ì— í•´ë‹¹ ì±„ë„ì´ ì—†ì„ ê²½ìš° ë¹ˆ ì±„ë„ì„ ì´ˆê¸°í™” í›„ ë°˜í™˜í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ë”-ê³ ë¯¼í•´ë´ì•¼í• -ë‚´ìš©">ë” ê³ ë¯¼í•´ë´ì•¼í•  ë‚´ìš©&lt;/h2>
&lt;p>êµ¬ë…ìê°€ íŠ¹ì • ë°œí–‰ìë¥¼ ë°œí–‰ìê°€ ì•„ë‹Œ ê´€ì‹¬ì‚¬ë¥¼ êµ¬ë…í•˜ê²Œ ë˜ì—ˆëŠ”ë°ìš”, ì´ë¡œ ì¸í•´ ì£¼ì˜í•´ì•¼í•˜ê±°ë‚˜ ìƒê°í•´ë´ì•¼ í•  ë‚´ìš©ë“¤ì´ ë” ìƒê¸°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ol>
&lt;li>ë°œí–‰ìê°€ ì—†ë”ë¼ë„ êµ¬ë… ìƒíƒœê°€ ìœ ì§€ë  ìˆ˜ ìˆìŒ&lt;/li>
&lt;li>channelì„ ì˜ëª» ì…ë ¥í•œ ê²½ìš° ë‹¤ë¥¸ ê´€ì‹¬ì‚¬ë¥¼ êµ¬ë…í•˜ê²Œ ë¨(ì˜¤ë¥˜ë¡œ ì²˜ë¦¬ë˜ì§€ ì•ŠìŒ)&lt;/li>
&lt;li>channelì— êµ¬ë…ìê°€ ì—†ë”ë¼ë„ ë¹ˆ ë°°ì—´ì´ ìœ ì§€ë¨&lt;/li>
&lt;/ol>
&lt;p>í¬ê²Œ ì„¸ ê°€ì§€ ì •ë„ê°€ ìƒê°ë‚˜ëŠ”êµ°ìš”&lt;/p>
&lt;p>1, 2ë²ˆì˜ ê²½ìš°ëŠ” ëª¨ë“ˆì„ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•´ì•¼í•  ì ìœ¼ë¡œ ë³´ì´ê³ , 3ë²ˆ ê°™ì€ ê²½ìš°ëŠ” ë³„ë„ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ê°€ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬&lt;/h2>
&lt;p>ì´ì „ ê¸€ì— ì´ì–´ì„œ ë°œí–‰-êµ¬ë… íŒ¨í„´ì— ëŒ€í•œ ì˜ëª»ëœ ì˜¤í•´ë¥¼ ë°”ë¡œ ì¡ì•„, ì œê°€ ì§ì ‘ êµ¬í˜„í•œ pub/sub íŒ¨í‚¤ì§€ë¥¼ ê°œì„ í•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë‹¤ìŒ ì£¼ì œëŠ” êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì— ëŒ€í•œ ê´€ë¦¬ë¥¼ ì–´ë–»ê²Œ í•´ì•¼í•  ì§€ ê³ ë¯¼í•´ë³´ëŠ” ê³¼ì •ì´ ë  ê²ƒ ê°™ë„¤ìš”&lt;/p>
&lt;p>ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ğŸ˜&lt;/p></description></item><item><title>1. ë°œí–‰-êµ¬ë… íŒ¨í„´ì„ í†µí•´ ê²°í•©ì„ ê°œì„ í•´ë³´ì</title><link>https://codemario318.github.io/post/node/pub-sub/1/</link><pubDate>Fri, 24 Jan 2025 11:49:35 +0900</pubDate><guid>https://codemario318.github.io/post/node/pub-sub/1/</guid><description>&lt;img src="https://codemario318.github.io/post/node/pub-sub/1/cover.png" alt="Featured image of post 1. ë°œí–‰-êµ¬ë… íŒ¨í„´ì„ í†µí•´ ê²°í•©ì„ ê°œì„ í•´ë³´ì" />&lt;p>ì•ˆë…•í•˜ì„¸ìš”ğŸ˜€ ìµœê·¼ ë¶€ìŠ¤íŠ¸ìº í”„ ë©¤ë²„ì‹­ ê³¼ì •ì„ ë§ˆì¹˜ê³ , ì´ì „í•´ ìˆ˜í–‰í–ˆë˜ í”„ë¡œì íŠ¸ë¥¼ ë¦¬íŒ©í† ë§ í•˜ëŠ” ì‹œê°„ì„ ê°€ì§€ê³  ìˆëŠ”ë°ìš”, ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í•˜ë©´ì„œ ë°œí–‰-êµ¬ë… íŒ¨í„´ì„ í†µí•´ í”„ë¡œì íŠ¸ë¥¼ ê°œì„ í•œ ê²½í—˜ì„ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤.&lt;/p>
&lt;p>í”„ë¡œì íŠ¸ì—ì„œ ì–´ë– í•œ ë¬¸ì œê°€ ìˆì—ˆëŠ”ì§€ ì•Œì•„ë³´ê³ , êµ¬í˜„í•œ ê²°ê³¼ë¬¼ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ë¬¸ì œì˜-ì‹œì‘">ë¬¸ì œì˜ ì‹œì‘&lt;/h2>
&lt;p>ì €í¬ íŒ€ì€ &lt;strong>ì—¬ëŸ¬ ì¸ì›ë“¤ì´ ë™ì‹œì— ì°¸ì—¬í•˜ëŠ” ì‹¤ì‹œê°„ í€´ì¦ˆ í”Œë«í¼&lt;/strong> BooQuizë¥¼ Nestë¥¼ ì´ìš©í•´ êµ¬í˜„í–ˆëŠ”ë°ìš”.&lt;/p>
&lt;p>ì„œë²„ì—ì„œ í€´ì¦ˆì˜ ì§„í–‰ì„ ì „ì ìœ¼ë¡œ ë‹´ë‹¹í•˜ëŠ” ì„¤ê³„ë¡œ ì‚¬ìš©ìì˜ ì •ë‹µ ì œì¶œ, ì±„íŒ… ë“±ì˜ ì§€ì†ì ì¸ ìƒí˜¸ì‘ìš©ì´ í•„ìš”í–ˆê¸° ë•Œë¬¸ì— ì›¹ì†Œì¼“ì„ í™œìš©í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>Nestì—ëŠ” ì›¹ì†Œì¼“ì„ &lt;code>ws&lt;/code>ì„ í™œìš©í•˜ëŠ” &lt;code>WsAdapter&lt;/code>, &lt;code>socket.io&lt;/code>ë¥¼ í™œìš©í•˜ëŠ” &lt;code>IoAdapter&lt;/code> ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì œê³µí•˜ëŠ”ë°, ì €í¬ëŠ” &lt;strong>ë§ì€ ì‚¬ìš©ìê°€ ë™ì‹œì— ì—¬ëŸ¬ í€´ì¦ˆì— ì°¸ì—¬&lt;/strong>í•˜ëŠ” ìƒí™©ì—ì„œ &lt;strong>ì„œë²„ì¸¡ì˜ ì§€ì—°ì€ ëª¨ë“  í€´ì¦ˆ ì§„í–‰ì— ì˜í–¥ì„ ì£¼ëŠ” êµ¬ì¡°&lt;/strong>ì—¬ì„œ ë¹ ë¥¸ ì„±ëŠ¥ì„ ì œê³µí•˜ëŠ” &lt;code>ws&lt;/code>ë¥¼ í™œìš©í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>&lt;code>ws&lt;/code>ëŠ” ìµœì†Œí•œì˜ í—¤ë”ë§Œì„ ì‚¬ìš©í•˜ê³ , ë³„ë„ì˜ ì¶”ìƒí™” ë ˆì´ì–´ê°€ ì—†ê¸° ë•Œë¬¸ì— ë¹ ë¥¸ ì„±ëŠ¥ì„ ë³´ì—¬ì£¼ì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ê²ƒ ì™¸ì˜ ê¸°ëŠ¥ì€ ì œê³µí•˜ì§€ ì•Šì•„ ëª¨ë“  ê¸°ëŠ¥ë“¤ì„ ì§ì ‘ êµ¬í˜„í•´ì•¼í–ˆì–´ìš”ğŸ¥²&lt;/p>
&lt;p>íŠ¹íˆ ì„œë²„ëŠ” í€´ì¦ˆ ì§„í–‰ì„ ìœ„í•´ &lt;strong>í€´ì¦ˆì¡´&lt;/strong>ì´ë¼ëŠ” ê°ê°ì˜ ìƒíƒœ ë³€í™”ì— ë”°ë¼ í•´ë‹¹ í€´ì¦ˆì¡´ì— ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ìš©ìì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì£¼ëŠ” &lt;strong>Broadcast&lt;/strong> ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤. &lt;code>socket.io&lt;/code> ê°™ì€ ê²½ìš° &lt;code>room&lt;/code> ì´ë¼ëŠ” ê°œë…ì„ ì´ìš©í•´ì„œ ì œê³µí•˜ì§€ë§Œ, &lt;code>ws&lt;/code>ëŠ” ì œê³µí•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì—­ì‹œ ì§ì ‘ êµ¬í˜„í•´ì•¼í–ˆì–´ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">@WebSocketGateway&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">path&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;/play&amp;#39;&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">PlayGateway&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">OnGatewayInit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@Inject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ClientInfoStorage&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">clients&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">String&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">WebSocketWithSession&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="nx">broadcast&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">clientIds&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">[],&lt;/span> &lt;span class="nx">event&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data?&lt;/span>: &lt;span class="kt">any&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">clientIds&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">clientId&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendToClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">clientId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">event&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="nx">sendToClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">clientId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">event&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data?&lt;/span>: &lt;span class="kt">any&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">socket&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getClientInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">clientId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">event&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="p">}));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>&lt;code>WebSocketWithSession&lt;/code>ì€ ë‹¨ìˆœíˆ websocket ì¸ìŠ¤í„´ìŠ¤ì— ì‚¬ìš©ì ì„¸ì…˜ì„ ë°”ì¸ë”©í•œ ê²ƒ ì…ë‹ˆë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>Map&lt;/code>ì„ ì´ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì˜ ê³ ìœ í•œ IDë¥¼ keyë¡œ Websocket ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ ì €ì¥í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì˜ IDë“¤ì„ ë°›ì•„ ìˆœíšŒí•˜ë©° ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ëŸ¬í•œ êµ¬í˜„ì„ ê¸°ë°˜ìœ¼ë¡œ &lt;code>socket.io&lt;/code>ì˜ &lt;code>room&lt;/code> ê°œë…ì„ ëŒ€ì²´í•  ë‘ ê°€ì§€ ë°©ì‹ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìë“¤ì„ ë³„ë„ë¡œ ê´€ë¦¬&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">@WebSocketGateway&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">path&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;/play&amp;#39;&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">PlayGateway&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">OnGatewayInit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@Inject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ClientInfoStorage&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">clients&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">String&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">ClientInfo&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@Inject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;PlayInfoStorage&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">players&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">string&lt;/span>&lt;span class="err">[]&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* í˜¹ì€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> private readonly players: Map&amp;lt;string, {id: string, socket: WebSocketWithSession}[]&amp;gt;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> private readonly players: Map&amp;lt;string, Map&amp;lt;string, WebSocketWithSession&amp;gt;&amp;gt;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@SubscribeMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;join&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">async&lt;/span> &lt;span class="nx">join&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@ConnectedSocket&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">client&lt;/span>: &lt;span class="kt">WebSocketWithSession&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@MessageBody&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">quizJoinDto&lt;/span>: &lt;span class="kt">QuizJoinDto&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">quizZoneId&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">player&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">playService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">joinQuizZone&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">clients&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">socket&lt;/span>: &lt;span class="kt">client&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">broadcast&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">players&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;someone_join&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">player&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ì²« ë²ˆì§¸ë¡œ ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìë“¤ì„ &lt;code>Gateway&lt;/code>ì—ì„œ ì¶”ê°€ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>ê° í€´ì¦ˆì¡´ì— ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìë“¤ì˜ idë¥¼ í†µí•´ ê° ì—°ê²°ì„ ì°¸ì¡°í•˜ê±°ë‚˜, ì§ì ‘ ì°¸ì¡°í•´ì„œ broadcast ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ íŠ¹ì§•ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ì¥ì 
&lt;ul>
&lt;li>Gatewayì—ì„œ ì™¸ë¶€ ë„ì›€ ì—†ì´ ì‘ë‹µì„ ë³´ë‚¼ ìˆ˜ ìˆìŒ&lt;/li>
&lt;li>ì´ë¡œì¸í•´ ì›¹ì†Œì¼“ ì‘ë‹µì—ë§Œ ì§‘ì¤‘í•  ìˆ˜ ìˆìŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ë‹¨ì 
&lt;ul>
&lt;li>í€´ì¦ˆì¡´ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ìƒíƒœë¥¼ ì¤‘ë³µí•´ì„œ ê´€ë¦¬í•´ì•¼í•¨&lt;/li>
&lt;li>ì´ë¡œì¸í•´ ì°¸ì—¬, í‡´ì¥ ë“±ì´ ë°œìƒí–ˆì„ ë•Œ ë™ê¸°í™”ê°€ í•„ìš”í•¨&lt;/li>
&lt;li>ìš©ëŸ‰ì´ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ìš”ì•½í•˜ë©´ ì›¹ì†Œì¼“ ì²˜ë¦¬ì—ë§Œ ì§‘ì¤‘í• ìˆ˜ ìˆì§€ë§Œ, ì°¸ì—¬ì ì •ë³´ëŠ” ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ API ì‘ë‹µì— í™œìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë³„ë„ ê´€ë¦¬ê°€ í•„ìš”í•˜ê³ , ë™ì¼í•œ ìƒíƒœë¥¼ ë³„ë„ë¡œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë™ê¸°í™” ë“±ì˜ ì²˜ë¦¬ì— ì‹ ê²½ì¨ì•¼í•©ë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>ì‘ë‹µì´ í•„ìš”í•  ë•Œë§ˆë‹¤ ì‚¬ìš©ìë“¤ì˜ ì •ë³´ë¥¼ ì¡°íšŒ&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">@WebSocketGateway&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">path&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;/play&amp;#39;&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">PlayGateway&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">OnGatewayInit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@Inject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ClientInfoStorage&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">clients&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">String&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">ClientInfo&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">playService&lt;/span>: &lt;span class="kt">PlayService&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@SubscribeMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;join&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">async&lt;/span> &lt;span class="nx">join&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@ConnectedSocket&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">client&lt;/span>: &lt;span class="kt">WebSocketWithSession&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@MessageBody&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">quizJoinDto&lt;/span>: &lt;span class="kt">QuizJoinDto&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">SendEventMessage&lt;/span>&lt;span class="err">&amp;lt;&lt;/span>&lt;span class="na">ResponsePlayerDto&lt;/span>&lt;span class="err">[]&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">quizZoneId&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">currentPlayer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">playerIds&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">playService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">joinQuizZone&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* í˜¹ì€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> const currentPlayer = await this.playService.joinQuizZone(quizZoneId, sessionId);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> const playerIds = await this.playService.getQuizZonePlayerIds(quizZoneId);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">clients&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">socket&lt;/span>: &lt;span class="kt">client&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">broadcast&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">playerIds&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;someone_join&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">currentPlayer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ë‘ ë²ˆì§¸ë¡œ í•„ìš”í• ë•Œë§ˆë‹¤ ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ ë„˜ê²¨ì£¼ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>ì˜ˆì‹œì—ì„œ ì£¼ì…ë°›ì€ &lt;code>PlayService&lt;/code>ëŠ” ë³„ë„ë¡œ ë¶„ë¦¬ë˜ì–´ìˆëŠ” &lt;code>QuizZoneService&lt;/code>ë¥¼ í†µí•´ í€´ì¦ˆì¡´ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë°ìš”&lt;/p>
&lt;p>ì´ë¥¼ í†µí•´ì„œ í•„ìš”í•œ ì²˜ë¦¬ë§ˆë‹¤ ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>ì¥ì 
&lt;ul>
&lt;li>ë³„ë„ì˜ ì°¸ì—¬ì ì •ë³´ë“¤ì„ ê´€ë¦¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë™ê¸°í™”ê°€ í•„ìš”ì—†ìŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ë‹¨ì 
&lt;ul>
&lt;li>&lt;code>PlayGateway&lt;/code>ì™€ &lt;code>PlayService&lt;/code>ì˜ ì¢…ë‹¨ ê´€ì‹¬ì‚¬ ê²°í•©&lt;/li>
&lt;li>&lt;code>PlayService&lt;/code>ì™€ &lt;code>QuizZoneService&lt;/code>ì˜ íš¡ë‹¨ ê´€ì‹¬ì‚¬ ê²°í•© ê°•í™”&lt;/li>
&lt;li>&lt;code>QuizZoneService&lt;/code>ì˜ ë¶€í•˜ê°€ ë§ì•„ì§&lt;/li>
&lt;li>ê·¸ë˜ë„ ì›¹ì†Œì¼“ ì—°ê²°ì— ëŒ€í•œ ì •ë³´ë“¤ì€ ê´€ë¦¬í•´ì•¼í•¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ìš”ì•½í•˜ìë©´, broadcastê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ í€´ì¦ˆì¡´ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì°¸ì—¬ì ì •ë³´ë¥¼ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— ê´€ì‹¬ì‚¬ì˜ ê²°í•©ì´ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ, ìƒíƒœê°€ ì´ì›í™”ë˜ì§€ ì•Šì•„ ê´€ë¦¬ ì§€ì ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>ë‘ ì„ íƒì§€ ëª¨ë‘ ë‹¨ì ì´ ë§ì•„ ê³ ë¯¼ì´ ë§ì•˜ëŠ”ë°ìš”. ê²°ê³¼ì ìœ¼ë¡œ ì €í¬ëŠ” ë‘ ë²ˆì§¸ ë°©ì‹ì„ í†µí•´ ì²˜ë¦¬í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>í€´ì¦ˆ ì§„í–‰ì— ë”°ë¼ ì‚¬ìš©ìì˜ ìš”ì²­ ì²˜ë¦¬ ë•Œë¬¸ì— &lt;code>PlayService&lt;/code>ì™€ &lt;code>QuizZoneService&lt;/code>ì˜ ì˜ì¡´ì€ í•„ì—°ì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” êµ¬ì¡°ì˜€ê³ , &lt;code>QuizZoneService&lt;/code>ì˜ ë¶€í•˜ëŠ” ìºì‹± ë“±ì˜ ì²˜ë¦¬ë¡œ ê°œì„ í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³  ì„œë¹„ìŠ¤ë¥¼ ë¶„ë¦¬ë¥¼ ê³ ë ¤í–ˆì„ ë•Œ í˜„ì¬ ì•„í‚¤í…ì²˜ì—ì„œ ì´ì›í™”ëœ ìƒíƒœ ë™ê¸°í™” ë¬¸ì œê°€ ë” í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œë¼ê³  ìƒê°í–ˆì–´ìš”&lt;/p>
&lt;h2 id="ë°œê²¬í•œ-ë¬¸ì œ">ë°œê²¬í•œ ë¬¸ì œ&lt;/h2>
&lt;p>ì²˜ìŒì—ëŠ” ê´œì°®ì•˜ì§€ë§Œ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ì—¬ëŸ¬ ë¬¸ì œë“¤ì´ ë¶€ê°ë˜ê¸° ì‹œì‘í–ˆì–´ìš”ğŸ˜‚&lt;/p>
&lt;p>ì œ íŒë‹¨í•˜ê¸°ì—ëŠ” í¬ê²Œ ì„¸ ê°€ì§€ ì •ë„ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>Gatewayì—ì„œ ëª¨ë“  ì›¹ì†Œì¼“ ì—°ê²°ì— ëŒ€í•´ ì•Œì•„ì•¼í•¨&lt;/strong>&lt;/p>
&lt;p>ì´ì „ì— í™•ì¸í–ˆë˜ ê²ƒ ì²˜ëŸ¼ Gatewayì—ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì„ ì§ì ‘ í™œìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, broadcastë¥¼ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²° ì •ë³´ë¥¼ ìœ ì§€í•´ì•¼í•©ë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ëŠ” ì¶”ê°€ì ì¸ ì €ì¥ ê³µê°„ì„ í•„ìš”ë¡œ í•  ë¿ë§Œ ì•„ë‹ˆë¼, ì„œë¹„ìŠ¤ì—ì„œ í™œìš©ë˜ëŠ” ì‚¬ìš©ìì˜ ì‹ë³„ìì™€ ì›¹ì†Œì¼“ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì—°ê²°í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ì„œë¹„ìŠ¤ ìƒíƒœì™€ ê²°í•©ì´ ìƒê²¼ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆì–´ìš”&lt;/p>
&lt;hr>
&lt;p>&lt;strong>Service ë ˆì´ì–´ì˜ ë§ì€ ì±…ì„&lt;/strong>&lt;/p>
&lt;p>Service ì—ì„œ ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” êµ¬ì¡°ì´ê¸° ë•Œë¬¸ì— ì„œë¹„ìŠ¤ì—ì„œ ê´€ë ¨ ì²˜ë¦¬ë“¤ì´ ì¶”ê°€ë˜ì–´ì•¼í•˜ê³ , ì´ëŠ” ë§ì€ ì±…ì„ê³¼ ë”ë¶ˆì–´ ì½”ë“œê°€ ë¹„ëŒ€í•´ì§€ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>Gatewayì™€ Service ë ˆì´ì–´ì˜ ëª¨í˜¸í•œ ê²½ê³„&lt;/strong>&lt;/p>
&lt;p>ìœ„ì™€ ê°™ì€ ì´ìœ ë¡œ ì‘ë‹µì„ ìœ„í•œ ë°ì´í„° ê°€ê³µí•˜ëŠ” ì²˜ë¦¬ê°€ Gatewayë¡œ ì¡°ê¸ˆì”© ë„˜ì–´ì˜¤ëŠ” ìƒí™©ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ë¡œ ì¸í•´ ì¼ë¶€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë“¤ë„ Gatewayë¡œ ë„˜ì–´ì˜¤ê²Œ ë˜ë©´ì„œ, ì‚¬ìš©ìì—ê²Œ ì‘ë‹µì„ ë‹´ë‹¹í•´ì•¼í•˜ëŠ” Gatewayì˜ ì±…ì„ì´ ì˜¤ì—¼ë˜ê³  ìˆì—ˆì–´ìš”&lt;/p>
&lt;h2 id="ê·¼ë³¸ì ì¸-ì›ì¸ì€">ê·¼ë³¸ì ì¸ ì›ì¸ì€?&lt;/h2>
&lt;p>ì €ëŠ” ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•œ ê·¼ë³¸ì ì¸ ì›ì¸ì´ &lt;strong>ì›¹ì†Œì¼“ ì—°ê²°ì„ í†µí•œ ì‘ë‹µ ì²˜ë¦¬ì—ì„œ í€´ì¦ˆì¡´ì— ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì•Œì•„ì•¼í•˜ëŠ” ê²ƒ&lt;/strong> ìì²´ ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ëŸ¬í•œ ì´ìœ ë¡œ Gatewayì—ì„œ ì›¹ì†Œì¼“ ì—°ê²°ì„ í†µí•´ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì‘ë‹µí•  ë•Œ ì°¸ì—¬ìì˜ ì •ë³´ë¥¼ ì•„ì˜ˆ ê²©ë¦¬ì‹œì¼œì•¼í•  í•„ìš”ì„±ì„ ëŠë¼ê²Œ ë˜ì—ˆì–´ìš”&lt;/p>
&lt;h2 id="ì‚¬ìš©ìì˜-ì •ë³´ë¥¼-ì–´ë–»ê²Œ-ê²©ë¦¬í• ê¹Œ">ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ê²©ë¦¬í• ê¹Œ?&lt;/h2>
&lt;p>ì„œë¹„ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Nê°œì˜ í€´ì¦ˆì¡´ ê°ê°ì— Mëª…ì˜ ì‚¬ìš©ìê°€ ì°¸ì—¬í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì„œë²„ê°€ ì‚¬ìš©ìë“¤ì˜ ë©”ì‹œì§€ë¥¼ ë°›ì•„ í€´ì¦ˆì¡´ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³ , ì§„í–‰ ìƒíƒœì— ë”°ë¼ ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìë“¤ì—ê²Œ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê²Œë©ë‹ˆë‹¤.&lt;/p>
&lt;p>ì •ë¦¬í•˜ë©´, ë‹¤ìˆ˜ì˜ í€´ì¦ˆì¡´ì— ëŒ€í•œ ì§„í–‰ì„ ìœ„í•´ &lt;strong>ì‚¬ìš©ìëŠ” ì„œë²„ì—ê²Œë§Œ ìš”ì²­&lt;/strong>ì„ ë³´ë‚´ê³  &lt;strong>ì„œë²„ëŠ” ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìì—ê²Œ broadcast&lt;/strong> í•˜ëŠ” êµ¬ì¡°ì´ì£ &lt;/p>
&lt;p>ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ì„œë²„ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì—¬ëŸ¬ í€´ì¦ˆì¡´ê³¼ ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìê°€ ì„œë¡œ ëˆ„êµ¬ì¸ì§€ ëª°ë¼ë„ ë˜ê²Œ ë§Œë“œëŠ” ëŒ€í‘œì ì¸ ë°©ë²•ìœ¼ë¡œ &lt;strong>ë°œí–‰-êµ¬ë… íŒ¨í„´&lt;/strong>ì„ ê³ ë ¤í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ë°œí–‰-êµ¬ë…-íŒ¨í„´">ë°œí–‰-êµ¬ë… íŒ¨í„´&lt;/h2>
&lt;p>&lt;img src="https://codemario318.github.io/post/node/pub-sub/1/cover.png"
width="1400"
height="747"
srcset="https://codemario318.github.io/post/node/pub-sub/1/cover_hu468162ba17ce27969b9476abe99e20c1_99229_480x0_resize_box_3.png 480w, https://codemario318.github.io/post/node/pub-sub/1/cover_hu468162ba17ce27969b9476abe99e20c1_99229_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ë°œí–‰-êµ¬ë… íŒ¨í„´"
class="gallery-image"
data-flex-grow="187"
data-flex-basis="449px"
>&lt;/p>
&lt;p>ë°œí–‰-êµ¬ë…(Publish-Subscribe) íŒ¨í„´(ì´í•˜ pub/sub)ì€ ë°œí–‰ì(Publisher)ê°€ ë©”ì‹œì§€ë¥¼ ì§ì ‘ íŠ¹ì • êµ¬ë…ì(Subscriber)ì—ê²Œ ë³´ë‚´ì§€ ì•Šê³ , ì¤‘ê°„ì˜ ë©”ì‹œì§€ ë¸Œë¡œì»¤(ì´ë²¤íŠ¸ ë²„ìŠ¤)ë¥¼ í†µí•´ íŠ¹ì • ì£¼ì œ(Topic)ë‚˜ ì±„ë„ì— ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ë©´, í•´ë‹¹ ì£¼ì œë¥¼ êµ¬ë…í•˜ëŠ” ëª¨ë“  êµ¬ë…ìë“¤ì´ ìë™ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë°›ëŠ” ë””ìì¸ íŒ¨í„´ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>êµ¬ë…ìëŠ” ì£¼ì œë§Œ ì•Œì•„ë„ ë³´ë‚´ëŠ” ëª¨ë“  ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì»´í¬ë„ŒíŠ¸ ê°„ ëŠìŠ¨í•œ ê²°í•©(Loose Coupling)ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì—¬ ì‹œìŠ¤í…œì˜ í™•ì¥ì„±ê³¼ ìœ ì—°ì„±ì´ í–¥ìƒë˜ê³ , ì´ëŠ” ì„œë¹„ìŠ¤ì˜ ì•ˆì •ì ì¸ í™•ì¥ê³¼ ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•´ì§€ëŠ” ê²°ê³¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.&lt;/p>
&lt;p>ê²°ê³¼ì ìœ¼ë¡œ ê·¼ë³¸ì ì¸ ì›ì¸ì¸ &lt;strong>ì›¹ì†Œì¼“ ì—°ê²°ì„ í†µí•œ ì‘ë‹µ ì²˜ë¦¬ì—ì„œ í€´ì¦ˆì¡´ì— ì°¸ì—¬ì¤‘ì¸ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì•Œì•„ì•¼í•˜ëŠ” ë¬¸ì œ&lt;/strong>ë¥¼ ê°œì„ í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í•˜ì—¬ ì ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="ì¸í„°í˜ì´ìŠ¤ì™€-íƒ€ì…-ì„¤ê³„">ì¸í„°í˜ì´ìŠ¤ì™€ íƒ€ì… ì„¤ê³„&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">void&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">Unsubscribe&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">void&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">interface&lt;/span> &lt;span class="nx">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Unsubscribe&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">addPublisher&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">void&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">removePublisher&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">void&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">void&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ì²˜ìŒ ì œê°€ ìƒê°í–ˆì„ë•Œ í•„ìš”í•˜ë‹¤ê³  ìƒê°ë˜ëŠ” ê¸°ëŠ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ì™€ íƒ€ì…ì„ ì„¤ê³„ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³  ê³µí†µì ìœ¼ë¡œ ì œë„¤ë¦­ì„ í™œìš©í•´ ë©”ì‹œì§€ íƒ€ì…ì„ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í•´ë´¤ìŠµë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>&lt;code>MessageHandler&lt;/code> íƒ€ì…: êµ¬ë…ìê°€ ë°œìƒìê°€ ë³´ë‚¼ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜&lt;/li>
&lt;li>&lt;code>Unsubscibe&lt;/code> íƒ€ì…: êµ¬ë… ì·¨ì†Œë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ ì •ì˜&lt;/li>
&lt;li>&lt;code>Broker&lt;/code> ì¸í„°í˜ì´ìŠ¤: ë©”ì‹œì§€ ë¸Œë¡œì»¤ì˜ í•„ìˆ˜ì ì¸ ê¸°ëŠ¥ì„ ì •ì˜
&lt;ul>
&lt;li>&lt;code>addPublisher&lt;/code>: ìƒˆ í¼ë¸”ë¦¬ì…” ì¶”ê°€&lt;/li>
&lt;li>&lt;code>removePublisher&lt;/code>: í¼ë¸”ë¦¬ì…” ì œê±°&lt;/li>
&lt;li>&lt;code>publish&lt;/code>: ë©”ì‹œì§€ ë°œí–‰&lt;/li>
&lt;li>&lt;code>subscribe&lt;/code>: êµ¬ë…ì ë“±ë¡ ë° êµ¬ë… í•´ì œ í•¨ìˆ˜ ë°˜í™˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ íë¦„ìœ¼ë¡œ ì²˜ë¦¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤.&lt;/p>
&lt;ol>
&lt;li>ë°œí–‰ìê°€ ìˆë‹¤ê³  ê°€ì •í•  ë•Œ &lt;code>subscribe&lt;/code>ë¥¼ í†µí•´ êµ¬ë…í•  ë•Œ ì œë„¤ë¦­ìœ¼ë¡œ ì„ ì–¸í•œ í˜•ì‹ì˜ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ìŒ&lt;/li>
&lt;li>&lt;code>publish&lt;/code> ë©”ì„œë“œë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ë°œí–‰. ë‚´ë¶€ì ìœ¼ë¡œ ì €ì¥ëœ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ê°€ ì›í–ˆë˜ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰&lt;/li>
&lt;/ol>
&lt;p>ìµœì´ˆ ì„¤ê³„ì—ì„œ ì¡°ê¸ˆ ì°¨ì´ê°€ ìˆëŠ” ë¶€ë¶„ì€ &lt;code>subscribe&lt;/code> ë©”ì†Œë“œê°€ &lt;code>Unsubsribe&lt;/code> í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤ëŠ” ì  ì¸ë°ìš”&lt;/p>
&lt;p>ì‚¬ìš©í•˜ëŠ” ì˜ì—­ì—ì„œ &lt;code>Broker&lt;/code>ë¥¼ ì§ì ‘ í™œìš©í•˜ì—¬ êµ¬ë… í•´ì œë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒ ë³´ë‹¤, Clean-Up í•¨ìˆ˜ë¥¼ ë³„ë„ë¡œ ì œê³µí•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì´í›„ ììœ ë„ê°€ ë” ë†’ì€ ë°©ì‹ì´ë¼ íŒë‹¨ë˜ì–´ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;h2 id="êµ¬í˜„">êµ¬í˜„&lt;/h2>
&lt;p>ìœ„ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°„ë‹¨í•œ &lt;code>MessageBroker&lt;/code>ë¥¼ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Broker&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;./interfaces/broker.interface&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">MessageHandler&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;./types&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">v4&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">uuidv4&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;uuid&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">interface&lt;/span> &lt;span class="nx">Subscription&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">MessageBroker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">publishers&lt;/span>: &lt;span class="kt">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">Subscription&lt;/span>&lt;span class="err">&amp;lt;&lt;/span>&lt;span class="na">TMessage&lt;/span>&lt;span class="p">&amp;gt;[]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Map&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">addPublisher&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> already exists`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">removePublisher&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscribtionId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">uuidv4&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[...&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">subscriptionId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>&lt;span class="p">}]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ì£¼ìš” ìš”ì†Œë“¤ì„ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;h3 id="subscription-ì¸í„°í˜ì´ìŠ¤">Subscription ì¸í„°í˜ì´ìŠ¤&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">interface&lt;/span> &lt;span class="nx">Subscription&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Subscription&lt;/code>ëŠ” êµ¬ë…ì„ ì˜ë¯¸í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>&lt;code>id&lt;/code>: êµ¬ë…ì˜ ì‹ë³„ì&lt;/li>
&lt;li>&lt;code>handler&lt;/code>: ë°œí–‰í•œ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜&lt;/li>
&lt;/ul>
&lt;p>êµ¬ë… í•´ì œ ë“±ì„ ì²˜ë¦¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— êµ¬ë…ìê°€ ë“±ë¡í•œ í•¸ë“¤ëŸ¬ì— ëŒ€í•´ ì‹ë³„í•  ìˆ˜ ìˆë„ë¡ &lt;code>id&lt;/code>ë¥¼ í¬í•¨í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;h3 id="subscribe-ë©”ì„œë“œ">subscribe ë©”ì„œë“œ&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">MessageBroker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">MessageHandler&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscribtionId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">uuidv4&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[...&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">subscriptionId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handler&lt;/span>&lt;span class="p">}]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">publisherId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subscriptionId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>êµ¬ë…ìê°€ ë°œí–‰ ë°›ì€ ë©”ì‹œì§€ì— ëŒ€í•´ì„œ ì²˜ë¦¬í•´ì•¼í•  í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ ê³¼ì •ì—ì„œ &lt;code>Subscription&lt;/code>ì„ ë§Œë“¤ê²Œ ë˜ëŠ”ë°, êµ¬ë… ìì²´ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ í•œë‹¤ê³  íŒë‹¨í•˜ì—¬, ì‹ë³„ìëŠ” &lt;code>UUID&lt;/code>ë¥¼ ìƒì„±í•˜ì—¬ ì„¤ì •í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” ìµëª… í•¨ìˆ˜ëŠ” êµ¬ë…ì˜ IDë¥¼ í†µí•´ êµ¬ë… í•´ì œë¥¼ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.&lt;/p>
&lt;h3 id="publish-ë©”ì„œë“œ">publish ë©”ì„œë“œ&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">MessageBroker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">public&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">message&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publishers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Publisher with ID &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> does not exist`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">subscriptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">subscription&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ë°œí–‰ìê°€ íŠ¹ì • ë©”ì‹œì§€ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.&lt;/p>
&lt;p>í•´ë‹¹ ë°œí–‰ìì˜ êµ¬ë…ë“¤ì„ í†µí•´ ë“±ë¡ëœ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ê²Œë©ë‹ˆë‹¤.&lt;/p>
&lt;h2 id="í”„ë¡œì íŠ¸-ì ìš©-ì˜ˆì‹œ">í”„ë¡œì íŠ¸ ì ìš© ì˜ˆì‹œ&lt;/h2>
&lt;p>ê¸€ ë§¨ ì•ì— ë¬¸ì œì˜ ì›ì¸ì—ì„œ &lt;code>PlayGateway&lt;/code> ì˜ˆì‹œë¥¼ ê°„ëµíˆ ë³´ì—¬ë“œë ¸ì—ˆëŠ”ë°ìš”. í•´ë‹¹ ì˜ˆì‹œê°€ &lt;code>Broker&lt;/code>ë¥¼ ì ìš©í•˜ë©´ì„œ ì–´ë–»ê²Œ ë°”ë€Œì—ˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>í˜„ì¬ pub/sub ëª¨ë“ˆì„ êµ¬í˜„í•˜ëŠ”ê²Œ ëª©í‘œì—¬ì„œ ê°„ëµí•˜ê³  ë¹ ë¥´ê²Œ ì ìš©í•´ë´¤ì–´ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">@WebSocketGateway&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">path&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;/play&amp;#39;&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">class&lt;/span> &lt;span class="nx">PlayGateway&lt;/span> &lt;span class="kr">implements&lt;/span> &lt;span class="nx">OnGatewayInit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">playService&lt;/span>: &lt;span class="kt">PlayService&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@Inject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Broker&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">private&lt;/span> &lt;span class="kr">readonly&lt;/span> &lt;span class="nx">broker&lt;/span>: &lt;span class="kt">Broker&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">SendEventMessage&lt;/span>&lt;span class="err">&amp;lt;&lt;/span>&lt;span class="na">BroadcastPlayEvent&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">any&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@SubscribeMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;join&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">async&lt;/span> &lt;span class="nx">join&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@ConnectedSocket&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">client&lt;/span>: &lt;span class="kt">WebSocketWithSession&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">@MessageBody&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">quizJoinDto&lt;/span>: &lt;span class="kt">QuizJoinDto&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Promise&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">SendEventMessage&lt;/span>&lt;span class="err">&amp;lt;&lt;/span>&lt;span class="na">PlayEvent&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">ResponsePlayerDto&lt;/span>&lt;span class="err">[]&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">quizZondId&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">nickname&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">playService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">broker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">publish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;someone_join&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sender&lt;/span>: &lt;span class="kt">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">nickname&lt;/span>&lt;span class="p">}});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribePlay&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>í€´ì¦ˆì¡´ì— ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³ , í•´ë‹¹ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì¡´ ì°¸ì—¬ìë“¤ì—ê²Œ ìƒˆë¡œìš´ ì°¸ì—¬ìì˜ ì •ë³´ë¥¼ broadcast í•´ì¤ë‹ˆë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³  ìƒˆë¡œìš´ ì°¸ì—¬ìê°€ í•´ë‹¹ í€´ì¦ˆì¡´ì„ êµ¬ë…í•˜ê²Œ ë©ë‹ˆë‹¤. ë§ì´ ê°„ë‹¨í•´ì§„ ëª¨ìŠµì´ë„¤ìš”ğŸ˜Š&lt;/p>
&lt;p>&lt;code>PlayGateway&lt;/code>ì˜ ìƒì„±ìë¥¼ ì‚´í´ë³´ë©´ ë°œí–‰í•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ &lt;code>SendEventMessage&amp;lt;BroadcastPlayEvent, any&amp;gt;&lt;/code>ë¡œ ì •ì˜í–ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">PlayEvent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">UnicastPlayEvent&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="nx">BroadcastPlayEvent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">UnicastPlayEvent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;join&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;changeNickname&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;submit&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;leave&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">BroadcastPlayEvent&lt;/span> &lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;someone_join&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;someone_leave&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;changeNickname&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;start&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;nextQuiz&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;someone_submit&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;quizTimeOut&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;finish&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;summary&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="s1">&amp;#39;close&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">interface&lt;/span> &lt;span class="nx">SendEventMessage&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TEvent&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="na">TMessage&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">event&lt;/span>: &lt;span class="kt">TEvent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sender&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data&lt;/span>: &lt;span class="kt">TMessage&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>êµ¬ë… ì²˜ë¦¬ì‹œì— ì¸ìë¡œ ë„˜ê²¨ì£¼ëŠ” ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ëŠ” ìœ„ì™€ ê°™ì€ í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë©´ ë©ë‹ˆë‹¤.&lt;/p>
&lt;p>ì´ë¥¼ êµ¬í˜„í•œ &lt;code>subscribePlay&lt;/code> ë©”ì„œë“œëŠ” ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„ë˜ì–´ìˆì–´ìš”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">private&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">subscribePlay&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">client&lt;/span>: &lt;span class="kt">WebSocketWithSession&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">clientId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">broker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">addPublisher&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">unsubscribe&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">broker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">quizZoneId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">event&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s2">&amp;#34;someone_join&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">sender&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">clientId&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s2">&amp;#34;leave&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">unsubscribe&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* ìƒëµ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ì‹¤ì œë¡œëŠ” ë§ì€ ì´ë²¤íŠ¸ë“¤ì„ ì²˜ë¦¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— í›¨ì”¬ ë¹„ëŒ€í•œ ìƒíƒœì—ìš”ğŸ¥² í•¸ë“¤ëŸ¬ê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ì§€ë§Œ ë´ì£¼ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>ë©”ì‹œì§€ì— ì„ ì–¸ëœ ì´ë²¤íŠ¸ì— ë§ê²Œ ì›¹ì†Œì¼“ì„ ì´ìš©í•˜ì—¬ ì‘ë‹µì„ ë³´ë‚´ê²Œ ë©ë‹ˆë‹¤.&lt;/p>
&lt;p>í˜„ì¬ í•¸ë“¤ëŸ¬ê°€ ê°„ë‹¨í•˜ê³  ì§€ì €ë¶„í•˜ê²Œ êµ¬í˜„ë˜ì–´ ìˆê¸´ í•˜ì§€ë§Œ, ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ê°€ ì§„í–‰ëœ ë§Œí¼ ë…ë¦½ì ìœ¼ë¡œ ê°œì„ ë  ìˆ˜ ìˆì„ê²ƒì´ë¼ ê¸°ëŒ€í•˜ê³ ìˆìŠµë‹ˆë‹¤ğŸ˜&lt;/p>
&lt;h2 id="ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬&lt;/h2>
&lt;p>pub/subì„ í™œìš©í•´ì„œ ì„œë¹„ìŠ¤ì—ì„œ ë°œìƒí•  ê²°í•©ì„ ëŠìŠ¨í•˜ê²Œ ë§Œë“¤ì–´ ë´¤ëŠ”ë°ìš”, ë§Œë“  ëª¨ë“ˆì„ ê°„ë‹¨í•˜ê²Œ ì ìš©í•´ë³´ë‹ˆ Gatewayì—ì„œ í€´ì¦ˆì¡´ì´ë‚˜ ì‚¬ìš©ì ì •ë³´ë¥¼ ì „í˜€ ëª¨ë¥´ëŠ” ìƒíƒœë¡œ ì‘ë‹µì„ ë³´ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.&lt;/p>
&lt;p>ë•ë¶„ì— ì´ë¥¼ ì²˜ë¦¬í•  í•¸ë“¤ëŸ¬ ë¡œì§ì´ ë…ë¦½ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì—ˆê³ , ë©”ì‹œì§€ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ì—ë§Œ ì§‘ì¤‘í•´ì„œ ê°œì„ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë„¤ìš”&lt;/p>
&lt;p>ì´ëŸ¬í•œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ë¥¼ í†µí•´ ì˜ì¡´ë˜ëŠ” ìƒíƒœ ë•Œë¬¸ì— ì‹œë„í•˜ì§€ ëª»í–ˆë˜ ë°©ë²•ë“¤ì„ ì ê·¹ì ìœ¼ë¡œ ê³ ë ¤í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ì•ìœ¼ë¡œ ì‹œë„í•´ë³¼ ê²ƒë“¤ì´ ë§ê² ë„¤ìš”&lt;/p>
&lt;p>pub/sub ëª¨ë“ˆ ìì²´ë„ ì•„ì§ ë¶€ì¡±í•œ ë¶€ë¶„ì´ ë§ì•„ ì´í›„ ê¸€ë“¤ì€ ì œê°€ êµ¬í˜„í•œ ëª¨ë“ˆì„ ê³ ë„í™”í•˜ëŠ” ê³¼ì •ë“¤ì„ ë‹´ì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤.&lt;/p>
&lt;p>ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.ğŸ˜Š&lt;/p></description></item></channel></rss>