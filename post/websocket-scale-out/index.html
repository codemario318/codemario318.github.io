<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="웹소켓 시스템의 성능을 개선하려면 어떻게 해야할까?"><title>웹소켓 시스템의 성능 개선하기</title><link rel=canonical href=https://codemario318.github.io/post/websocket-scale-out/><link rel=stylesheet href=/scss/style.min.cbce94e2760d14d60414e59d5a36ab2819232375817e010dbe7be2234b67da1b.css><meta property="og:title" content="웹소켓 시스템의 성능 개선하기"><meta property="og:description" content="웹소켓 시스템의 성능을 개선하려면 어떻게 해야할까?"><meta property="og:url" content="https://codemario318.github.io/post/websocket-scale-out/"><meta property="og:site_name" content="Mario Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="CS"><meta property="article:tag" content="Computer Science"><meta property="article:tag" content="아키텍처"><meta property="article:tag" content="Architecture"><meta property="article:tag" content="웹소켓"><meta property="article:tag" content="WebSocket"><meta property="article:tag" content="수평 확장"><meta property="article:tag" content="Scale Out"><meta property="article:tag" content="Horizontal Scaling"><meta property="article:tag" content="수직 확장"><meta property="article:tag" content="Scale Up"><meta property="article:tag" content="Vertical Scaling"><meta property="article:tag" content="Stateful"><meta property="article:tag" content="Stateless"><meta property="article:published_time" content="2025-01-04T14:57:49+09:00"><meta property="article:modified_time" content="2025-01-04T14:57:49+09:00"><meta property="og:image" content="https://codemario318.github.io/post/websocket-scale-out/cover.png"><meta name=twitter:title content="웹소켓 시스템의 성능 개선하기"><meta name=twitter:description content="웹소켓 시스템의 성능을 개선하려면 어떻게 해야할까?"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codemario318.github.io/post/websocket-scale-out/cover.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-K99591YLGK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K99591YLGK",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3183752545292673" crossorigin=anonymous></script><meta name=naver-site-verification content="2315bde85c86f66092140cc465c340a2170f3187"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu760fd15c5fbb2f30cf0868dc4a5dc41a_14271_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Mario Blog</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/codemario318 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><ul class="menu sub-menu"><li><a href=/categories/backend/><span>Backend</span>
<span class=content-count>3</span></a></li><li><a href=/categories/boostcamp/><span>부스트캠프</span>
<span class=content-count>11</span></a></li><li><a href=/categories/cleancode/><span>Clean Code</span>
<span class=content-count>10</span></a></li><li><a href=/categories/common/><span>Common</span>
<span class=content-count>76</span></a></li><li><a href=/categories/data/><span>Data</span>
<span class=content-count>3</span></a></li><li><a href=/categories/db/><span>DB</span>
<span class=content-count>1</span></a></li><li><a href=/categories/frontend/><span>Frontend</span>
<span class=content-count>10</span></a></li><li><a href=/categories/golang/><span>GoLang</span>
<span class=content-count>13</span></a></li><li><a href=/categories/headfirstdesignpatterns/><span>헤드 퍼스트 디자인 패턴</span>
<span class=content-count>22</span></a></li><li><a href=/categories/infra/><span>Infra</span>
<span class=content-count>14</span></a></li><li><a href=/categories/nest/><span>Nest</span>
<span class=content-count>1</span></a></li><li><a href=/categories/network/><span>네트워크</span>
<span class=content-count>1</span></a></li><li><a href=/categories/node/><span>Node</span>
<span class=content-count>6</span></a></li><li><a href=/categories/others/><span>Others</span>
<span class=content-count>3</span></a></li><li><a href=/categories/problemsolving/><span>Problem Solving</span>
<span class=content-count>1</span></a></li><li><a href=/categories/project/><span>Project</span>
<span class=content-count>5</span></a></li><li><a href=/categories/realmysql/><span>Real MySQL</span>
<span class=content-count>53</span></a></li></ul><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#수평-확장과-수직-확장>수평 확장과 수직 확장</a><ol><li><a href=#수직-확장-scale-up>수직 확장 (Scale Up)</a></li><li><a href=#수평-확장-scale-out>수평 확장 (Scale Out)</a></li></ol></li><li><a href=#웹소켓의-특성>웹소켓의 특성</a></li><li><a href=#로드-밸런싱>로드 밸런싱</a><ol><li><a href=#sticky-sessions-vs-non-sticky-sessions>Sticky Sessions vs Non-Sticky Sessions</a></li></ol></li><li><a href=#서버-간-상태-동기화>서버 간 상태 동기화</a></li><li><a href=#pubsub-패턴-적용>Pub/Sub 패턴 적용</a></li><li><a href=#auto-scaling>Auto Scaling</a><ol><li><a href=#서버-추가>서버 추가</a></li><li><a href=#서버-제거>서버 제거</a></li><li><a href=#zookeeper>ZooKeeper</a></li></ol></li><li><a href=#정리>정리</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/websocket-scale-out/><img src=/post/websocket-scale-out/cover_hu9514b00f9971266d18374bc0654f0c59_139764_800x0_resize_box_3.png srcset="/post/websocket-scale-out/cover_hu9514b00f9971266d18374bc0654f0c59_139764_800x0_resize_box_3.png 800w, /post/websocket-scale-out/cover_hu9514b00f9971266d18374bc0654f0c59_139764_1600x0_resize_box_3.png 1600w" width=800 height=436 loading=lazy alt="Featured image of post 웹소켓 시스템의 성능 개선하기"></a></div><div class=article-details><header class=article-category><a href=/categories/common/ style=background-color:#2a9d8f;color:#fff>Common</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/websocket-scale-out/>웹소켓 시스템의 성능 개선하기</a></h2><h3 class=article-subtitle>웹소켓 시스템의 성능을 개선하려면 어떻게 해야할까?</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2025/01/04</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>7 minute read</time></div></footer></div></header><section class=article-content><p>최근 실시간 다중 사용자 퀴즈 게임을 구현하면서 단순하게 서버 1대와 인메모리(이하 세션)를 이용한 방식으로 웹소켓을 이용해 게임 진행과 채팅 기능을 구현했었는데요.</p><p>당시 부하 테스트 결과로 초당 5,000건 이상의 메시지 처리가 가능했기 때문에, 목표로 했던 300명 이상의 참여자 동시 진행이 가능했습니다.</p><p>하지만 게임에 참여하는 사용자가 많아지면 현재 상황에서는 분명 한계가 있겠죠? 그래서 웹소켓 서버의 처리량을 늘리는 방법들에 대해서 알아보려 합니다.</p><h2 id=수평-확장과-수직-확장>수평 확장과 수직 확장</h2><p><img src=/post/websocket-scale-out/img.png width=1024 height=659 srcset="/post/websocket-scale-out/img_hu1795940aac2814a197193d8fc3eed447_80445_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_hu1795940aac2814a197193d8fc3eed447_80445_1024x0_resize_box_3.png 1024w" loading=lazy alt=img.png class=gallery-image data-flex-grow=155 data-flex-basis=372px></p><p>시스템의 성능을 향상시킬 때 기본적으로 <strong>수평 확장</strong>과 <strong>수직 확장</strong> 두 가지 접근 방식을 고려할 수 있습니다.</p><h3 id=수직-확장-scale-up>수직 확장 (Scale Up)</h3><p>단일 서버의 성능을 향상시키는 방법입니다. CPU, 메모리, 디스크 등 하드웨어 리소스를 증설하여 성능을 개선합니다.</p><ul><li><strong>장점:</strong><ul><li>구현이 간단하며 추가적인 아키텍처 변경이 필요 없음</li><li>단일 서버이므로 데이터 일관성 유지가 쉬움</li><li>네트워크 복잡도가 낮음</li></ul></li><li><strong>단점:</strong><ul><li>하드웨어 비용이 기하급수적으로 증가</li><li>물리적인 한계가 존재</li><li>장애 발생 시 전체 시스템에 영향</li></ul></li></ul><h3 id=수평-확장-scale-out>수평 확장 (Scale Out)</h3><p>동일한 서버를 여러 대 추가하여 부하를 분산시키는 방법입니다.</p><ul><li><strong>장점:</strong><ul><li>선형적인 비용 증가로 효율적</li><li>무한한 확장이 이론적으로 가능</li><li>고가용성과 장애 허용성 확보</li></ul></li><li><strong>단점:</strong><ul><li>아키텍처가 복잡해짐</li><li>데이터 일관성 유지가 어려움</li><li>네트워크 오버헤드 발생</li></ul></li></ul><p>수직 확장은 단순히 서버 스펙을 올리는 것으로 한계가 명확하기 때문에(<del>비싸기 때문에</del>), 수평 확장 위주로 성능을 개선하는 것이 바람직해보입니다.</p><p>이제 수평 확장을 위한 구체적인 방법들을 살펴보겠습니다.</p><h2 id=웹소켓의-특성>웹소켓의 특성</h2><p>먼저 여러 시도를 하기 전 웹소켓의 연결 특성에 대해 이해할 필요가 있습니다.</p><p>웹소켓은 클라이언트와 서버 간에 지속 <strong>연결 상태를 유지</strong>하므로, 수평 확장 시 각 서버에 <strong>클라이언트 연결이 분산</strong>됩니다.</p><p>이를 해결하기 위해 <strong>서버 간 상태를 동기화</strong>하거나 상황에 맞게 클라이언트가 <strong>특정 서버에 고정</strong>되도록 설정해야 합니다.</p><h2 id=로드-밸런싱>로드 밸런싱</h2><p><img src=/post/websocket-scale-out/img_1.png width=1650 height=1275 srcset="/post/websocket-scale-out/img_1_hue58ad55d5fe691e3e59586d3994effac_81538_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_1_hue58ad55d5fe691e3e59586d3994effac_81538_1024x0_resize_box_3.png 1024w" loading=lazy alt="로드 밸런싱" class=gallery-image data-flex-grow=129 data-flex-basis=310px></p><p>수평 확장을 통해 서비스의 요청을 분산하기 위해 여러 대의 서버를 배포하면 실제로 배포된 여러 서버로 요청을 분산해야겠죠</p><p>로드 밸런싱은 들어오는 네트워크 트래픽을 여러 서버에 효율적으로 분산하는 기술입니다.</p><h3 id=sticky-sessions-vs-non-sticky-sessions>Sticky Sessions vs Non-Sticky Sessions</h3><p>네트워크 트래픽을 분산하기 위한 여러 알고리즘이 존재하는데, 클라이언트 요청이 같은 서버로 가는지 아닌지에 따라 나눌 수 있습니다.</p><p><img src=/post/websocket-scale-out/img_2.png width=850 height=400 srcset="/post/websocket-scale-out/img_2_hu00407f29da576d8704b9ee37e577ead4_25051_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_2_hu00407f29da576d8704b9ee37e577ead4_25051_1024x0_resize_box_3.png 1024w" loading=lazy alt="Sticky Sessions vs Non-Sticky Sessions" class=gallery-image data-flex-grow=212 data-flex-basis=510px></p><p>Non-Sticky Sessions은 클라이언트의 요청이 매번 다른 서버로 자유롭게 라우팅될 수 있는 방식으로 stateless 아키텍처를 구현할 때 선호되는 방식입니다.</p><p>주요 차이점을 비교하면:</p><ol><li>상태 관리<ul><li>Sticky Sessions: 서버가 클라이언트의 상태를 메모리에 보관</li><li>Non-Sticky Sessions: 모든 상태를 Redis 같은 외부 저장소에 보관</li></ul></li><li>장애 대응<ul><li>Sticky Sessions: 서버 장애 시 해당 서버의 모든 세션 손실</li><li>Non-Sticky Sessions: 서버 장애와 무관하게 세션 유지 가능</li></ul></li><li>확장성<ul><li>Sticky Sessions: 특정 서버에 부하가 집중될 수 있음</li><li>Non-Sticky Sessions: 더 균등한 부하 분산 가능</li></ul></li></ol><p>웹소켓의 경우 연결 자체가 stateful하기 때문에 일반적으로 Sticky Sessions을 사용하지만, <strong>대규모 시스템</strong>에서는 Non-Sticky Sessions 방식을 채택하고 모든 상태를 외부 저장소에 보관하는 방식을 사용하기도 합니다.</p><h2 id=서버-간-상태-동기화>서버 간 상태 동기화</h2><p>저희 서비스에서는 사용자가 퀴즈존을 기반으로 서버의 세션을 통해 관리되기 때문에, 퀴즈존에 참여하고 있는 모든 사용자가 동일한 서버에 연결되어야 합니다.</p><p>이는 상황에 따라 사용자가 많이 참여하고 있는 퀴즈존이 특정 서버에 집중되는 경우 수평 확장의 장점을 가져갈 수 없게 되는 문제를 발생시킬 수 있습니다.</p><p>이렇게 특정 서버에 세션에 의존하지 않게 만들기 위해 <strong>서버 간의 상태를 동기화</strong> 해야할 필요가 있습니다.</p><p><img src=/post/websocket-scale-out/img_3.png width=385 height=131 srcset="/post/websocket-scale-out/img_3_hufe3d7b7f11325482bb16b822eb0a78ec_8599_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_3_hufe3d7b7f11325482bb16b822eb0a78ec_8599_1024x0_resize_box_3.png 1024w" loading=lazy alt=Redis class=gallery-image data-flex-grow=293 data-flex-basis=705px></p><p>단순히 서버 간의 상태를 동기화 한다면, 모든 사용자에 대한 정보를 모든 서버가 메모리로 가져야하고 이를 수시로 업데이트 해야하는 문제가 있습니다.</p><p>이는 배포된 각각의 서버의 메모리가 충분해야는 것이 기본 전제이므로 메모리로 인한 서버 비용 절감은 의미가 없어질 뿐 아니라 상태 동기화를 위한 여러 오버헤드가 발생하므로 효과적인 방식으로 보긴 어렵습니다.</p><p>그래서 더 단순한 방법으로 배포된 여러 서버가 같은 세션을 바라보게 만드는 방법을 활용하는 경우가 많고, 세션은 빠른 읽기/쓰기가 요구되므로 주로 <code>Redis</code>를 활용합니다.</p><h2 id=pubsub-패턴-적용>Pub/Sub 패턴 적용</h2><p>위처럼 서버 간의 상태를 동기화했다고 하더라도, 웹소켓의 특성상 특정 서버에 연결된 클라이언트에게만 직접 메시지를 전송할 수 있습니다. 다른 서버에 연결된 클라이언트에게는 직접적인 메시지 전송이 불가능한 것이죠.</p><p>이 문제를 해결하기 위해 메시지 브로커를 활용한 Pub/Sub 패턴을 적용할 수 있습니다.</p><p><img src=/post/websocket-scale-out/img_4.png width=2050 height=1168 srcset="/post/websocket-scale-out/img_4_hu3cc9ed0eaf825475f37e7ff59c7a86c6_734061_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_4_hu3cc9ed0eaf825475f37e7ff59c7a86c6_734061_1024x0_resize_box_3.png 1024w" loading=lazy alt="Pub/Sub 패턴" class=gallery-image data-flex-grow=175 data-flex-basis=421px></p><ul><li>각 서버는 메시지 브로커(예: Redis, RabbitMQ, Kafka)의 채널을 구독(Subscribe)</li><li>메시지 전송이 필요할 때는 해당 채널에 메시지를 발행(Publish)</li><li>모든 서버가 메시지를 수신하고, 자신에게 연결된 클라이언트에게 필요한 메시지를 전달</li></ul><p>이러한 방식을 통해 서버 간 직접적인 통신 없이도 모든 클라이언트에게 메시지를 전달할 수 있습니다.</p><h2 id=auto-scaling>Auto Scaling</h2><p>리소스를 효율적으로 관리하기 위해, 트래픽에 따라 서버를 동적으로 확장하고 축소하는 것이 이상적입니다.</p><ul><li>저희 서비스도 근본적으로는 게임이라서 저녁 시간대에 트래픽이 집중되지 않을까 예상해봅니다.</li></ul><p><img src=/post/websocket-scale-out/img_5.png width=560 height=332 srcset="/post/websocket-scale-out/img_5_hu8d0a7bc59b0e5202eca4aab1e4c19efd_27969_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_5_hu8d0a7bc59b0e5202eca4aab1e4c19efd_27969_1024x0_resize_box_3.png 1024w" loading=lazy alt="Auto Scaling" class=gallery-image data-flex-grow=168 data-flex-basis=404px></p><p>하지만 웹소켓 서버의 동적 확장 시에는 몇 가지 고려해야 할 문제들이 있습니다.</p><h3 id=서버-추가>서버 추가</h3><p>새로운 서버가 추가되었을 때, 기존 클라이언트들은 이미 다른 서버들과 연결이 되어있는 상태입니다. 이로 인해 새로운 서버는 새로 접속하는 클라이언트의 연결만 받게 되어 서버 간 부하 분산이 균형있게 이루어지지 않을 수 있습니다.</p><p>이를 해결하기 위해서는 다음과 같은 방법들을 고려할 수 있습니다:</p><ul><li>연결 재분배 (Connection Rebalancing)<ul><li>주기적으로 서버 간 연결 수를 확인하고 불균형이 발생하면 일부 클라이언트에게 재연결 요청</li><li>클라이언트는 재연결 시 로드밸런서를 통해 새로운 서버에 고르게 분배됨</li></ul></li><li>가중치 기반 라우팅<ul><li>새로운 서버에 더 높은 가중치를 부여하여 신규 연결을 더 많이 할당</li><li>점진적으로 서버 간 연결 수가 균형을 이루도록 조정</li></ul></li></ul><h3 id=서버-제거>서버 제거</h3><p>서버를 제거할 때는 해당 서버에 연결된 클라이언트들의 연결을 적절히 처리해야 합니다. 갑작스러운 연결 종료는 사용자 경험을 해칠 수 있으며, 서비스의 안정성에도 영향을 미칩니다.</p><p>이를 위한 해결 방안으로는:</p><ul><li>Draining Mode 구현<ul><li>서버 제거 전에 해당 서버를 &lsquo;draining&rsquo; 상태로 전환</li><li>더 이상 새로운 연결을 받지 않도록 로드밸런서 설정 변경</li><li>기존 연결은 유지하면서 자연스럽게 감소하도록 유도</li></ul></li><li>Graceful Shutdown with Notification<ul><li>종료 예정인 서버의 클라이언트들에게 재연결 필요성을 알리는 메시지 전송</li><li>클라이언트는 메시지 수신 후 다른 서버로 재연결 시도</li><li>일정 시간 후 남아있는 연결을 정상적으로 종료</li></ul></li></ul><h3 id=zookeeper>ZooKeeper</h3><p><img src=/post/websocket-scale-out/img_6.png width=921 height=498 srcset="/post/websocket-scale-out/img_6_hu9638b0602de60e14c3a3201684f97ad9_138457_480x0_resize_box_3.png 480w, /post/websocket-scale-out/img_6_hu9638b0602de60e14c3a3201684f97ad9_138457_1024x0_resize_box_3.png 1024w" loading=lazy alt="Apache ZooKeeper" class=gallery-image data-flex-grow=184 data-flex-basis=443px></p><p>이러한 처리들의 원활한 관리를 위해 서버들의 상태를 효과적으로 관리하고 모니터링하는 것이 중요합니다. Apache ZooKeeper와 같은 도구를 활용하면 이러한 분산 환경에서의 서버 관리를 효율적으로 수행할 수 있습니다.</p><ul><li>서버 상태 관리<ul><li>각 서버는 ZooKeeper에 임시 노드(ephemeral node)를 생성하여 자신의 상태를 등록</li><li>서버 장애 시 노드가 자동으로 삭제되어 빠른 장애 감지 가능</li><li>현재 활성화된 서버 목록을 실시간으로 파악 가능</li></ul></li><li>부하 분산 정보 공유<ul><li>각 서버의 현재 연결 수, 리소스 사용량 등을 ZooKeeper에 저장</li><li>로드밸런서는 이 정보를 바탕으로 최적의 서버 선택 가능</li><li>동적 가중치 조정에 활용</li></ul></li><li>설정 정보 관리<ul><li>서버 구성 정보, 환경 설정 등을 중앙화된 저장소에서 관리</li><li>설정 변경 시 모든 서버에 실시간으로 반영 가능</li><li>일관된 설정 유지 가능</li></ul></li></ul><hr><p><strong>Auto Scaling과의 연계</strong></p><p>ZooKeeper를 Auto Scaling과 연계하면 더욱 효과적인 서버 관리가 가능합니다:</p><ul><li>스케일 인/아웃 이벤트 발생 시 서버 목록 자동 업데이트</li><li>새로운 서버 추가 시 기존 서버들과의 설정 동기화</li><li>서버 제거 시 안전한 종료 절차 조율</li><li>서버 간 부하 분산 상태 모니터링 및 재조정</li></ul><p>이러한 ZooKeeper의 활용은 특히 Auto Scaling 환경에서 서버들의 동적인 변화를 안정적으로 관리하는 데 큰 도움이 될 수 있고, 서버의 추가와 제거가 자주 발생하는 환경에서도 서비스의 안정성과 가용성을 높은 수준으로 유지할 수 있다는 장점도 있습니다.</p><h2 id=정리>정리</h2><p>웹소켓 기반의 실시간 게임 서비스를 확장하면서 발생할 수 있는 문제들과 해결 방안들을 살펴보았습니다.</p><ul><li>서버 확장성 문제<ul><li>수평적 확장을 통한 처리량 증가</li></ul></li><li>상태 관리 문제<ul><li>Redis를 활용한 세션 저장소 외부화</li></ul></li><li>메시지 전달 문제<ul><li>Pub/Sub 패턴 도입</li><li>메시지 브로커를 통한 효율적인 메시지 전파</li></ul></li><li>동적 확장 문제<ul><li>서버의 동적 추가, 제거로 인한 문제</li><li>ZooKeeper 활용</li></ul></li></ul><p>연결이 유지되는 특성 때문에 발생하는 문제들이 많았네요</p><p>어떤 방식들을 적용해야할지 고민을 더 해봐야겠습니다.</p><p>끝까지 읽어주셔서 감사합니다😊</p></section><footer class=article-footer><section class=article-tags><a href=/tags/cs/>CS</a>
<a href=/tags/computer-science/>Computer Science</a>
<a href=/tags/%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/>아키텍처</a>
<a href=/tags/architecture/>Architecture</a>
<a href=/tags/%EC%9B%B9%EC%86%8C%EC%BC%93/>웹소켓</a>
<a href=/tags/websocket/>Websocket</a>
<a href=/tags/%EC%88%98%ED%8F%89-%ED%99%95%EC%9E%A5/>수평 확장</a>
<a href=/tags/scale-out/>Scale Out</a>
<a href=/tags/horizontal-scaling/>Horizontal Scaling</a>
<a href=/tags/%EC%88%98%EC%A7%81-%ED%99%95%EC%9E%A5/>수직 확장</a>
<a href=/tags/scale-up/>Scale Up</a>
<a href=/tags/vertical-scaling/>Vertical Scaling</a>
<a href=/tags/stateful/>Stateful</a>
<a href=/tags/stateless/>Stateless</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/common/architect-orm/><div class=article-image><img src=/post/common/architect-orm/cover.a341852aa054d09154774471ad63c45c_hu4df64d5e24bcaccc3d64e54ad938fd06_127791_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 아키텍처 관점에서 ORM을 사용하는 이유" data-key=common/architect-orm data-hash="md5-o0GFKqBU0JFUd0RxrWPEXA=="></div><div class=article-details><h2 class=article-title>아키텍처 관점에서 ORM을 사용하는 이유</h2></div></a></article><article class=has-image><a href=/post/learning-domain-driven-design/2/><div class=article-image><img src=/post/learning-domain-driven-design/2/cover.ab8639e2d4d8b91c870b9d7f00084c49_huc2e2b54770a897ab187a0f935be3b40b_418378_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 전략적 설계: 도메인 지식 찾아내기" data-key=learning-domain-driven-design/2 data-hash="md5-q4Y54tTYuRyHC51/AAhMSQ=="></div><div class=article-details><h2 class=article-title>전략적 설계: 도메인 지식 찾아내기</h2></div></a></article><article class=has-image><a href=/post/designing-data-intensive-application/3/1/><div class=article-image><img src=/post/designing-data-intensive-application/3/1/cover.da37edb5ab5d5614db18429314b2003a_hu03451f961cb1218aaf8d95eea6944999_534781_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 3.1. 저장소와 검색: 데이터베이스를 강력하게 만드는 데이터 구조" data-key=designing-data-intensive-application/3/1 data-hash="md5-2jfttatdVhTbGEKTFLIAOg=="></div><div class=article-details><h2 class=article-title>3.1. 저장소와 검색: 데이터베이스를 강력하게 만드는 데이터 구조</h2></div></a></article><article class=has-image><a href=/post/learning-domain-driven-design/1/><div class=article-image><img src=/post/learning-domain-driven-design/1/cover.ab8639e2d4d8b91c870b9d7f00084c49_huc2e2b54770a897ab187a0f935be3b40b_418378_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 전략적 설계: 비즈니스 도메인 분석하기" data-key=learning-domain-driven-design/1 data-hash="md5-q4Y54tTYuRyHC51/AAhMSQ=="></div><div class=article-details><h2 class=article-title>전략적 설계: 비즈니스 도메인 분석하기</h2></div></a></article><article class=has-image><a href=/post/designing-data-intensive-application/2/3/><div class=article-image><img src=/post/designing-data-intensive-application/2/3/cover.da37edb5ab5d5614db18429314b2003a_hu03451f961cb1218aaf8d95eea6944999_534781_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 2.3 데이터 모델과 질의 언어 - 그래프형 데이터 모델" data-key=designing-data-intensive-application/2/3 data-hash="md5-2jfttatdVhTbGEKTFLIAOg=="></div><div class=article-details><h2 class=article-title>2.3 데이터 모델과 질의 언어 - 그래프형 데이터 모델</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=codemario318/codemario318.github.io issue-term=pathname label=Comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Mario Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>