<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ë°œí–‰-êµ¬ë… íŒ¨í„´ ê°œì„  ì¼ì§€"><title>3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°</title><link rel=canonical href=https://codemario318.github.io/post/node/pub-sub/3/><link rel=stylesheet href=/scss/style.min.cbce94e2760d14d60414e59d5a36ab2819232375817e010dbe7be2234b67da1b.css><meta property="og:title" content="3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°"><meta property="og:description" content="ë°œí–‰-êµ¬ë… íŒ¨í„´ ê°œì„  ì¼ì§€"><meta property="og:url" content="https://codemario318.github.io/post/node/pub-sub/3/"><meta property="og:site_name" content="Mario Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="íƒ€ì…ìŠ¤í¬ë¦½íŠ¸"><meta property="article:tag" content="Typescript"><meta property="article:tag" content="ë””ìì¸ íŒ¨í„´"><meta property="article:tag" content="Design Pattern"><meta property="article:tag" content="ë°œí–‰-êµ¬ë… íŒ¨í„´"><meta property="article:tag" content="Publish-Subscribe Pattern"><meta property="article:tag" content="Pub-Sub"><meta property="article:tag" content="Pub/Sub"><meta property="article:published_time" content="2025-02-04T10:02:35+09:00"><meta property="article:modified_time" content="2025-02-04T10:02:35+09:00"><meta property="og:image" content="https://codemario318.github.io/post/node/pub-sub/3/cover.png"><meta name=twitter:title content="3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°"><meta name=twitter:description content="ë°œí–‰-êµ¬ë… íŒ¨í„´ ê°œì„  ì¼ì§€"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codemario318.github.io/post/node/pub-sub/3/cover.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-K99591YLGK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K99591YLGK",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3183752545292673" crossorigin=anonymous></script><meta name=naver-site-verification content="2315bde85c86f66092140cc465c340a2170f3187"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu760fd15c5fbb2f30cf0868dc4a5dc41a_14271_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Mario Blog</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/codemario318 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><ul class="menu sub-menu"><li><a href=/categories/backend/><span>Backend</span>
<span class=content-count>3</span></a></li><li><a href=/categories/boostcamp/><span>ë¶€ìŠ¤íŠ¸ìº í”„</span>
<span class=content-count>11</span></a></li><li><a href=/categories/cleancode/><span>Clean Code</span>
<span class=content-count>10</span></a></li><li><a href=/categories/common/><span>Common</span>
<span class=content-count>80</span></a></li><li><a href=/categories/data/><span>Data</span>
<span class=content-count>3</span></a></li><li><a href=/categories/db/><span>DB</span>
<span class=content-count>2</span></a></li><li><a href=/categories/frontend/><span>Frontend</span>
<span class=content-count>10</span></a></li><li><a href=/categories/golang/><span>GoLang</span>
<span class=content-count>13</span></a></li><li><a href=/categories/headfirstdesignpatterns/><span>í—¤ë“œ í¼ìŠ¤íŠ¸ ë””ìì¸ íŒ¨í„´</span>
<span class=content-count>22</span></a></li><li><a href=/categories/infra/><span>Infra</span>
<span class=content-count>14</span></a></li><li><a href=/categories/nest/><span>Nest</span>
<span class=content-count>2</span></a></li><li><a href=/categories/network/><span>ë„¤íŠ¸ì›Œí¬</span>
<span class=content-count>1</span></a></li><li><a href=/categories/node/><span>Node</span>
<span class=content-count>6</span></a></li><li><a href=/categories/others/><span>Others</span>
<span class=content-count>4</span></a></li><li><a href=/categories/problemsolving/><span>Problem Solving</span>
<span class=content-count>1</span></a></li><li><a href=/categories/project/><span>Project</span>
<span class=content-count>5</span></a></li><li><a href=/categories/realmysql/><span>Real MySQL</span>
<span class=content-count>53</span></a></li></ul><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ì–´ë–¤-ë°©ë²•ë“¤ì´-ìˆì„ê¹Œ>ì–´ë–¤ ë°©ë²•ë“¤ì´ ìˆì„ê¹Œ?</a></li><li><a href=#ë”-ê³ ë¯¼í•´ì•¼í• -ë¶€ë¶„ì€>ë” ê³ ë¯¼í•´ì•¼í•  ë¶€ë¶„ì€?</a></li><li><a href=#ì „ì²´-ì•„í‚¤í…ì²˜>ì „ì²´ ì•„í‚¤í…ì²˜</a></li><li><a href=#channelê³¼-repository>Channelê³¼ Repository</a></li><li><a href=#schedulerì™€-scheduletask>Schedulerì™€ ScheduleTask</a></li><li><a href=#channelcleanerì™€-cleanable>ChannelCleanerì™€ Cleanable</a></li><li><a href=#ë§ˆë¬´ë¦¬>ë§ˆë¬´ë¦¬</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/node/pub-sub/3/><img src=/post/node/pub-sub/3/cover_hu468162ba17ce27969b9476abe99e20c1_99229_800x0_resize_box_3.png srcset="/post/node/pub-sub/3/cover_hu468162ba17ce27969b9476abe99e20c1_99229_800x0_resize_box_3.png 800w, /post/node/pub-sub/3/cover_hu468162ba17ce27969b9476abe99e20c1_99229_1600x0_resize_box_3.png 1600w" width=800 height=427 loading=lazy alt="Featured image of post 3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°"></a></div><div class=article-details><header class=article-category><a href=/categories/node/>Node</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/node/pub-sub/3/>3. êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ ê´€ë¦¬í•˜ê¸°</a></h2><h3 class=article-subtitle>ë°œí–‰-êµ¬ë… íŒ¨í„´ ê°œì„  ì¼ì§€</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2025/02/04</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p><a class=link href=/post/node/pub-sub/2/>ì´ì „ ê¸€</a>ì—ì„œ ë°œí–‰-êµ¬ë… íŒ¨í„´ì˜ ì±„ë„ì— ëŒ€í•œ ì˜¤í•´ë¥¼ ë°”ë¡œ ì¡ê³  ì´ë¥¼ ê°œì„ í•´ë´¤ìŠµë‹ˆë‹¤.</p><p>ì´ ê³¼ì •ì„ í†µí•´ íŠ¹ì • ê´€ì‹¬ì‚¬ì¸ ì±„ë„ì„ êµ¬ë…í•˜ê²Œë˜ì–´ ì´ì „ ë³´ë‹¤ ë” ëŠìŠ¨í•œ ê²°í•©ì„ ë‹¬ì„±í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”</p><p>ì´ì™€ ë°˜ëŒ€ë¡œ <code>Broker</code>ì—ì„œ ë°œí–‰ìë¥¼ ê´€ë¦¬í•˜ì§€ ì•Šê²Œ ë˜ì–´ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œë“¤ì´ ì˜ˆìƒë˜ì—ˆìŠµë‹ˆë‹¤.</p><ul><li>ë°œí–‰ìê°€ ë” ì´ìƒ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ì§€ ì•Šì•„ë„ ì±„ë„ì´ ìœ ì§€ë¨</li><li>êµ¬ë…ìê°€ ì—†ì–´ë„ ì±„ë„ì´ í•­ìƒ ìœ ì§€ë¨</li></ul><p>ë°œí–‰ìê°€ ë” ì´ìƒ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ì§€ ì•ŠëŠ” ìƒíƒœì— ëŒ€í•œ ì²˜ë¦¬ëŠ” í™œìš©í•˜ëŠ” êµ¬í˜„ì—ì„œ ê´€ë¦¬í•´ì•¼í•˜ëŠ” ë¬¸ì œì´ì§€ë§Œ, êµ¬ë…ìê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ì±„ë„ì´ ìœ ì§€ë˜ëŠ” ê²ƒì€ ë©”ëª¨ë¦¬ë¥¼ ë‚­ë¹„ í•  ì—¬ì§€ê°€ ìˆì–´ë³´ì´ì£ ?</p><p>ê·¸ë˜ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” ë” ì´ìƒ êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì— ëŒ€í•œ ì •ë¦¬ë¥¼ ì¶”ê°€í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.</p><h2 id=ì–´ë–¤-ë°©ë²•ë“¤ì´-ìˆì„ê¹Œ>ì–´ë–¤ ë°©ë²•ë“¤ì´ ìˆì„ê¹Œ?</h2><p>ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ê°œì„ í•˜ê¸°ìœ„í•´ 2ê°€ì§€ ë°©ë²• ì •ë„ê°€ ë– ì˜¬ëìŠµë‹ˆë‹¤.</p><ul><li>êµ¬ë… í•´ì œí•  ë•Œ, ë” ì´ìƒ êµ¬ë…ìê°€ ì—†ë‹¤ë©´ ì •ë¦¬</li><li>ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì„ ì •ë¦¬</li></ul><p>ì¥ë‹¨ì ì„ ì‚´í´ë³¼ê¹Œìš”?</p><hr><p><strong>êµ¬ë… í•´ì œí•  ë•Œ, ë” ì´ìƒ êµ¬ë…ìê°€ ì—†ë‹¤ë©´ ì •ë¦¬</strong></p><p>ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ êµ¬ë…ìê°€ í•´ë‹¹ ì±„ë„ì„ êµ¬ë… í•´ì œí•  ë•Œ, í˜„ì¬ ë‚¨ì•„ìˆëŠ” êµ¬ë…ìê°€ ìì‹  ë¿ì´ë¼ë©´ ì±„ë„ì„ ì •ë¦¬í•˜ëŠ” ë°©ì‹ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í™œìš©í•˜ê³  ìˆëŠ” Node.jsëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ëŠ” íŠ¹ì„±ìœ¼ë¡œ ì¸í•´, êµ¬ë…ì ëª©ë¡ì„ ì €ì¥í•˜ëŠ” <code>Map</code> ì¸ìŠ¤í„´ìŠ¤ì— ì—¬ëŸ¬ ì²˜ë¦¬ê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ ìì²´ì— ì ‘ê·¼í•˜ëŠ” ë™ì‹œì„± ë¬¸ì œë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ êµ¬í˜„ì´ ì‰½ìŠµë‹ˆë‹¤.</p><p>ë‹¤ë§Œ, ê°ê°ì˜ êµ¬ë…ìì˜ êµ¬ë… í•´ì œ ì²˜ë¦¬ì—ì„œ êµ¬ë…í–ˆë˜ ì±„ë„ì˜ êµ¬ë…ì ëª©ë¡ì„ ê³„ì†í•´ì„œ í™•ì¸í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œê°€ ì¡°ê¸ˆ ë§ì•„ì§€ê³ , ë©”ì„œë“œê°€ ë§ì€ ì—­í• ì„ ë‹´ë‹¹í•˜ê²Œ ë˜ê² ë„¤ìš”</p><p>ê·¸ë¦¬ê³ , êµ¬ë…ì ëª©ë¡ì„ ì •ë¦¬í•œ ì§í›„ì— êµ¬ë… ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ êµ¬ë…ì ëª©ë¡ì„ ë‹¤ì‹œ í• ë‹¹í•´ì¤˜ì•¼í•©ë‹ˆë‹¤. (ì–´ì©”ìˆ˜ ì—†ì–´ ë³´ì´ê¸´ í•˜ë„¤ìš” ğŸ˜‚)</p><hr><p><strong>ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì„ ì •ë¦¬</strong></p><p>ì¡°ê¸ˆ ë” ë³µì¡í•˜ê²Œ ì²˜ë¦¬í•˜ë ¤ë©´, <code>Timmer</code> APIë¥¼ ì´ìš©í•˜ì—¬ ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ëŠ” ë°©ë²•ë„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>êµ¬ë…ì ëª©ë¡ì„ ì €ì¥í•˜ëŠ” <code>Map</code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³„ë„ë¡œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— êµ¬ë… í•´ì œ ì²˜ë¦¬ì—ì„œ ì±„ë„ì„ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•˜ì§€ ì•Šê²Œë˜ì–´ êµ¬ë… í•´ì œ í•œê°€ì§€ ì¼ë§Œ í•˜ê²Œë©ë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ, ì±„ë„ ì •ë¦¬ ì£¼ê¸°ê°€ ë„ˆë¬´ ì§§ë‹¤ë©´ ì˜¤ë²„í—¤ë“œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê³ , ë„ˆë¬´ ê¸¸ë‹¤ë©´ ì •ë¦¬í•˜ëŠ” ì´ë“ì„ ë³´ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ ì§ì ‘ ì£¼ê¸°ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.</p><hr><p>ë‹¤ë¥¸ ì¢‹ì€ ë°©ë²•ë“¤ë„ ìˆê² ì§€ë§Œ, ë‹¹ì¥ì€ ë– ì˜¤ë¥´ì§€ ì•Šë„¤ìš” ğŸ¤£</p><p>ì €ëŠ” ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ ëª¨ë‘ë¥¼ ê³ ë ¤í•´ë³´ê² ìŠµë‹ˆë‹¤. êµ¬ë…ì ëª©ë¡ ê´€ë¦¬ë¥¼ ë³„ë„ë¡œ ë¶„ë¦¬í•˜ì—¬ ë…ë¦½ì ìœ¼ë¡œ ê°œì„  ê°€ëŠ¥í•œ í˜•íƒœë¡œ êµ¬ì„±í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.</p><h2 id=ë”-ê³ ë¯¼í•´ì•¼í• -ë¶€ë¶„ì€>ë” ê³ ë¯¼í•´ì•¼í•  ë¶€ë¶„ì€?</h2><p>ë‹¨ìˆœíˆ ì¼ì • ì‹œê°„ì„ ì£¼ê¸°ë¡œ ì±„ë„ì„ ì •ë¦¬í•œë‹¤ê³  í•´ë„, ìœ„ì—ì„œ ì‚´ì§ ì–¸ê¸‰í–ˆë˜ ë‚´ìš© ì²˜ëŸ¼ ê¸ˆë°© ì •ë¦¬ëœ ì±„ë„ì— ë‹¤ì‹œ êµ¬ë…ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ <strong>ì‹œê°„ ì§€ì—­ì„±</strong>(Temporal Locality)ì„ ê³ ë ¤í•˜ì—¬ ì²˜ë¦¬í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.</p><blockquote><p><strong>ì‹œê°„ ì§€ì—­ì„±(Temporal Locality)?</strong><br>&ldquo;ìµœê·¼ì— ì ‘ê·¼í•œ ë°ì´í„°ë‚˜ ì½”ë“œëŠ” ê°€ê¹Œìš´ ë¯¸ë˜ì— ë‹¤ì‹œ ì ‘ê·¼ë  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.&ldquo;ëŠ” í”„ë¡œê·¸ë¨ì˜ íŠ¹ì„±</p></blockquote><p>ì‹œê°„ ì§€ì—­ì„±ì€ ìºì‹œ, RDBMSì˜ ë²„í¼í’€, OSì˜ í˜ì´ì§€ êµì²´ ì•Œê³ ë¦¬ì¦˜ ë“±ì— í™œìš©ë˜ê³  ìˆëŠ”ë°, ì´ë¥¼ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ í•´ì„í•˜ë©´ ë©”ì‹œì§€ê°€ ë°œí–‰ëœ ì‹œê°„ì´ ì˜¤ë˜ë˜ì—ˆë‹¤ë©´ ì•ìœ¼ë¡œë„ í™œìš©í•˜ì§€ ì•ŠëŠ” ì±„ë„ì´ë¼ëŠ” ê°€ì„¤ì„ ì„¸ìš¸ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?</p><p>ê·¸ë˜ì„œ ì €ëŠ” êµ¬ë…ìê°€ ì—†ëŠ” ì±„ë„ì˜ ë§ˆì§€ë§‰ìœ¼ë¡œ ë©”ì‹œì§€ê°€ ë°œí–‰ëœ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬ë  ìˆ˜ ìˆë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><ul><li>ì œê°€ êµ¬í˜„í•œ pub/subì€ ì¼ë°˜ì ì¸ í™œìš©ì„ ê°€ì •í•˜ê³  ë§Œë“  ëª¨ë“ˆì´ë¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì˜ íŠ¹ì„±ë§ˆë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— í° ì´ë“ì´ ì—†ì„ ìˆ˜ë„ ìˆê³ , ì˜¤íˆë ¤ ì˜¤ë²„í—¤ë“œê°€ ë  ìˆ˜ ìˆì„ ì—¬ì§€ë„ ìˆê² ì§€ë§Œìš” ğŸ¤£</li></ul><h2 id=ì „ì²´-ì•„í‚¤í…ì²˜>ì „ì²´ ì•„í‚¤í…ì²˜</h2><p>ì•ì„œ ë§ì”€ë“œë ¸ë˜ ê²ƒ ì²˜ëŸ¼ ì¼ì • ì£¼ê¸°ë¡œ ì •í•´ì§„ ê¸°ê°„ë™ì•ˆ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì±„ë„ì„ ì •ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.</p><p>ì˜ êµ¬í˜„í•˜ë ¤ê³  í•˜ë‹¤ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ë§ì€ ë³€ê²½ì´ ìˆì—ˆë„¤ìš”</p><p>ì¼ë‹¨ ë³€ê²½ëœ ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ë¨¼ì € ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p><pre class=mermaid style=text-align:center>classDiagram
    class MessageBroker~TMessage~ {
        -repository: ChannelRepository
        -scheduler: Scheduler
        -tasks: ScheduledTask[]
        +subscribe(topic: string, handler: MessageHandler)
        +publish(topic: string, message: TMessage)
    }

    class ChannelRepository~TMessage~ {
        << interface >>
        +findChannelByTopic(topic: string)
        +findAllChannels()
        +deleteChannelByTopic(topic: string)
    }

    class Cleanable {
        << interface >>
        +topic: string
        +lastUpdatedAt: Date
        +subscriberLength: number
    }

    class Subjection~TMessage~ {
        << interface >>
        +publish(message: TMessage)
        +subscribe(handler: MessageHandler)
    }

    class ScheduledTask {
        << interface >>
        +name: string
        +interval: number
        +execute()
    }

    class CleanableChannelRepository {
        << interface >>
        +findAllChannels()
        +deleteChannelByTopic(topic: string)
    }

    class Channel~TMessage~ {
        -subscriptions: Subscription[]
        +topic: string
        +lastUpdatedAt: Date
        +subscriberLength: number
        +publish(message: TMessage)
        +subscribe(handler: MessageHandler)
        -unsubscribe(subscriptionId: string)
    }

    class MemoryChannelRepository~TMessage~ {
        -channels: Map
        +findChannelByTopic(topic: string)
        +findAllChannels()
        +deleteChannelByTopic(topic: string)
    }

    class ChannelCleaner {
        +name: string
        +interval: number
        -staleThreshold: number
        +execute()
        -cleanupChannel(channel: Cleanable)
        -isExpiredChannel(channel: Cleanable)
    }

    class Scheduler {
        -timers: Map
        -runningTasks: Set
        -tasks: ScheduledTask[]
        +registerTask(task: ScheduledTask)
        +unregisterTask(taskName: string)
        +start(taskName: string)
        +startAll()
        +stop(taskName: string)
        +stopAll()
        -executeTask(task: ScheduledTask)
    }

    MessageBroker --> ChannelRepository : uses
    MessageBroker --> Scheduler : uses
    MessageBroker --> ChannelCleaner : uses
    MemoryChannelRepository ..|> ChannelRepository : implements
    Channel ..|> Cleanable : implements
    Channel ..|> Subjection : implements
    ChannelCleaner ..|> ScheduledTask : implements
    MemoryChannelRepository --> Channel : manages
    ChannelCleaner --> CleanableChannelRepository : uses
</pre><p>ì¶”ê°€ëœ ìš”ì†Œë“¤ì´ ë§ë‹¤ë³´ë‹ˆ í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì´ ë„ˆë¬´ ì‘ê²Œ ë³´ì´ë„¤ìš” ğŸ˜‚ í° ë³€ê²½ ì‚¬í•­ë“¤ì„ í†µí•´ ì–´ë– í•œ ë³€í™”ë“¤ì´ ìˆëŠ”ì§€ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p><h2 id=channelê³¼-repository>Channelê³¼ Repository</h2><p>ì¤‘ìš”í•œ ë³€ê²½ì‚¬í•­ìœ¼ë¡œ <code>Channel</code>ì„ ë„ë©”ì¸ìœ¼ë¡œ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p><pre class=mermaid style=text-align:center>classDiagram
    class MessageBroker~TMessage~ {
        -repository: ChannelRepository
        -scheduler: Scheduler
        -tasks: ScheduledTask[]
        +subscribe(topic: string, handler: MessageHandler)
        +publish(topic: string, message: TMessage)
    }
    
    class ChannelRepository~TMessage~ {
        << interface >>
        +findChannelByTopic(topic: string)
        +findAllChannels()
        +deleteChannelByTopic(topic: string)
    }

    class Subjection~TMessage~ {
        << interface >>
        +publish(message: TMessage)
        +subscribe(handler: MessageHandler)
    }

    class Channel~TMessage~ {
        -subscriptions: Subscription[]
        +topic: string
        +lastUpdatedAt: Date
        +subscriberLength: number
        +publish(message: TMessage)
        +subscribe(handler: MessageHandler)
        -unsubscribe(subscriptionId: string)
    }

    class MemoryChannelRepository~TMessage~ {
        -channels: Map
        +findChannelByTopic(topic: string)
        +findAllChannels()
        +deleteChannelByTopic(topic: string)
    }

    MessageBroker --> ChannelRepository : uses
    MemoryChannelRepository ..|> ChannelRepository : implements
    Channel ..|> Subjection : implements
    MemoryChannelRepository --> Channel : manages
</pre><p>ì´ì „ì˜ <code>MessageBroker</code>ëŠ” <code>subscribe</code>ì™€ <code>publish</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ ì„¤ì •í•œ <code>Broker</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜€ëŠ”ë°ìš”</p><p><code>MessageBroker</code> ì—­ì‹œ êµ¬ë…ê³¼ ë°œí–‰ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ì‹¤ì œ êµ¬ë…/ë°œí–‰ì˜ ì£¼ì²´ <code>Channel</code> ì´ë¼ê³  íŒë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ê·¸ë˜ì„œ êµ¬ë…/ë°œí–‰ì— ëŒ€í•œ ì—­í• ì„ <code>Subjection</code> ì¸í„°í˜ì´ìŠ¤ë¡œ ë¶„ë¦¬í•˜ê³  <code>Channel</code> í´ë˜ìŠ¤ê°€ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ ë³€ê²½í•˜ì˜€ì–´ìš”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>Channel</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;</span> <span class=kr>implements</span> <span class=nx>Subjection</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;,</span> <span class=nx>Cleanable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>readonly</span> <span class=nx>topic</span>: <span class=kt>string</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>subscriptions</span>: <span class=kt>Subscription</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;[]</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>_lastUpdatedAt</span>: <span class=kt>Date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=nx>publish</span><span class=p>(</span><span class=nx>message</span>: <span class=kt>TMessage</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>_lastUpdatedAt</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=nx>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>subscriptions</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>subscription</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>subscription</span><span class=p>.</span><span class=nx>handler</span><span class=p>(</span><span class=nx>message</span><span class=p>).</span><span class=k>catch</span><span class=p>((</span><span class=nx>reason</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>reason</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>      <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=nx>subscribe</span><span class=p>(</span><span class=nx>handler</span>: <span class=kt>MessageHandler</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>randomUUID</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>subscription</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>handler</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>unsubscribe</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>unsubscribe</span><span class=p>(</span><span class=nx>id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>subscriptions</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>subscription</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>_lastUpdatedAt</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>subscription</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>unsubscribe</span><span class=p>(</span><span class=nx>subscriptionId</span>: <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>_lastUpdatedAt</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>subscriptions</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>subscriptions</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>subscription</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>id</span> <span class=o>!==</span> <span class=nx>subscriptionId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>get</span> <span class=nx>lastUpdatedAt() {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>_lastUpdatedAt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>get</span> <span class=nx>subscriberLength() {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>subscriptions</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Channel</code>ì˜ CRUDì— ëŒ€í•´ ì—­í•  ë¶„ë¦¬ì™€, ì´í›„ ì‰½ê²Œ ë³€ê²½ ê°€ëŠ¥í•˜ê³  í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ <code>ChannelRepository</code> ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.</p><p>ê·¸ë¦¬ê³  <code>MessageBroker</code>ê°€ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•˜ë„ë¡ í•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ì£¼ì…ë°›ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p><ul><li>ê¸°ì¡´ êµ¬í˜„ì€ <code>ChannelRepository</code>ì˜ êµ¬í˜„ì²´ì¸ <code>MemoryChannelRepository</code>ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>MessageBroker</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>repository</span>: <span class=kt>ChannelRepository</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MemoryChannelRepository</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* ìƒëµ */</span>      
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* ìƒëµ */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=nx>subscribe</span><span class=p>(</span><span class=nx>topic</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>handler</span>: <span class=kt>MessageHandler</span><span class=p>&lt;</span><span class=nt>TMessage</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>findChannelByTopic</span><span class=p>(</span><span class=nx>topic</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>subscribe</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>handler</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>subscribe</span><span class=p>.</span><span class=nx>unsubscribe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=nx>publish</span><span class=p>(</span><span class=nx>topic</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>message</span>: <span class=kt>TMessage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>findChannelByTopic</span><span class=p>(</span><span class=nx>topic</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ì„¸ë¶€ êµ¬í˜„ë“¤ì„ ì£¼ì… ë°›ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— <code>MessageBroker</code>ì˜ êµ¬í˜„ì€ í¬ê²Œ ë°”ë€”ê²ƒì´ ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ì–´ <code>Broker</code> ì¸í„°í˜ì´ìŠ¤ëŠ” ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤.</p><h2 id=schedulerì™€-scheduletask>Schedulerì™€ ScheduleTask</h2><p>ë‹¤ìŒì€ íŠ¹ì • ì‘ì—…ì„ ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤ì¸ <code>Scheduler</code>ì…ë‹ˆë‹¤.</p><pre class=mermaid style=text-align:center>classDiagram
    direction LR
    class MessageBroker~TMessage~ {
        -repository: ChannelRepository
        -scheduler: Scheduler
        -tasks: ScheduledTask[]
        +subscribe(topic: string, handler: MessageHandler)
        +publish(topic: string, message: TMessage)
    }
    
    class ScheduledTask {
        << interface >>
        +name: string
        +interval: number
        +execute()
    }

    class Scheduler {
        -timers: Map
        -runningTasks: Set
        -tasks: ScheduledTask[]
        +registerTask(task: ScheduledTask)
        +unregisterTask(taskName: string)
        +start(taskName: string)
        +startAll()
        +stop(taskName: string)
        +stopAll()
        -executeTask(task: ScheduledTask)
    }

    MessageBroker --> Scheduler : uses
    Scheduler --> ScheduledTask : manages
</pre><p><code>Scheduler</code>ëŠ” <code>ScheduledTask</code> ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì˜ ëª©ë¡ì„ ì´ìš©í•˜ì—¬ ì„¤ì •ëœ ì£¼ê¸°ë¡œ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ”ë°ìš”</p><p><code>ScheduledTask</code>ëŠ” í•´ë‹¹ ì‘ì—…ì— ëŒ€í•œ ì‹ë³„ì„ ìœ„í•œ <code>name</code>ê³¼ ì‹¤í–‰í•  ì£¼ê¸°ì¸ <code>interval</code>ì„ í¬í•¨í•˜ë„ë¡ í•˜ê³ , ì‹¤ì œ ì‹¤í–‰ë  ë™ì‘ì¸ <code>excute()</code>ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><p><code>MessageBroker</code>ì˜ ì´ˆê¸°í™” ê³¼ì •ì—ì„œ ì£¼ì…ë°›ì€ <code>ScheduledTask</code>ë“¤ì„ <code>Scheduler</code>ì— ë“±ë¡í•˜ê³  ì‹¤í–‰ì‹œí‚¤ê²Œë©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>Scheduler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>timers</span>: <span class=kt>Map</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>NodeJS.Timeout</span><span class=p>&gt;</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>runningTasks</span>: <span class=kt>Set</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>tasks</span>: <span class=kt>ScheduledTask</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[])</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>registerTask</span><span class=p>(</span><span class=nx>task</span>: <span class=kt>ScheduledTask</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>t</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>t</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`Task with name </span><span class=si>${</span><span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb> already exists`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>task</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>unregisterTask</span><span class=p>(</span><span class=nx>taskName</span>: <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>stop</span><span class=p>(</span><span class=nx>taskName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>tasks</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>task</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>task</span><span class=p>.</span><span class=nx>name</span> <span class=o>!==</span> <span class=nx>taskName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>start</span><span class=p>(</span><span class=nx>taskName</span>: <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>task</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>task</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>task</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>taskName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>task</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`Task </span><span class=si>${</span><span class=nx>taskName</span><span class=si>}</span><span class=sb> not found`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>timers</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>taskName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>executeTask</span><span class=p>(</span><span class=nx>task</span><span class=p>),</span> <span class=nx>task</span><span class=p>.</span><span class=nx>interval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>timers</span><span class=p>.</span><span class=kr>set</span><span class=p>(</span><span class=nx>taskName</span><span class=p>,</span> <span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>startAll() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>task</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>start</span><span class=p>(</span><span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>stop</span><span class=p>(</span><span class=nx>taskName</span>: <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>timers</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=nx>taskName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>timer</span> <span class=o>!==</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>timers</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>taskName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>stopAll() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>task</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>stop</span><span class=p>(</span><span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>executeTask</span><span class=p>(</span><span class=nx>task</span>: <span class=kt>ScheduledTask</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>runningTasks</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>runningTasks</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=nx>task</span><span class=p>.</span><span class=nx>execute</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>runningTasks</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>task</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Scheduler</code>ê°€ <code>ScheduledTask</code>ë“¤ì„ ì£¼ì…ë°›ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤ë§Œ <code>MessageBroker</code>ì—ì„œë„ <code>ScheduledTask</code>ë“¤ì„ ì£¼ì…ë°›ì•„ ì´ˆê¸°í™”í•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.</p><p>í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° í¸í•˜ê²Œ ë³€ê²½í•˜ë‹¤ë³´ë‹ˆ í•´ë‹¹ êµ¬ì¡°ë¥¼ ë§Œë“¤ê²Œ ë˜ì—ˆëŠ”ë°, ì´ˆê¸°í™” ë°©ë²•ì´ ì—¬ëŸ¬ê°œë¡œ ë¶„ì‚°ë˜ì–´ì„œ ì˜¤íˆë ¤ ë³µì¡í•˜ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ìƒê°ì´ ë“œë„¤ìš”</p><p>ë” ì¢‹ì€ ë°©ë²•ì´ ìˆëŠ”ì§€ ë‹¤ì‹œ ê³ ë¯¼í•´ë´ì•¼ê² ìŠµë‹ˆë‹¤ ğŸ˜</p><h2 id=channelcleanerì™€-cleanable>ChannelCleanerì™€ Cleanable</h2><p>ë‹¤ìŒì€ ì±„ë„ ì •ë¦¬ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆëŠ” <code>ChannelCleaner</code>ì…ë‹ˆë‹¤.</p><pre class=mermaid style=text-align:center>classDiagram
    class Cleanable {
        << interface >>
        +topic: string
        +lastUpdatedAt: Date
        +subscriberLength: number
    }

    class ScheduledTask {
        << interface >>
        +name: string
        +interval: number
        +execute()
    }

    class CleanableChannelRepository {
        << interface >>
        +findAllChannels() Promise~Cleanable[]~
        +deleteChannelByTopic(topic: string)
    }

    class Channel~TMessage~ {
        -subscriptions: Subscription[]
        +topic: string
        +lastUpdatedAt: Date
        +subscriberLength: number
        +publish(message: TMessage)
        +subscribe(handler: MessageHandler)
        -unsubscribe(subscriptionId: string)
    }

    class ChannelCleaner {
        -repository: CleanableChannelRepository
        +name: string
        +interval: number
        -staleThreshold: number
        +execute()
        -cleanupChannel(channel: Cleanable)
        -isExpiredChannel(channel: Cleanable)
    }

    ChannelCleaner ..|> ScheduledTask : implements
    Channel ..|> Cleanable : implements
    CleanableChannelRepository --> Cleanable : manages
    ChannelCleaner --> CleanableChannelRepository : uses
</pre><p><code>ChannelCleaner</code>ëŠ” ì•ì„œ ì–¸ê¸‰í–ˆë˜ <code>ScheduledTask</code>ì˜ êµ¬í˜„ì²´ë¡œ <code>Scheduler</code> ê°€ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ í†µí•´ ì„¤ì •ëœ ê°„ê²©ìœ¼ë¡œ ì±„ë„ ì •ë¦¬ ì‘ì—…ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>interface</span> <span class=nx>ChannelCleanerOption</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>interval?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>staleThreshold?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ChannelCleaner</span> <span class=kr>implements</span> <span class=nx>ScheduledTask</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>readonly</span> <span class=nx>name</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;Cleaner&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>readonly</span> <span class=nx>interval</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>staleThreshold</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>repository</span>: <span class=kt>CleanableChannelRepository</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>options?</span>: <span class=kt>ChannelCleanerOption</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>interval</span> <span class=o>=</span> <span class=nx>options</span><span class=o>?</span><span class=p>.</span><span class=nx>interval</span> <span class=o>??</span> <span class=nx>CLEANUP_INTERVAL_DEFAULT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>staleThreshold</span> <span class=o>=</span> <span class=nx>options</span><span class=o>?</span><span class=p>.</span><span class=nx>staleThreshold</span> <span class=o>??</span> <span class=nx>STALE_THRESHOLD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>public</span> <span class=kr>async</span> <span class=nx>execute() {</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>channels</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>findAllChannels</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=nx>Promise</span><span class=p>.</span><span class=nx>allSettled</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>channels</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>channel</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cleanupChannel</span><span class=p>(</span><span class=nx>channel</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>async</span> <span class=nx>cleanupChannel</span><span class=p>(</span><span class=nx>channel</span>: <span class=kt>Cleanable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isExpiredChannel</span><span class=p>(</span><span class=nx>channel</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>deleteChannelByTopic</span><span class=p>(</span><span class=nx>channel</span><span class=p>.</span><span class=nx>topic</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>isExpiredChannel</span><span class=p>(</span><span class=nx>channel</span>: <span class=kt>Cleanable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>threshold</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=k>this</span><span class=p>.</span><span class=nx>staleThreshold</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>channel</span><span class=p>.</span><span class=nx>subscriberLength</span> <span class=o>===</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=nx>channel</span><span class=p>.</span><span class=nx>lastUpdatedAt</span><span class=p>.</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>&lt;</span> <span class=nx>threshold</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ChannelCleanerOption</code>ì„ í†µí•´ ì‹¤í–‰ ê°„ê²©ê³¼ ì±„ë„ì˜ ìˆ˜ëª…ì„ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p><p><code>isExpiredChannel</code> ë©”ì„œë“œë¥¼ í†µí•´ ì‚­ì œ ë˜ì–´ì•¼ í•  ì¡°ê±´ë“¤ì„ í™•ì¸í•˜ë„ë¡ êµ¬í˜„í–ˆëŠ”ë°, ì¡°ê±´ì´ ë³€ê²½ë  ê²½ìš° í•´ë‹¹ ë©”ì„œë“œì˜ ë³€ê²½ì´ ë¶ˆê°€í”¼í•´ ë³´ì´ë„¤ìš” ğŸ˜…</p><p>ë¯¸ë“¤ì›¨ì–´ ê°™ì€ <strong>ì±…ì„ ì—°ì‡„ íŒ¨í„´</strong>ì„ ì ìš©í•´ë³´ë©´ ì¢‹ì§€ ì•Šì„ê¹Œ ìƒê°ì´ ë“¤ê¸´ í•˜ì§€ë§Œ, ì•„ì§ ì´ë¥¸ ê°ì´ ìˆì–´ ë³´ì—¬ì„œ ë‹¤ìŒ ê¸°íšŒì— ì ìš©í•´ë³´ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.</p><hr><p>ì´ ì½”ë“œì—ì„œ ì¡°ê¸ˆ íŠ¹ì´í•œ ì ì€ <code>ChannelRepository</code>ê°€ ì•„ë‹Œ <code>CleanableChannelRepository</code> ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ë„ë¡ êµ¬ì„±í–ˆë‹¤ëŠ” ì  ì¸ë°ìš”</p><p><code>CleanableChannelRepository</code>ëŠ” <code>Channel</code>ì´ ì•„ë‹Œ <code>Cleanable</code>ì„ ì²˜ë¦¬í•˜ë„ë¡ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤.</p><p>ì•ì„œ <code>Subjection</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•œ <code>Channel</code>í´ë˜ìŠ¤ëŠ” <code>Cleanable</code>ë„ êµ¬í˜„í•˜ë„ë¡ í•˜ê³  ìˆëŠ”ë°, ì´ëŠ” <code>ChannelCleaner</code>ê°€ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚­ì œí•˜ê¸° ìœ„í•œ ê¸°ì¤€ë“¤ì„ í¬í•¨í•˜ë„ë¡ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.</p><p><code>ChannelCleaner</code>ì—ì„œ ê´€ë¦¬í•˜ê²Œ ë  <code>Channal</code>ì— ëŒ€í•´ í˜„ì¬ ì‚­ì œ ê¸°ì¤€ì¸ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œì ì„ ì˜ë¯¸í•˜ëŠ” <code>lastUpdatedAt</code>ê³¼ í˜„ì¬ êµ¬ë…ìë“¤ì˜ ìˆ˜ë¥¼ ì˜ë¯¸í•˜ëŠ” <code>subcriberLength</code>, ê·¸ë¦¬ê³  í•´ë‹¹ ì±„ë„ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•  ìˆ˜ ìˆëŠ” <code>topic</code>ì„ í†µí•´ ì •ë¦¬ë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.</p><p>ê·¸ë¦¬ê³  <code>ChannelCleaner</code>ê°€ <code>Channel</code>ì„ ì§ì ‘ í™œìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆì–´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì¡°ê¸ˆ ë” ê°„ê²°í•´ì§€ëŠ” íš¨ê³¼ë„ ì–»ì„ ìˆ˜ ìˆì—ˆì–´ìš”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;ChannelCleaner&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>repository</span>: <span class=kt>jest.Mocked</span><span class=p>&lt;</span><span class=nt>ChannelRepository</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>cleaner</span>: <span class=kt>ChannelCleaner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>NOW</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>createMockChannel</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>topic?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>lastUpdatedAt?</span>: <span class=kt>Date</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>subscriberLength?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=o>=</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>:</span> <span class=nx>Channel</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>topic</span>: <span class=kt>props.topic</span> <span class=o>??</span> <span class=s1>&#39;test-topic&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>lastUpdatedAt</span>: <span class=kt>props.lastUpdatedAt</span> <span class=o>??</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>NOW</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>subscriberLength</span>: <span class=kt>props.subscriberLength</span> <span class=o>??</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span> <span class=kr>as</span> <span class=nx>Channel</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>jest</span><span class=p>.</span><span class=nx>spyOn</span><span class=p>(</span><span class=nb>Date</span><span class=p>,</span> <span class=s1>&#39;now&#39;</span><span class=p>).</span><span class=nx>mockReturnValue</span><span class=p>(</span><span class=nx>NOW</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>repository</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>findChannelByTopic</span>: <span class=kt>jest.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>(</span><span class=kc>undefined</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>findAllChannels</span>: <span class=kt>jest.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>([]),</span>
</span></span><span class=line><span class=cl>        <span class=nx>deleteChannelByTopic</span>: <span class=kt>jest.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>(</span><span class=kc>undefined</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>cleaner</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ChannelCleaner</span><span class=p>(</span><span class=nx>repository</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>interval</span>: <span class=kt>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>staleThreshold</span>: <span class=kt>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/* ìƒëµ */</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>ìœ„ ì½”ë“œëŠ” <code>Channel</code>ì„ í™œìš©í•  ë•Œ í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤.</p><p>ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì œê°€ ìƒê°í•œ ë¬¸ì œëŠ” í™œìš©í•˜ì§€ ì•ŠëŠ” ë©”ì„œë“œì™€ ìš”ì†Œê¹Œì§€ ëª¨í‚¹í•´ì•¼í•œë‹¤ëŠ” ì  ì´ì—ˆì–´ìš”</p><p>ë³´ì‹œëŠ” ê²ƒ ì²˜ëŸ¼ <code>ChannelRepository</code>ë¥¼ ëª¨í‚¹í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” <code>findChannelByTopic</code> ë©”ì„œë“œë¥¼ ëª¨í‚¹í•´ì•¼í–ˆê³ ,</p><p><code>Channel</code>ì„ ìƒì„±í•˜ëŠ” í•¼í¼ í•¨ìˆ˜ <code>createMockChannel</code> ë˜í•œ ë¶ˆí•„ìš”í•œ ìš”ì†Œë“¤ì„ ëª¨ë‘ êµ¬í˜„í•˜ì§€ ì•Šê¸° ìœ„í•´ íƒ€ì… ë‹¨ì–¸ì„ í™œìš©í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ ë¶€ë¶„ì´ ë¶ˆí•„ìš”í•œ ë¶€ë¶„ì— ì˜ì¡´ë˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“ ë‹¤ê³  ìƒê°í–ˆì–´ìš”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;ChannelCleaner&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>repository</span>: <span class=kt>jest.Mocked</span><span class=p>&lt;</span><span class=nt>CleanableChannelRepository</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>cleaner</span>: <span class=kt>ChannelCleaner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>NOW</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>createMockCleanable</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>topic?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>lastUpdatedAt?</span>: <span class=kt>Date</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>subscriberLength?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=o>=</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span><span class=o>:</span> <span class=nx>Cleanable</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>topic</span>: <span class=kt>props.topic</span> <span class=o>??</span> <span class=s1>&#39;test-topic&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>lastUpdatedAt</span>: <span class=kt>props.lastUpdatedAt</span> <span class=o>??</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>NOW</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>subscriberLength</span>: <span class=kt>props.subscriberLength</span> <span class=o>??</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>beforeEach</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jest</span><span class=p>.</span><span class=nx>spyOn</span><span class=p>(</span><span class=nb>Date</span><span class=p>,</span> <span class=s1>&#39;now&#39;</span><span class=p>).</span><span class=nx>mockReturnValue</span><span class=p>(</span><span class=nx>NOW</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>repository</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>findAllChannels</span>: <span class=kt>jest.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>([]),</span>
</span></span><span class=line><span class=cl>      <span class=nx>deleteChannelByTopic</span>: <span class=kt>jest.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>(</span><span class=kc>undefined</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>cleaner</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ChannelCleaner</span><span class=p>(</span><span class=nx>repository</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>interval</span>: <span class=kt>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>staleThreshold</span>: <span class=kt>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=cm>/* ìƒëµ */</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>ì´ëŸ¬í•œ ì´ìœ ë¡œ <code>Channel</code> í´ë˜ìŠ¤ê°€ <code>Cleanable</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ëŠ” ë™ì‹œì— <code>CleanableChannelRepository</code>ë¥¼ í†µí•´ í•„ìš”í•œ ë©”ì„œë“œë§Œ í˜¸ì¶œë˜ë„ë¡ í•˜ì—¬ íƒ€ì… ë‹¨ì–¸ì´ë‚˜ ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„ ì œê±°í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ êµ¬ì¡°ë¡œ ì¸í•´ ê´€ë¦¬í•´ì•¼í•  ì¸í„°í˜ì´ìŠ¤ê°€ ëŠ˜ì–´ë‚˜ê¸´ í•˜ì§€ë§Œ <code>Channel</code>ì— ëœ ì˜ì¡´ì ì¸ ì½”ë“œê°€ ë” ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì—¬ ì ìš©í–ˆìŠµë‹ˆë‹¤.</p><h2 id=ë§ˆë¬´ë¦¬>ë§ˆë¬´ë¦¬</h2><p>ì´ë²ˆì—ëŠ” ê¸°ì¡´ pub/sub ê¸°ëŠ¥ì— <strong>êµ¬ë…ìê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ì˜¤ëœ ì‹œê°„ ìœ ì§€ëœ ì±„ë„</strong>ì€ ì•ìœ¼ë¡œë„ êµ¬ë…ìê°€ ì—†ì„ ê²ƒ ì´ë¼ëŠ” ê°€ì •ì„ ê¸°ë°˜ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ëŠ¥ì„ ë„ì…í•´ë´¤ìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ ìœ„í•´ ì¼ì • ì£¼ê¸°ë¡œ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” <code>Schduler</code>ê³¼ ê²€ì¦ ì¡°ê±´ì„ í†µí•´ ì±„ë„ì„ ì‚­ì œí•˜ëŠ” ì—­í• ì„ <code>ChannelCleaner</code>ë¡œ êµ¬í˜„í•˜ì—¬ ì±…ì„ì„ ìµœëŒ€í•œ ë¶„ë¦¬í•´ë³´ë ¤ ì‹œë„í•˜ì˜€ìŠµë‹ˆë‹¤.</p><p>ì´ ê³¼ì •ì—ì„œ ì£¼ìš” ê´€ì‹¬ì‚¬ì¸ <code>Channel</code>ì„ ë¶„ë¦¬í•˜ì—¬ ì²˜ë¦¬ íë¦„ì´ ë”ìš± ëª…í™•íˆ ë³´ì´ë„ë¡ í–ˆê³ , <code>Subjection</code>ê³¼ <code>Cleanable</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ì—¬ ë™ì‘ì„ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ë ¤ í•´ë´¤ë„¤ìš”</p><p><code>Scheduler</code>ì—ì„œ ê´€ë¦¬ë  ì‘ì—…ë“¤ì„ <code>SchduledTask</code> ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•˜ì—¬ ì¼ì • ì£¼ê¸°ë¡œ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í–ˆê³ , <code>ChannelCleaner</code>ê°€ <code>SchduledTask</code>ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•˜ì—¬ ì„¤ì •í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ ë§Œë“¤ê³  ì •ë¦¬í•˜ë‹¤ë³´ë‹ˆ ê¸°ëŠ¥ì— ë¹„í•´ ë„ˆë¬´ ë¹„ëŒ€í•œ ì½”ë“œê°€ ëœ ê²ƒì´ ì•„ë‹Œê°€ ì‹¶ê¸°ë„ í•˜ê³ , ì•„ì‰¬ìš´ ì ë„ ì¡°ê¸ˆì”© ë³´ì´ë„¤ìš”ğŸ˜…</p><p>ì•„ì§ ì™„ì„±ëœ ê²ƒì€ ì•„ë‹ˆë‹ˆ ê³„ì†í•´ì„œ ì¡°ê¸ˆì”© ê°œì„ í•´ ë‚˜ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤! ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.ğŸ˜Š (ë‹¤ìŒ ìˆœì„œëŠ” ì‹¤íŒ¨ ë©”ì‹œì§€ ì¬ë°œì†¡ ê´€ë ¨ ê°œì„ ì„ í•´ë³´ë ¤ê³  í•´ìš”)</p></section><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
</script><footer class=article-footer><section class=article-tags><a href=/tags/%ED%83%80%EC%9E%85%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8/>íƒ€ì…ìŠ¤í¬ë¦½íŠ¸</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/%EB%94%94%EC%9E%90%EC%9D%B8-%ED%8C%A8%ED%84%B4/>ë””ìì¸ íŒ¨í„´</a>
<a href=/tags/design-pattern/>Design Pattern</a>
<a href=/tags/%EB%B0%9C%ED%96%89-%EA%B5%AC%EB%8F%85-%ED%8C%A8%ED%84%B4/>ë°œí–‰-êµ¬ë… íŒ¨í„´</a>
<a href=/tags/publish-subscribe-pattern/>Publish-Subscribe Pattern</a>
<a href=/tags/pub-sub/>Pub-Sub</a>
<a href=/tags/pub/sub/>Pub/Sub</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class="article-list--compact links"><article><a href=https://github.com/codemario318/m-pub-sub target=_blank rel=noopener><div class=article-details><h2 class=article-title>Github</h2><footer class=article-time>https://github.com/codemario318/m-pub-sub</footer></div></a></article><article><a href=https://github.com/codemario318/m-pub-sub/pull/2 target=_blank rel=noopener><div class=article-details><h2 class=article-title>PR</h2><footer class=article-time>https://github.com/codemario318/m-pub-sub/pull/2</footer></div></a></article><article><a href=/post/node/pub-sub/2/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>2. ë°œí–‰-êµ¬ë… íŒ¨í„´ì—ì„œ ë°œí–‰ìëŠ” ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œ?</h2><footer class=article-time>ë°œí–‰-êµ¬ë… íŒ¨í„´ ê°œì„  ì¼ì§€</footer></div></a></article></div><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/node/pub-sub/4/><div class=article-image><img src=/post/node/pub-sub/4/cover.3c061cec1a9218c0c4cd7f4e24a0c4d0_hu468162ba17ce27969b9476abe99e20c1_99229_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 4. ë°œì†¡ ì‹¤íŒ¨í•œ ë©”ì‹œì§€ ë‹¤ì‹œ ë³´ë‚´ê¸°" data-key=/node/pub-sub/4 data-hash="md5-PAYc7BqSGMDEzX9OJKDE0A=="></div><div class=article-details><h2 class=article-title>4. ë°œì†¡ ì‹¤íŒ¨í•œ ë©”ì‹œì§€ ë‹¤ì‹œ ë³´ë‚´ê¸°</h2></div></a></article><article class=has-image><a href=/post/node/pub-sub/2/><div class=article-image><img src=/post/node/pub-sub/2/cover.3c061cec1a9218c0c4cd7f4e24a0c4d0_hu468162ba17ce27969b9476abe99e20c1_99229_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 2. ë°œí–‰-êµ¬ë… íŒ¨í„´ì—ì„œ ë°œí–‰ìëŠ” ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œ?" data-key=/node/pub-sub/2 data-hash="md5-PAYc7BqSGMDEzX9OJKDE0A=="></div><div class=article-details><h2 class=article-title>2. ë°œí–‰-êµ¬ë… íŒ¨í„´ì—ì„œ ë°œí–‰ìëŠ” ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œ?</h2></div></a></article><article class=has-image><a href=/post/node/pub-sub/1/><div class=article-image><img src=/post/node/pub-sub/1/cover.3c061cec1a9218c0c4cd7f4e24a0c4d0_hu468162ba17ce27969b9476abe99e20c1_99229_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 1. ë°œí–‰-êµ¬ë… íŒ¨í„´ì„ í†µí•´ ê²°í•©ì„ ê°œì„ í•´ë³´ì" data-key=/node/pub-sub/1 data-hash="md5-PAYc7BqSGMDEzX9OJKDE0A=="></div><div class=article-details><h2 class=article-title>1. ë°œí–‰-êµ¬ë… íŒ¨í„´ì„ í†µí•´ ê²°í•©ì„ ê°œì„ í•´ë³´ì</h2></div></a></article><article class=has-image><a href=/post/node/timer-mocks/><div class=article-image><img src=/post/node/timer-mocks/cover.21767fc5165e3141b2bb1e885b3670c7_hu7fc001c9d5df8010367652495ae61bd0_46763_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post FakeTimersë¡œ íƒ€ì´ë¨¸ API í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì" data-key=node/timer-mocks data-hash="md5-IXZ/xRZeMUGyux6IWzZwxw=="></div><div class=article-details><h2 class=article-title>FakeTimersë¡œ íƒ€ì´ë¨¸ API í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì</h2></div></a></article><article class=has-image><a href=/post/jest-unit-test/><div class=article-image><img src=/post/jest-unit-test/cover.21767fc5165e3141b2bb1e885b3670c7_hu7fc001c9d5df8010367652495ae61bd0_46763_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post Jestë¥¼ í™œìš©í•œ ìœ ë‹› í…ŒìŠ¤íŠ¸" data-key=jest-unit-test data-hash="md5-IXZ/xRZeMUGyux6IWzZwxw=="></div><div class=article-details><h2 class=article-title>Jestë¥¼ í™œìš©í•œ ìœ ë‹› í…ŒìŠ¤íŠ¸</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=codemario318/codemario318.github.io issue-term=pathname label=Comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Mario Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>