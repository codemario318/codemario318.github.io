<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="프로그래밍은 과학보다 공예에 가깝다. 깨끗한 코드를 짜려면 먼저 지저분한 코드를 짠 뒤에 정리해야 한다. Args 구현 명령행 인수 구문을 분석하기 위한 클래스인 Args 클래스"><title>클린코드: 14. 점진적인 개선</title><link rel=canonical href=https://codemario318.github.io/post/clean-code/14/><link rel=stylesheet href=/scss/style.min.cbce94e2760d14d60414e59d5a36ab2819232375817e010dbe7be2234b67da1b.css><meta property="og:title" content="클린코드: 14. 점진적인 개선"><meta property="og:description" content="프로그래밍은 과학보다 공예에 가깝다. 깨끗한 코드를 짜려면 먼저 지저분한 코드를 짠 뒤에 정리해야 한다. Args 구현 명령행 인수 구문을 분석하기 위한 클래스인 Args 클래스"><meta property="og:url" content="https://codemario318.github.io/post/clean-code/14/"><meta property="og:site_name" content="Mario Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Common"><meta property="article:published_time" content="2023-04-21T11:00:13+09:00"><meta property="article:modified_time" content="2023-04-21T11:00:13+09:00"><meta property="og:image" content="https://codemario318.github.io/post/clean-code/14/clean_code_cover.jpeg"><meta name=twitter:title content="클린코드: 14. 점진적인 개선"><meta name=twitter:description content="프로그래밍은 과학보다 공예에 가깝다. 깨끗한 코드를 짜려면 먼저 지저분한 코드를 짠 뒤에 정리해야 한다. Args 구현 명령행 인수 구문을 분석하기 위한 클래스인 Args 클래스"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codemario318.github.io/post/clean-code/14/clean_code_cover.jpeg"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu760fd15c5fbb2f30cf0868dc4a5dc41a_14271_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Mario Blog</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/codemario318 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><ul class="menu sub-menu"><li><a href=/categories/backend/><span>Backend</span>
<span class=content-count>3</span></a></li><li><a href=/categories/cleancode/><span>Clean Code</span>
<span class=content-count>10</span></a></li><li><a href=/categories/common/><span>Common</span>
<span class=content-count>4</span></a></li><li><a href=/categories/data/><span>Data</span>
<span class=content-count>3</span></a></li><li><a href=/categories/db/><span>DB</span>
<span class=content-count>1</span></a></li><li><a href=/categories/frontend/><span>Frontend</span>
<span class=content-count>10</span></a></li><li><a href=/categories/golang/><span>GoLang</span>
<span class=content-count>13</span></a></li><li><a href=/categories/headfirstdesignpatterns/><span>헤드 퍼스트 디자인 패턴</span>
<span class=content-count>5</span></a></li><li><a href=/categories/infra/><span>Infra</span>
<span class=content-count>14</span></a></li><li><a href=/categories/problemsolving/><span>Problem Solving</span>
<span class=content-count>1</span></a></li><li><a href=/categories/project/><span>Project</span>
<span class=content-count>3</span></a></li><li><a href=/categories/realmysql/><span>Real MySQL</span>
<span class=content-count>53</span></a></li></ul><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#args-구현>Args 구현</a></li><li><a href=#args-1차-초안>Args: 1차 초안</a><ol><li><a href=#문제점>문제점</a></li><li><a href=#boolean만-지원하는-argsjava>Boolean만 지원하는 Args.java</a></li><li><a href=#boolean과-string을-지원하는-argsjava>Boolean과 String을 지원하는 Args.java</a></li></ol></li><li><a href=#그래서-멈췄다>그래서 멈췄다.</a></li><li><a href=#점진적으로-개선하다>점진적으로 개선하다.</a><ol><li><a href=#argumentmarshaler><code>ArgumentMarshaler</code></a></li><li><a href=#string-인수-추가>String 인수 추가</a></li><li><a href=#추상클래스를-이용한-분리>추상클래스를 이용한 분리</a></li><li><a href=#get>get</a></li><li><a href=#argumentmarshaler-검증>ArgumentMarshaler 검증</a></li></ol></li><li><a href=#args-통합>Args 통합</a><ol><li><a href=#hashmap-통합>HashMap 통합</a></li><li><a href=#setargument>setArgument</a></li></ol></li><li><a href=#결론>결론</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/clean-code/14/><img src=/post/clean-code/14/clean_code_cover_hud03d003727d53e154227b4e2dbea4cfd_18319_800x0_resize_q75_box.jpeg srcset="/post/clean-code/14/clean_code_cover_hud03d003727d53e154227b4e2dbea4cfd_18319_800x0_resize_q75_box.jpeg 800w, /post/clean-code/14/clean_code_cover_hud03d003727d53e154227b4e2dbea4cfd_18319_1600x0_resize_q75_box.jpeg 1600w" width=800 height=1053 loading=lazy alt="Featured image of post 클린코드: 14. 점진적인 개선"></a></div><div class=article-details><header class=article-category><a href=/categories/cleancode/>Clean Code</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/clean-code/14/>클린코드: 14. 점진적인 개선</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2023/04/21</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>15 minute read</time></div></footer></div></header><section class=article-content><blockquote><p>프로그래밍은 과학보다 공예에 가깝다. 깨끗한 코드를 짜려면 먼저 지저분한 코드를 짠 뒤에 정리해야 한다.</p></blockquote><h2 id=args-구현>Args 구현</h2><p>명령행 인수 구문을 분석하기 위한 클래스인 <code>Args</code> 클래스 개선을 예시로 확인해본다.</p><blockquote><p>Marshalling(마샬링): 객체의 메모리에서 표현방식을 저장 또는 전송에 적합한 다른 데이터 형식으로 변환하는 과정이다.</p></blockquote><h2 id=args-1차-초안>Args: 1차 초안</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.text.ParseException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Args</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>valid</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>unexpectedArguments</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;</span> <span class=n>booleanArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>stringArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>intArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>argsFound</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>currentArgument</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>char</span> <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>errorParameter</span> <span class=o>=</span> <span class=s>&#34;TILT&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ErrorCode</span> <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>OK</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>enum</span> <span class=n>ErrorCode</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OK</span><span class=o>,</span> <span class=n>MISSING_STRING</span><span class=o>,</span> <span class=n>MISSING_INTEGER</span><span class=o>,</span> <span class=n>INVALID_INTEGER</span><span class=o>,</span> <span class=n>UNEXPECTED_ARGUMENT</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Args</span><span class=o>(</span><span class=n>String</span> <span class=n>schema</span><span class=o>,</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>schema</span> <span class=o>=</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>args</span> <span class=o>=</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=n>parse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parse</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>parseSchema</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArguments</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseSchema</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>element</span> <span class=o>:</span> <span class=n>schema</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;,&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>element</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>String</span> <span class=n>trimmedElement</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>trim</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>parseSchemaElement</span><span class=o>(</span><span class=n>trimmedElement</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>element</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>elementId</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>elementTail</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>validateSchemaElementId</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isBooleanSchemaElement</span><span class=o>(</span><span class=n>elementTail</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseBooleanSchemaElement</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isStringSchemaElement</span><span class=o>(</span><span class=n>elementTail</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseStringSchemaElement</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isIntegerSchemaElement</span><span class=o>(</span><span class=n>elementTail</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parseIntegerSchemaElement</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ParseException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Argument: %c has invalid format: %s.&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>elementId</span><span class=o>,</span> <span class=n>elementTail</span><span class=o>),</span>
</span></span><span class=line><span class=cl>                    <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>validateSchemaElementId</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>Character</span><span class=o>.</span><span class=na>isLetter</span><span class=o>(</span><span class=n>elementId</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ParseException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Bad character:&#34;</span> <span class=o>+</span> <span class=n>elementId</span> <span class=o>+</span> <span class=s>&#34;in Args format: &#34;</span> <span class=o>+</span> <span class=n>schema</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseBooleanSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseIntegerSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>intArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseStringSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isStringSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>elementTail</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;*&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBooleanSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>elementTail</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>elementTail</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isIntegerSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>elementTail</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;#&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseArguments</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>currentArgument</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>currentArgument</span> <span class=o>&lt;</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>currentArgument</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>arg</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>];</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArgument</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseArgument</span><span class=o>(</span><span class=n>String</span> <span class=n>arg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;-&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseElements</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseElements</span><span class=o>(</span><span class=n>String</span> <span class=n>arg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>arg</span><span class=o>.</span><span class=na>length</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>parseElement</span><span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>setArgument</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>argsFound</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>unexpectedArguments</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>UNEXPECTED_ARGUMENT</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isBooleanArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isStringArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>setStringArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isIntArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>setIntArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isIntArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>intArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setIntArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>currentArgument</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>parameter</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parameter</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>];</span>
</span></span><span class=line><span class=cl>            <span class=n>intArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=k>new</span> <span class=n>Integer</span><span class=o>(</span><span class=n>parameter</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArrayIndexOutOfBoundsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorParameter</span> <span class=o>=</span> <span class=n>parameter</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>INVALID_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setStringArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>currentArgument</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>stringArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArrayIndexOutOfBoundsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_STRING</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isStringArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stringArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>cardinality</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>argsFound</span><span class=o>.</span><span class=na>size</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>usage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;-[&#34;</span> <span class=o>+</span> <span class=n>schema</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>errorMessage</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=o>(</span><span class=n>errorCode</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>OK</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=s>&#34;TILT: Should not get here.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>UNEXPECTED_ARGUMENT</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>unexpectedArgumentMessage</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>MISSING_STRING</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Could not find string parameter for -%c.&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>errorArgumentId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>INVALID_INTEGER</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Argument -%c expects an integer but was &#39;%s&#39;.&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>errorArgumentId</span><span class=o>,</span> <span class=n>errorParameter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>MISSING_INTEGER</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Could not find integer parameter for -%c.&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>errorArgumentId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=nf>unexpectedArgumentMessage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StringBuffer</span> <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuffer</span><span class=o>(</span><span class=s>&#34;Argument(s) -&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>char</span> <span class=n>c</span> <span class=o>:</span> <span class=n>unexpectedArguments</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>c</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34; unexpected.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>falseIfNull</span><span class=o>(</span><span class=n>Boolean</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>b</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=nf>zeroIfNull</span><span class=o>(</span><span class=n>Integer</span> <span class=n>i</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>i</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=nf>blankIfNull</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getString</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>blankIfNull</span><span class=o>(</span><span class=n>stringArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getInt</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>zeroIfNull</span><span class=o>(</span><span class=n>intArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>falseIfNull</span><span class=o>(</span><span class=n>booleanArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>has</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>argsFound</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isValid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>class</span> <span class=nc>ArgsException</span> <span class=kd>extends</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=문제점>문제점</h3><ul><li>인스턴스 변수가 너무 많다.</li><li><code>“TILT”</code> 와 같은 알수 없는 문자열이 있다.</li><li><code>HashSets</code>, <code>TreeSets</code>, <code>try-catch-catch</code> 블록 등 지저분해 보인다.</li></ul><h3 id=boolean만-지원하는-argsjava>Boolean만 지원하는 Args.java</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.objectmentor.utilities.getopts</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Args</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>unexpectedArguments</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;</span> <span class=n>booleanArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>numberOfArguments</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Args</span><span class=o>(</span><span class=n>String</span> <span class=n>schema</span><span class=o>,</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>schema</span> <span class=o>=</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>args</span> <span class=o>=</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=n>parse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isValid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parse</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>parseSchema</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>parseArguments</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unexpectedArguments</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseSchema</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>element</span> <span class=o>:</span> <span class=n>schema</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;,&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parseSchemaElement</span><span class=o>(</span><span class=n>element</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>element</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>element</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parseBooleanSchemaElement</span><span class=o>(</span><span class=n>element</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseBooleanSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>element</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>Character</span><span class=o>.</span><span class=na>isLetter</span><span class=o>(</span><span class=n>c</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>c</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseArguments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>arg</span> <span class=o>:</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArgument</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseArgument</span><span class=o>(</span><span class=n>String</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;-&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseElements</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseElements</span><span class=o>(</span><span class=n>String</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>arg</span><span class=o>.</span><span class=na>length</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>parseElement</span><span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isBoolean</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>numberOfArguments</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>            <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>unexpectedArguments</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>cardinality</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>numberOfArguments</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>usage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;-[&#34;</span> <span class=o>+</span> <span class=n>schema</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>errorMessage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>unexpectedArguments</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unexpectedArgumentMessage</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=nf>unexpectedArgumentMessage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StringBuffer</span> <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuffer</span><span class=o>(</span><span class=s>&#34;Argument(s) -&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>char</span> <span class=n>c</span> <span class=o>:</span> <span class=n>unexpectedArguments</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>c</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34; unexpected.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>간결하고 단순하며 이해하기도 쉬웠다.</p><p>하지만 코드를 잘 살펴보면 나중에 엉망으로 변해갈 씨앗이 보인다.</p><h3 id=boolean과-string을-지원하는-argsjava>Boolean과 String을 지원하는 Args.java</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.objectmentor.utilities.getopts</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.text.ParseException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Args</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>valid</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>unexpectedArguments</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;</span> <span class=n>booleanArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>stringArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>argsFound</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>currentArgument</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>char</span> <span class=n>errorArgument</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>enum</span> <span class=n>ErrorCode</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OK</span><span class=o>,</span> <span class=n>MISSING_STRING</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ErrorCode</span> <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>OK</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Args</span><span class=o>(</span><span class=n>String</span> <span class=n>schema</span><span class=o>,</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>schema</span> <span class=o>=</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>args</span> <span class=o>=</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=n>parse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parse</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>parseSchema</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>parseArguments</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseSchema</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>element</span> <span class=o>:</span> <span class=n>schema</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;,&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>element</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>String</span> <span class=n>trimmedElement</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>trim</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>parseSchemaElement</span><span class=o>(</span><span class=n>trimmedElement</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>element</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>elementId</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>elementTail</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>validateSchemaElementId</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isBooleanSchemaElement</span><span class=o>(</span><span class=n>elementTail</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseBooleanSchemaElement</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isStringSchemaElement</span><span class=o>(</span><span class=n>elementTail</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseStringSchemaElement</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>validateSchemaElementId</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>Character</span><span class=o>.</span><span class=na>isLetter</span><span class=o>(</span><span class=n>elementId</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ParseException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Bad character:&#34;</span> <span class=o>+</span> <span class=n>elementId</span> <span class=o>+</span> <span class=s>&#34;in Args format: &#34;</span> <span class=o>+</span> <span class=n>schema</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseStringSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isStringSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>elementTail</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;*&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBooleanSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>elementTail</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>elementTail</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseBooleanSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// here!
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseArguments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>currentArgument</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>currentArgument</span> <span class=o>&lt;</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>currentArgument</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>arg</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>];</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArgument</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseArgument</span><span class=o>(</span><span class=n>String</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;-&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>parseElements</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseElements</span><span class=o>(</span><span class=n>String</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>arg</span><span class=o>.</span><span class=na>length</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>parseElement</span><span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>setArgument</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>argsFound</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>unexpectedArguments</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>boolean</span> <span class=n>set</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isBoolean</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isString</span><span class=o>(</span><span class=n>argChar</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>setStringArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>set</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>set</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setStringArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>,</span> <span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>currentArgument</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>stringArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArrayIndexOutOfBoundsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorArgument</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_STRING</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isString</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stringArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>argChar</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>cardinality</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>argsFound</span><span class=o>.</span><span class=na>size</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>usage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;-[&#34;</span> <span class=o>+</span> <span class=n>schema</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>errorMessage</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>unexpectedArguments</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unexpectedArgumentMessage</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>switch</span> <span class=o>(</span><span class=n>errorCode</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>MISSING_STRING</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Could not find string parameter for -%c.&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>errorArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>OK</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=s>&#34;TILT: Should not get here.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=nf>unexpectedArgumentMessage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StringBuffer</span> <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuffer</span><span class=o>(</span><span class=s>&#34;Argument(s) -&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>char</span> <span class=n>c</span> <span class=o>:</span> <span class=n>unexpectedArguments</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>c</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34; unexpected.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>falseIfNull</span><span class=o>(</span><span class=n>booleanArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>falseIfNull</span><span class=o>(</span><span class=n>Boolean</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>b</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=kc>false</span> <span class=o>:</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// here!
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getString</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>blankIfNull</span><span class=o>(</span><span class=n>stringArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=nf>blankIfNull</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>has</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>argsFound</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isValid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>String유형 관련 코드 추가 후 코드가 어지러워졌다. 이후 Integer 인수 유형을 추가하니 코드가 완전히 엉망이 되었다.</p><h2 id=그래서-멈췄다>그래서 멈췄다.</h2><p>인수 유형을 더 추가해야 했는데, 코드가 훨씬 더 나빠질 것이라는 확신으로 리펙터링을 시작했다.</p><p>새 인수 유형을 추가하려면 주요 지점 세곳에다 코드를 추가해야 한다는 사실을 알았다. (parse, get, set)</p><ul><li>인수 유형에 해당하는 HashMap을 선택하기 위해 스키마 요소의 구문 분석</li><li>명령행 인수에서 인수 유형을 분석해 진짜 유형으로 변환.</li><li><code>getXXX</code>메서드를 구현해 호출자에게 진짜 유형을 반환</li></ul><blockquote><p>💡 인수 유형은 다양하지만 모두가 유사한 메서드를 제공하므로 클래스 하나가 적합하다 판단했다. 그래서 <code>ArgumentMarshaler</code>라는 개념이 탄생했다.</p></blockquote><h2 id=점진적으로-개선하다>점진적으로 개선하다.</h2><p>프로그램을 망치는 가장 좋은 방법 중 하나는 개선이라는 이름 아래 구조를 크게 뒤집는 행위다. 개선 전과 똑같은 결과를 만들게 하는 것이 어렵기 때문이다.</p><p>그래서 테스트 주도 개발이라는 기법을 사용하여, 변경 후에도 시스템이 변경 전과 똑같이 돌아가는 것을 확인한다.</p><h3 id=argumentmarshaler><code>ArgumentMarshaler</code></h3><p>각 인수 유형을 처리하는 코드를 Args내부에 선언된 <code>ArgumentMarshaler</code> 클래스에 옮긴 후, 이후 <code>ArgumentMarshaler</code> 파생 클래스를 만들어 분리했다.</p><ul><li>프로그램 구조를 조금씩 변경하는 동안에도 시스템의 정상 동작을 유지하기 쉬워지기 때문</li></ul><p>아래 코드를 <code>Args.java</code>끝에 추가했다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setBoolean</span><span class=o>(</span><span class=kt>boolean</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>BooleanArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>StringArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>IntegerArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>처음 <code>Boolean</code> 인수를 저장하는 <code>HashMap</code>에서 <code>Boolean</code> 인수 유형을 <code>ArgumentMarshaler</code>유형으로 바꿨다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=o>**</span><span class=n>ArgumentMarshaler</span><span class=o>**&gt;</span> <span class=n>booleanArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=o>**</span><span class=n>ArgumentMarshaler</span><span class=o>**&gt;();</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>그 후 깨진 부분에 변경을 반영했다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseBooleanSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=o>**</span><span class=k>new</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>()**);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>setBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>booleanArgs</span><span class=o>.**</span><span class=n>get</span><span class=o>**(</span><span class=n>argChar</span><span class=o>).**</span><span class=n>setBoolean</span><span class=o>**(</span><span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>falseIfNull</span><span class=o>(</span><span class=n>booleanArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>).**</span><span class=n>getBoolean</span><span class=o>**());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>새 인수 유형을 추가하려면 세 곳 (parse, get, set)을 변경해야 했는데, 정확히 해당 영역에서 변경이 이루어졌다.</p><p><code>booleanArgs</code>가 <code>ArgumentMarshaler</code> 를 값으로 사용하게 변경되었으므로 위 <code>getBoolean</code>에서 사용하는 기존 <code>falseIfNull</code>이 <code>NullPointerException</code>을 막을 수 없었다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;</span> <span class=n>booleanArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Args</span><span class=o>.</span><span class=na>ArgumentMarshaler</span> <span class=n>am</span> <span class=o>=</span> <span class=n>booleanArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>am</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>am</span><span class=o>.</span><span class=na>getBoolean</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ArgumentMarshaler.getBoolean</code> 에서 null을 검사하게 구현하고 기존 falseIfNull을 제거했다.</p><h3 id=string-인수-추가>String 인수 추가</h3><p>Boolean 인수를 추가하는 과정과 유사하게 String 인수를 추가했다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=o>**</span><span class=n>ArgumentMarshaler</span><span class=o>**&gt;</span> <span class=n>stringArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=o>**</span><span class=n>ArgumentMarshaler</span><span class=o>**&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseStringSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>stringArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=o>**</span><span class=k>new</span> <span class=n>StringArgumentMarshaler</span><span class=o>()**);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>setStringArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>currentArgument</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringArgs</span><span class=o>.**</span><span class=n>get</span><span class=o>**(</span><span class=n>argChar</span><span class=o>).**</span><span class=n>setString</span><span class=o>**(</span><span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArrayIndexOutOfBoundsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_STRING</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>getString</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=n>Args</span><span class=o>.</span><span class=na>ArgumentMarshaler</span> <span class=n>am</span><span class=o>**</span> <span class=o>=</span> <span class=n>stringArgs</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>am</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>am</span><span class=o>.</span><span class=na>getString</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setString</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringValue</span> <span class=o>=</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stringValue</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>테스트 케이스가 하나라도 실패하면 다음 변경으로 넘어가기 전에 오류를 수정했다.</p><p>마찬가지로 int 인수 기능도 추가했다.</p><h3 id=추상클래스를-이용한-분리>추상클래스를 이용한 분리</h3><p><code>Boolean</code>, <code>String</code>, <code>Integer</code> 인수 처리에 대한 모든 기능을 <code>Args</code>의 <code>ArgumentMarshaler</code>로 옮겼으므로 미리 선언해둔 파생 클래스로 분산한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=o>**</span><span class=kd>abstract</span><span class=o>**</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>protected</span><span class=o>**</span> <span class=kt>boolean</span> <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>integerValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setBoolean</span><span class=o>(</span><span class=kt>boolean</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setString</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringValue</span> <span class=o>=</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stringValue</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setInteger</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>integerValue</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getInteger</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>integerValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>);**</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>점진적으로 한단계씩 개선하기 위해 <code>ArgumentMarshaler</code>를 추상 클래스로 바꾸고 하나씩 옮긴다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>BooleanArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ArgumentMarshaler</code>를 상속받은 유형 별 클래스에 <code>set</code>메서드를 구현하고, 기존 <code>ArgumentMarshaler.setXXX</code>을 <code>set</code>으로 대체한다.</p><p>→ <code>BooleanArgumentMarshaler.set</code> 에서 s를 사용하지 않음에도 선언한 이유는 <code>ArgumentMarshaler</code> 를 상속받는 다른 클래스들이 String 인자를 받아 사용하기 때문</p><h3 id=get>get</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>boolean</span> <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>get</span><span class=o>();**</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>get을 추상 메서드로 만든 후 로직을 추가한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>BooleanArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>private</span> <span class=kt>boolean</span> <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;**</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}**</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>그 후 <code>ArgumentMarshaler</code> 에 <code>protected</code>로 선언되어있던 변수를 <code>xxxArgumentMarshaler</code>의 <code>private</code>변수로 선언한다.</p><h3 id=argumentmarshaler-검증>ArgumentMarshaler 검증</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>public</span> <span class=kd>abstract</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span><span class=o>;**</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>set</code>을 통해 <code>ArgumentMarshaler</code>를 상속받은 클래스의 <code>private</code>변수인 <code>xxxValue</code>에 값을 할당하게 되는데 자료형이 다를경우 오류가 발생한다.</p><h2 id=args-통합>Args 통합</h2><p><code>xxxArgs</code>를 통합하기 위한 첫걸음으로 <code>marshalers</code> 를 추가했다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Args</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;</span> <span class=n>booleanArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;</span> <span class=n>stringArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;</span> <span class=n>intArgs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;</span> <span class=n>marshalers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;();**</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseBooleanSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);**</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseIntegerSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>intArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);**</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseStringSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringArgumentMarshaler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>stringArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);**</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>그 후 <code>parseXXX</code> 메서드에 <code>marshalers.put</code>을 수행하여 테스트를 통과하지 않는지 살폈다. 테스트는 실패없이 돌아갔다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>booleanArgs</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>그 후 <code>Args.isBooleanArgs</code>를 아래로 수정했다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBooleanArg</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>수정 후 테스트를 모두 통과하여 다른 항목들에 대해서도 동일한 수정을 했다. 변경후에도 테스트를 통과하여 <code>marshalers.get</code>을 호출하는 코드를 통합했다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>isBooleanArg</span><span class=o>(</span><span class=n>m</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isStringArg</span><span class=o>(</span><span class=n>m</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=n>setStringArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isIntArg</span><span class=o>(</span><span class=n>m</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=n>setIntArg</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isIntArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span> <span class=k>instanceof</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isStringArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span> <span class=k>instanceof</span> <span class=n>StringArgumentMarshaler</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isBooleanArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>다음으로 <code>set</code>함수에서 기존 <code>HashMap</code>을 <code>marshalers HashMap</code>으로 교체한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>setBooleanArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=s>&#34;true&#34;</span><span class=o>);</span> <span class=c1>// was: booleanArgs.get(argChar).set(&#34;true&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>각 <code>setXXX</code>의 형식을 통합하여 예외처리를 동일하게 적용할 수 있었다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>StringArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setStringArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setIntArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>setIntArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>currentArgument</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>parameter</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>parameter</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>parameter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArrayIndexOutOfBoundsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>errorParameter</span> <span class=o>=</span> <span class=n>parameter</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>INVALID_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>setStringArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>currentArgument</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=n>currentArgument</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArrayIndexOutOfBoundsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_STRING</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=hashmap-통합>HashMap 통합</h3><p><code>ArgumentMarshaler</code>를 이용하여 만든 유형별 <code>HashMap</code>을 하나의 <code>HashMap</code>으로 통합한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Args</span><span class=o>.</span><span class=na>ArgumentMarshaler</span> <span class=n>am</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>b</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=n>am</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>Boolean</span><span class=o>)</span> <span class=n>am</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ClassCastException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>이에따라 다른 인수유형도 아래와 같이 변경 가능했고,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseBooleanSchemaElement</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>~~</span><span class=n>booleanArgs</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);~~</span>
</span></span><span class=line><span class=cl>    <span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>결과적으로 하나의 Hashmap으로 통합 가능했다.</p><h3 id=setargument>setArgument</h3><p>유형을 일일이 확인하는 코드를 없애고 <code>ArgumentMarshaler.set</code>만으로 만든다.</p><p><code>setXXXArg</code>를 각각 <code>ArgumentMarshaler</code> 로 내려야 하는데, <code>setIntArgs</code>는 <code>args</code>와 <code>currentArgument</code>라는 인스턴스 변수 두개가 쓰인다.</p><p>해당 메서드를 내리려면 <code>args</code>와 <code>currentArgument</code>를 인수로 넘겨야 하므로(인수가 많아지므로) 코드가 지저분해진다.</p><p>따라서 <code>args</code>를 <code>list</code>로 변환 후 <code>Iterator</code>를 <code>set</code> 함수로 전달한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Args</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>valid</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>unexpectedArguments</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;</span> <span class=n>marshalers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>argsFound</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>;**</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>char</span> <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>errorParameter</span> <span class=o>=</span> <span class=s>&#34;TILT&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ErrorCode</span> <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>OK</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>argsList</span><span class=o>;**</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>enum</span> <span class=n>ErrorCode</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OK</span><span class=o>,</span> <span class=n>MISSING_STRING</span><span class=o>,</span> <span class=n>MISSING_INTEGER</span><span class=o>,</span> <span class=n>INVALID_INTEGER</span><span class=o>,</span> <span class=n>UNEXPECTED_ARGUMENT</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Args</span><span class=o>(</span><span class=n>String</span> <span class=n>schema</span><span class=o>,</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>schema</span> <span class=o>=</span> <span class=n>schema</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>argsList</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>args</span><span class=o>);**</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=n>parse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parse</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ParseException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>schema</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>**</span><span class=n>argsList</span><span class=o>.</span><span class=na>size</span><span class=o>()**</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>parseSchema</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArguments</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>valid</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ---
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>parseArguments</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>currentArgument</span> <span class=o>=</span> <span class=o>**</span><span class=n>argsList</span><span class=o>.</span><span class=na>iterator</span><span class=o>()**;</span> <span class=n>currentArgument</span><span class=o>.**</span><span class=n>hasNext</span><span class=o>()**;)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>arg</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.**</span><span class=n>next</span><span class=o>()**;</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArgument</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ---
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setIntArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>parameter</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parameter</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.**</span><span class=n>next</span><span class=o>()**;</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>parameter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(**</span><span class=n>NoSuchElementException</span><span class=o>**</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>errorParameter</span> <span class=o>=</span> <span class=n>parameter</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>INVALID_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>setStringArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>currentArgument</span><span class=o>.**</span><span class=n>next</span><span class=o>()**);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(**</span><span class=n>NoSuchElementException</span><span class=o>**</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_STRING</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>따라서 <code>args</code>를 <code>list</code>로 변환 후 <code>Iterator</code>를 <code>set</code> 함수로 전달하는 변경 후에 테스트를 모두 통과했다. <code>set</code> 함수를 적절한 파생 클래스로 내려도 괜찮아져 처음으로 <code>setArgument</code>를 아래로 변경했다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>StringArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setStringArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setIntArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>~~</span><span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;~~</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>연쇄적인 if-else 구문을 완전히 제거하기 위해 제거하고 오류 코드를 따로 꺼냈다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setBooleanArg</span><span class=o>(</span><span class=n>m</span><span class=o>,</span> <span class=n>currentArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>StringArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setStringArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>setIntArg</span><span class=o>(</span><span class=n>m</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>// ---
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>setBooleanArg</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>m</span><span class=o>,</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>~~</span><span class=k>try</span> <span class=o>{~~</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=s>&#34;true&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>~~</span><span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}~~</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>단계적으로 조금씩 변경하며 매번 테스트를 돌려야 하므로 코드를 옮기고 제거하는 일이 많아진다.</p><p>위와 마찬가지로 iterator를 인자로 받는 이유는 추상 메서드로 호출하기 위해서다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=kd>throws</span> <span class=n>ArgsException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>BooleanArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>booleanValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>StringArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>stringValue</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringValue</span> <span class=o>=</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>IntegerArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>intValue</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>intValue</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>intValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>새로운 추상 메서드를 추가하고 각각 변경한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>currentArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>StringArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>currentArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=k>instanceof</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>currentArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>StringArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>stringValue</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>stringValue</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchElementException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_STRING</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>class</span> <span class=nc>IntegerArgumentMarshaler</span> <span class=kd>extends</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>intValue</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>parameter</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parameter</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>set</span><span class=o>(</span><span class=n>parameter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchElementException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>MISSING_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>errorParameter</span> <span class=o>=</span> <span class=n>parameter</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>errorCode</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=na>INVALID_INTEGER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>intValue</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>intValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>setArgument</code>가 테스트에 통과하면 <code>m.set</code>이 정상 동작을 의미하므로 통합할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>setArgument</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>currentArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>valid</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>errorArgumentId</span> <span class=o>=</span> <span class=n>argChar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>마지막으로 <code>ArgumentMarshaler</code>를 인터페이스로 변경하면 완료된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>interface</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span> <span class=nf>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=결론>결론</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.objectmentor.utilities.args</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>com.objectmentor.utilities.args.ArgsException.ErrorCode.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Args</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;</span> <span class=n>marshalers</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>argsFound</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Args</span><span class=o>(</span><span class=n>String</span> <span class=n>schema</span><span class=o>,</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>marshalers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>,</span> <span class=n>ArgumentMarshaler</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>argsFound</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>parseSchema</span><span class=o>(</span><span class=n>schema</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>parseArgumentStrings</span><span class=o>(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>args</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseSchema</span><span class=o>(</span><span class=n>String</span> <span class=n>schema</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>element</span> <span class=o>:</span> <span class=n>schema</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;,&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>element</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=n>parseSchemaElement</span><span class=o>(</span><span class=n>element</span><span class=o>.</span><span class=na>trim</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseSchemaElement</span><span class=o>(</span><span class=n>String</span> <span class=n>element</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>elementId</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>elementTail</span> <span class=o>=</span> <span class=n>element</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>validateSchemaElementId</span><span class=o>(</span><span class=n>elementId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>elementTail</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=k>new</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;*&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=k>new</span> <span class=n>StringArgumentMarshaler</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;#&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=k>new</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;##&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=k>new</span> <span class=n>DoubleArgumentMarshaler</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>elementTail</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;[*]&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=n>marshalers</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>elementId</span><span class=o>,</span> <span class=k>new</span> <span class=n>StringArrayArgumentMarshaler</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>(</span><span class=n>INVALID_ARGUMENT_FORMAT</span><span class=o>,</span> <span class=n>elementId</span><span class=o>,</span> <span class=n>elementTail</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>validateSchemaElementId</span><span class=o>(</span><span class=kt>char</span> <span class=n>elementId</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>Character</span><span class=o>.</span><span class=na>isLetter</span><span class=o>(</span><span class=n>elementId</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>(</span><span class=n>INVALID_ARGUMENT_NAME</span><span class=o>,</span> <span class=n>elementId</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseArgumentStrings</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>argsList</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>currentArgument</span> <span class=o>=</span> <span class=n>argsList</span><span class=o>.</span><span class=na>listIterator</span><span class=o>();</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>hasNext</span><span class=o>();)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>argString</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>argString</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;-&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>parseArgumentCharacters</span><span class=o>(</span><span class=n>argString</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>currentArgument</span><span class=o>.</span><span class=na>previous</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseArgumentCharacters</span><span class=o>(</span><span class=n>String</span> <span class=n>argChars</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argChars</span><span class=o>.</span><span class=na>length</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>parseArgumentCharacter</span><span class=o>(</span><span class=n>argChars</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseArgumentCharacter</span><span class=o>(</span><span class=kt>char</span> <span class=n>argChar</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ArgumentMarshaler</span> <span class=n>m</span> <span class=o>=</span> <span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>m</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>(</span><span class=n>UNEXPECTED_ARGUMENT</span><span class=o>,</span> <span class=n>argChar</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>argsFound</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>m</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>currentArgument</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ArgsException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>e</span><span class=o>.</span><span class=na>setErrorArgumentId</span><span class=o>(</span><span class=n>argChar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>has</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>argsFound</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>arg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>nextArgument</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>nextIndex</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>getBoolean</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>.</span><span class=na>getValue</span><span class=o>(</span><span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getString</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>StringArgumentMarshaler</span><span class=o>.</span><span class=na>getValue</span><span class=o>(</span><span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getInt</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>.</span><span class=na>getValue</span><span class=o>(</span><span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double</span> <span class=nf>getDouble</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>DoubleArgumentMarshaler</span><span class=o>.</span><span class=na>getValue</span><span class=o>(</span><span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span><span class=o>[]</span> <span class=nf>getStringArray</span><span class=o>(</span><span class=kt>char</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>StringArrayArgumentMarshaler</span><span class=o>.</span><span class=na>getValue</span><span class=o>(</span><span class=n>marshalers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>arg</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BooleanArgumentMarshaler</span> <span class=kd>implements</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>booleanValue</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=nf>getValue</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>am</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>am</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>am</span> <span class=k>instanceof</span> <span class=n>BooleanArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>((</span><span class=n>BooleanArgumentMarshaler</span><span class=o>)</span> <span class=n>am</span><span class=o>).</span><span class=na>booleanValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>com.objectmentor.utilities.args.ArgsException.ErrorCode.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StringArgumentMarshaler</span> <span class=kd>implements</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>stringValue</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>stringValue</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchElementException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>(</span><span class=n>MISSING_STRING</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>getValue</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>am</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>am</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>am</span> <span class=k>instanceof</span> <span class=n>StringArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>((</span><span class=n>StringArgumentMarshaler</span><span class=o>)</span> <span class=n>am</span><span class=o>).</span><span class=na>stringValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>com.objectmentor.utilities.args.ArgsException.ErrorCode.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>IntegerArgumentMarshaler</span> <span class=kd>implements</span> <span class=n>ArgumentMarshaler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>intValue</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>currentArgument</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ArgsException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>parameter</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>parameter</span> <span class=o>=</span> <span class=n>currentArgument</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>intValue</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>parameter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchElementException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>(</span><span class=n>MISSING_INTEGER</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgsException</span><span class=o>(</span><span class=n>INVALID_INTEGER</span><span class=o>,</span> <span class=n>parameter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>int</span> <span class=nf>getValue</span><span class=o>(</span><span class=n>ArgumentMarshaler</span> <span class=n>am</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>am</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>am</span> <span class=k>instanceof</span> <span class=n>IntegerArgumentMarshaler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>((</span><span class=n>IntegerArgumentMarshaler</span><span class=o>)</span> <span class=n>am</span><span class=o>).</span><span class=na>intValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>리펙토링을 안전하게 수행하기 위해 조금씩 변경하는 과정을 거쳤다. 결과적으로 절차적인 코드가 객체지향적으로 리펙토링 되었다.</p><ul><li>규모가 있는 코드를 한번에 변경하는 것은 매우 어렵다.</li><li>따라서 테스트를 기반으로 조금씩 변경하는 과정을 거쳤다.</li></ul><p><em><strong>테스트는 매우 중요하다!</strong></em></p></section><footer class=article-footer><section class=article-tags><a href=/tags/common/>Common</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/clean-code/15/><div class=article-image><img src=/post/clean-code/15/clean_code_cover.39d6c4b4006dafbd74477eb98624739e_hud03d003727d53e154227b4e2dbea4cfd_18319_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post 클린코드: 15. JUnit 들여다보기" data-key=clean-code/15 data-hash="md5-OdbEtABtr710R365hiRzng=="></div><div class=article-details><h2 class=article-title>클린코드: 15. JUnit 들여다보기</h2></div></a></article><article class=has-image><a href=/post/clean-code/17/><div class=article-image><img src=/post/clean-code/17/clean_code_cover.39d6c4b4006dafbd74477eb98624739e_hud03d003727d53e154227b4e2dbea4cfd_18319_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post 클린코드: 17. 냄새와 휴리스틱" data-key=clean-code/17 data-hash="md5-OdbEtABtr710R365hiRzng=="></div><div class=article-details><h2 class=article-title>클린코드: 17. 냄새와 휴리스틱</h2></div></a></article><article class=has-image><a href=/post/clean-code/12/><div class=article-image><img src=/post/clean-code/12/clean_code_cover.39d6c4b4006dafbd74477eb98624739e_hud03d003727d53e154227b4e2dbea4cfd_18319_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post 클린코드: 12. 창발성" data-key=clean-code/12 data-hash="md5-OdbEtABtr710R365hiRzng=="></div><div class=article-details><h2 class=article-title>클린코드: 12. 창발성</h2></div></a></article><article class=has-image><a href=/post/clean-code/10/><div class=article-image><img src=/post/clean-code/10/clean_code_cover.39d6c4b4006dafbd74477eb98624739e_hud03d003727d53e154227b4e2dbea4cfd_18319_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post 클린코드: 10. 클래스" data-key=clean-code/10 data-hash="md5-OdbEtABtr710R365hiRzng=="></div><div class=article-details><h2 class=article-title>클린코드: 10. 클래스</h2></div></a></article><article class=has-image><a href=/post/clean-code/9/><div class=article-image><img src=/post/clean-code/9/clean_code_cover.39d6c4b4006dafbd74477eb98624739e_hud03d003727d53e154227b4e2dbea4cfd_18319_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post 클린코드: 9. 단위 테스트" data-key=clean-code/9 data-hash="md5-OdbEtABtr710R365hiRzng=="></div><div class=article-details><h2 class=article-title>클린코드: 9. 단위 테스트</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=codemario318/codemario318.github.io issue-term=pathname label=Comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 Mario Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>