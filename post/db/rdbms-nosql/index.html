<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="로그 구조 계열 저장소 엔진과 페이지 지향 계열 저장소 엔진 비교"><title>B-Tree VS LSM Tree</title><link rel=canonical href=https://codemario318.github.io/post/db/rdbms-nosql/><link rel=stylesheet href=/scss/style.min.cbce94e2760d14d60414e59d5a36ab2819232375817e010dbe7be2234b67da1b.css><meta property="og:title" content="B-Tree VS LSM Tree"><meta property="og:description" content="로그 구조 계열 저장소 엔진과 페이지 지향 계열 저장소 엔진 비교"><meta property="og:url" content="https://codemario318.github.io/post/db/rdbms-nosql/"><meta property="og:site_name" content="Mario Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Database"><meta property="article:tag" content="데이터베이스"><meta property="article:tag" content="RDBMS"><meta property="article:tag" content="관계형 데이터베이스"><meta property="article:tag" content="Log-Structured"><meta property="article:tag" content="로그 구조"><meta property="article:tag" content="Page-Oriented"><meta property="article:tag" content="페이지 지향"><meta property="article:tag" content="B-Tree"><meta property="article:tag" content="B+Tree"><meta property="article:tag" content="LSM Tree"><meta property="article:tag" content="로그 구조화 병합 트리"><meta property="article:published_time" content="2025-04-22T13:58:49+09:00"><meta property="article:modified_time" content="2025-04-22T13:58:49+09:00"><meta property="og:image" content="https://codemario318.github.io/post/db/rdbms-nosql/cover.png"><meta name=twitter:title content="B-Tree VS LSM Tree"><meta name=twitter:description content="로그 구조 계열 저장소 엔진과 페이지 지향 계열 저장소 엔진 비교"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codemario318.github.io/post/db/rdbms-nosql/cover.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-K99591YLGK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K99591YLGK",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3183752545292673" crossorigin=anonymous></script><meta name=naver-site-verification content="2315bde85c86f66092140cc465c340a2170f3187"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu760fd15c5fbb2f30cf0868dc4a5dc41a_14271_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Mario Blog</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/codemario318 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><ul class="menu sub-menu"><li><a href=/categories/backend/><span>Backend</span>
<span class=content-count>3</span></a></li><li><a href=/categories/boostcamp/><span>부스트캠프</span>
<span class=content-count>11</span></a></li><li><a href=/categories/cleancode/><span>Clean Code</span>
<span class=content-count>10</span></a></li><li><a href=/categories/common/><span>Common</span>
<span class=content-count>79</span></a></li><li><a href=/categories/data/><span>Data</span>
<span class=content-count>3</span></a></li><li><a href=/categories/db/><span>DB</span>
<span class=content-count>2</span></a></li><li><a href=/categories/frontend/><span>Frontend</span>
<span class=content-count>10</span></a></li><li><a href=/categories/golang/><span>GoLang</span>
<span class=content-count>13</span></a></li><li><a href=/categories/headfirstdesignpatterns/><span>헤드 퍼스트 디자인 패턴</span>
<span class=content-count>22</span></a></li><li><a href=/categories/infra/><span>Infra</span>
<span class=content-count>14</span></a></li><li><a href=/categories/nest/><span>Nest</span>
<span class=content-count>1</span></a></li><li><a href=/categories/network/><span>네트워크</span>
<span class=content-count>1</span></a></li><li><a href=/categories/node/><span>Node</span>
<span class=content-count>6</span></a></li><li><a href=/categories/others/><span>Others</span>
<span class=content-count>4</span></a></li><li><a href=/categories/problemsolving/><span>Problem Solving</span>
<span class=content-count>1</span></a></li><li><a href=/categories/project/><span>Project</span>
<span class=content-count>5</span></a></li><li><a href=/categories/realmysql/><span>Real MySQL</span>
<span class=content-count>53</span></a></li></ul><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#두-저장-구조의-기본-원리>두 저장 구조의 기본 원리</a><ol><li><a href=#b-tree-구조>B-Tree 구조</a></li><li><a href=#lsm-tree-구조>LSM Tree 구조</a></li></ol></li><li><a href=#성능-특성-비교>성능 특성 비교</a><ol><li><a href=#읽기-성능>읽기 성능</a></li><li><a href=#쓰기-성능>쓰기 성능</a></li></ol></li><li><a href=#실제-구현에서의-최적화-기법>실제 구현에서의 최적화 기법</a><ol><li><a href=#b-tree-기반-시스템의-주요-최적화-innodb-사례>B-Tree 기반 시스템의 주요 최적화 (InnoDB 사례)</a></li><li><a href=#lsm-tree-기반-시스템의-주요-최적화-cassandra-사례>LSM Tree 기반 시스템의 주요 최적화 (Cassandra 사례)</a></li></ol></li><li><a href=#어떤-상황에-어떤-저장-구조가-적합한가>어떤 상황에 어떤 저장 구조가 적합한가?</a><ol><li><a href=#b-tree가-적합한-상황>B-Tree가 적합한 상황</a></li><li><a href=#lsm-tree가-적합한-상황>LSM Tree가 적합한 상황</a></li></ol></li><li><a href=#선택-시-고려사항>선택 시 고려사항</a><ol><li><a href=#워크로드-특성>워크로드 특성</a></li><li><a href=#하드웨어-환경>하드웨어 환경</a></li><li><a href=#실제-벤치마크-테스트의-중요성>실제 벤치마크 테스트의 중요성</a></li></ol></li><li><a href=#결론>결론</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/db/rdbms-nosql/><img src=/post/db/rdbms-nosql/cover_hu0decb55a7294c1f6c0b0b499667684fd_51925_800x0_resize_box_3.png srcset="/post/db/rdbms-nosql/cover_hu0decb55a7294c1f6c0b0b499667684fd_51925_800x0_resize_box_3.png 800w, /post/db/rdbms-nosql/cover_hu0decb55a7294c1f6c0b0b499667684fd_51925_1600x0_resize_box_3.png 1600w" width=800 height=334 loading=lazy alt="Featured image of post B-Tree VS LSM Tree"></a></div><div class=article-details><header class=article-category><a href=/categories/db/ style=background-color:#2a9d8f;color:#fff>DB</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/db/rdbms-nosql/>B-Tree VS LSM Tree</a></h2><h3 class=article-subtitle>로그 구조 계열 저장소 엔진과 페이지 지향 계열 저장소 엔진 비교</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2025/04/22</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p>최근 &ldquo;<strong>데이터 중심 애플리케이션 설계</strong>&ldquo;을 읽으면서 데이터베이스의 저장소 엔진의 처리 방식이 성능에 미치는 영향에 대해 구체적으로 알게 되었습니다.</p><p>책에서 해당 부분의 도입부를 읽으며, &ldquo;<strong>데이터를 처리하는 방식에 따라 유리한 형태는 다르고 적절한 방법을 선택 해야 한다</strong>&ldquo;와 같은 조언으로 마무리 될 것으로 예상했었는데요</p><p>실제로는 각 스토리지 엔진 구조의 장단점을 설명하면서 최근 인기를 끌고 있는것은 로그 구조화 스토리지 엔진이지만, B-Tree 계열은 오랜 기간 발전하면서 많은 작업 부하에도 대응할 수 있다는 내용이 언급하며, 실제 사용 사례에 적합한지 실제로 테스트 해보는 것도 좋은 방법이라는 언급이 있었습니다.</p><p>그런 의미로 이 글에서는 <strong>페이지 지향 계열 저장소 엔진</strong>(B-Tree)과 <strong>로그 구조 계열 저장소 엔진</strong>(LSM Tree) 두 가지 주요 저장 구조를 비교 해보고, 어떤 식으로 약점을 개선했는지 자세히 살펴보려고 합니다.</p><h2 id=두-저장-구조의-기본-원리>두 저장 구조의 기본 원리</h2><p>책에서는 B-Tree와 로그 구조 계열 저장소 엔진(대표적으로 LSM Tree)의 쓰기 방식의 차이 주목하고 있습니다.</p><h3 id=b-tree-구조>B-Tree 구조</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>       [루트 페이지]
</span></span><span class=line><span class=cl>       /    |    \
</span></span><span class=line><span class=cl>[페이지1] [페이지2] [페이지3]
</span></span><span class=line><span class=cl>  / \      / \      / \
</span></span><span class=line><span class=cl>... ...  ... ...  ... ...
</span></span></code></pre></td></tr></table></div></div><p>B-Tree는 MySQL InnoDB와 같은 대부분의 관계형 데이터베이스에서 사용하는 색인 구조입니다. MySQL의 InnoDB 스토리지 엔진은 기본키(PK)를 B-Tree로 관리하는 클러스터드 인덱스 방식을 사용합니다. B-Tree는 다음과 같은 특징을 가집니다.</p><ul><li><strong>균형 잡힌 트리 구조</strong>:<ul><li>모든 리프 노드가 같은 깊이에 위치하여 어떤 키에 대해서도 <code>O(log n)</code> 시간 복잡도로 검색 가능</li></ul></li><li><strong>페이지 단위 저장</strong>:<ul><li>데이터를 고정 크기의 페이지 단위로 디스크에 저장</li></ul></li><li><strong>제자리 갱신(in-place update)</strong>:<ul><li>데이터를 삽입, 삭제, 수정할 때 해당 페이지의 내용을 직접 덮어쓰는 방식 사용</li></ul></li></ul><p>이러한 특성으로 인해 InnoDB 에서 처리되는 쓰기 작업(<code>INSERT</code>, <code>UPDATE</code> , <code>DELETE</code>)은 B-Tree의 리프 노드에 달려있는 PK를 통해, 물리 기억 장치의 저장된 위치의 내용을 찾고, 해당 내용을 직접 덮어쓰는 방식으로 처리됩니다.</p><h3 id=lsm-tree-구조>LSM Tree 구조</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[MemTable(메모리)]  →  [SS테이블1(디스크)]  →  [SS테이블2(디스크)]  →  ...
</span></span><span class=line><span class=cl>                          ↓                      ↓
</span></span><span class=line><span class=cl>                     [컴팩션 프로세스]        [컴팩션 프로세스]
</span></span><span class=line><span class=cl>                          ↓                      ↓
</span></span><span class=line><span class=cl>                     [병합된 SS테이블]        [병합된 SS테이블]
</span></span></code></pre></td></tr></table></div></div><p>LSM Tree(Log-Structured Merge Tree)는 Cassandra, RocksDB, MongoDB의 WiredTiger 등 여러 NoSQL 데이터베이스에서 사용하는 저장 구조입니다. 주요 특징은 다음과 같습니다.</p><ul><li><strong>로그 기반 쓰기</strong>:<ul><li>데이터 변경 사항을 로그처럼 디스크에 순차적으로 추가</li></ul></li><li><strong>쓰기 버퍼링</strong>:<ul><li>새로운 데이터를 먼저 메모리 내의 멤테이블(MemTable)에 버퍼링</li></ul></li><li><strong>컴팩션 프로세스</strong>:<ul><li>주기적으로 데이터를 병합하고 압축하는 백그라운드 프로세스 실행</li></ul></li></ul><p>로그 기반 쓰기 특성으로 인해 값을 갱신하는 것이 아닌 최신 내용을 디스크에 추가만 하도록 처리되고, 백그라운드 컴팩션 작업을 통해 최신 내용만 남게되는 방식으로 처리됩니다.</p><h2 id=성능-특성-비교>성능 특성 비교</h2><p>쓰기 방식의 차이로 인해 데이터를 관리하는 방식도 달라지게되고, 이에 따라 요청하는 데이터를 처리하는 방식에도 차이가 있습니다.</p><h3 id=읽기-성능>읽기 성능</h3><p><strong>B-Tree의 읽기 성능</strong></p><ul><li>균형 잡힌 트리 구조로 인해 어떤 키든 일정한 시간 내에 조회 가능 (<code>O(log n)</code>)</li><li>실제 환경에서는 대부분 3-4단계 내에 데이터 접근 가능</li><li>데이터가 정렬된 상태로 유지되어 범위 쿼리와 정렬된 스캔에 효율적</li><li>인덱스가 메모리에 캐시될 경우 매우 빠른 접근 가능</li></ul><p>위 설명처럼 어떤 키 값도 <code>O(log n)</code> 시간 복잡도로 조회가 가능하고, 정렬된 상태로 키 값이 관리되기 때문에 B+Tree를 사용하게 되는 경우 Range Scan 작업도 빠르게 처리될 수 있습니다.</p><p>특히 인덱스가 조회하려는 데이터를 모두 가지고 있는 Covering Index로 처리될 수 있다면, 읽기가 메모리 내에서만 처리될 수 있기 때문에 매우 빠르게 처리될 수 있습니다.</p><hr><p><strong>LSM Tree의 읽기 성능</strong></p><ul><li>특정 키를 찾기 위해 여러 SS테이블을 차례로 검색해야 할 수 있음</li><li>메모리의 멤테이블부터 최신 SS테이블까지 순차적으로 확인 필요</li><li>블룸 필터(Bloom Filter)와 같은 최적화를 통해 불필요한 SS테이블 검색을 줄일 수 있음</li><li>컴팩션 작업 중에는 일시적으로 읽기 성능이 저하될 수 있음</li></ul><p>같은 키를 가지는 새로운 데이터를 갱신하는 것이 아닌 파일에 추가하는 방식으로 처리되기 때문에, 메모리 상의 멤테이블에 데이터가 없다면, 가장 최신 SS테이블부터 해당 키를 가지는 데이터를 찾을 때 까지 모든 SS테이블을 확인해야합니다.</p><p>이런 상황은 해당 키를 가지는 데이터가 존재하지 않는 경우 모든 SS테이블에 데이터가 없다는 것을 확인해야하기 때문에 성능이 많이 떨어질 수 있습니다.</p><p>이런 경우를 대비하여 블룸 필터를 통해 최악의 경우는 회피하는 방식으로 최적화가 되어있습니다.</p><blockquote><p><strong>블룸 필터 Bloom filter</strong><br>원소가 집합에 속하는지 여부를 검사하는데 사용되는 확률적 자료구조.<br>어떤 원소가 집합에 속한다고 판단된 경우 실제로는 원소가 집합에 속하지 않는 긍정 오류가 발생하는 것은 가능하지만, 원소가 집합에 속하지 않는 것으로 판단되었는데 실제로 원소가 집합에 속하는 부정 오류는 절대 발생하지 않는다.</p></blockquote><h3 id=쓰기-성능>쓰기 성능</h3><p><strong>B-Tree의 쓰기 성능</strong></p><ul><li>데이터 수정 시 해당 페이지를 직접 덮어써야 함 (무작위 I/O 발생)</li><li>균형 유지를 위한 페이지 분할 작업이 발생할 수 있음</li><li>인덱스가 여러 개인 경우 모든 관련 인덱스 업데이트 필요</li><li>WAL(Write-Ahead Log)을 통한 안전한 데이터 변경으로 추가적인 I/O 발생</li></ul><p>위에서 살짝 언급한 것 처럼 데이터 수정이 필요할 경우 PK를 통해서 해당 페이지를 찾고 직접 덮어 써야 하기 때문에 무작위 I/O가 많이 발생하게 됩니다.</p><p>그리고 데이터베이스에 따라 테이블에 여러 개의 보조 인덱스를 추가하는 경우 해당 인덱스(B-Tree) 갱신을 위해 추가적인 작업이 발생할 수 있습니다.</p><p>또한 데이터 갱신 중 비정상적인 처리(종료)로 인해 데이터 변경 요청이 손실되는 것을 막기 위해 추가적인 쓰기 작업이 추가되는 경우도 있습니다(WAL).</p><hr><p><strong>LSM Tree의 쓰기 성능</strong></p><ul><li>데이터를 순차적으로 추가하므로 디스크 쓰기 효율이 높음</li><li>메모리 버퍼링을 통해 디스크 I/O 횟수를 크게 줄임</li><li>기존 데이터를 덮어쓰지 않으므로 페이지 분할 같은 구조 재조정이 필요 없음</li><li>백그라운드 컴팩션이 필요하지만 쓰기 성능에 직접적인 영향은 적음</li></ul><p>기본적으로 데이터 순차 쓰기 방식으로 처리되기 때문에 운영체제 수준에서 최적화가 잘 되어 Random I/O보다 훨씬 빠르게 처리될 수 있습니다.</p><p>그리고 경우에 따라서 이 마저도 효과적으로 수행할 수 있도록 버퍼링을 통해 데이터를 모아 처리하는 방식으로 최적화 하기도 합니다.</p><h2 id=실제-구현에서의-최적화-기법>실제 구현에서의 최적화 기법</h2><p>지금까지의 내용만 본다면, B-Tree 기반 데이터베이스는 쓰기에 불리하고 로그 기반 데이터베이스는 읽기에 불리한 것 처럼 느껴집니다. (사실 일반적으로 그렇게 생각되는 경우가 많은 것 같습니다.)</p><p>그렇지만 불리한 성능을 개선하기 위해 여러 최적화가 적용되어 있습니다.</p><h3 id=b-tree-기반-시스템의-주요-최적화-innodb-사례>B-Tree 기반 시스템의 주요 최적화 (InnoDB 사례)</h3><p>MySQL의 InnoDB 스토리지 엔진은 데이터를 갱신해야함으로 발생하는 Random I/O로 인한 병목을 개선하기 위해 여러 아이디어를 적용했습니다.</p><p><img src=/post/db/rdbms-nosql/img.png width=856 height=667 srcset="/post/db/rdbms-nosql/img_hue3e0905a4663bd838b952fb1b242c93f_73721_480x0_resize_box_3.png 480w, /post/db/rdbms-nosql/img_hue3e0905a4663bd838b952fb1b242c93f_73721_1024x0_resize_box_3.png 1024w" loading=lazy alt="InnoDB 아키텍처" class=gallery-image data-flex-grow=128 data-flex-basis=308px></p><p>기본적으로 InnoDB 스토리지 엔진은 버퍼풀을 통해 메모리 영역에 당장 활용되어야 하는 데이터들을 캐싱하고, 변경 내용들을 버퍼링(더티 페이지)하여 주기적인 플러싱(flushing)으로 백그라운드 작업을 통해 디스크에 실제로 반영하게 됩니다.</p><p>이러한 내용들을 요약해보면 아래와 같습니다.</p><hr><p><strong>버퍼링과 지연 쓰기</strong></p><ul><li><strong>버퍼풀</strong>:<ul><li>자주 접근하는 데이터 페이지를 메모리에 캐싱하여 I/O 감소</li></ul></li><li><strong>변경 버퍼(Change Buffer)</strong>:<ul><li>보조 인덱스 변경 사항을 메모리에 버퍼링하여 나중에 적용</li></ul></li><li><strong>쓰기 지연</strong>:<ul><li>변경 사항을 즉시 디스크에 쓰지 않고 더티 페이지로 유지하다가 효율적으로 일괄 처리</li></ul></li></ul><hr><p><strong>로깅과 복구 최적화</strong></p><ul><li><strong>리두 로그</strong>:<ul><li>변경 사항을 순차적인 로그에 먼저 기록하여 I/O 효율성 향상</li></ul></li><li><strong>그룹 커밋</strong>:<ul><li>여러 트랜잭션의 커밋을 묶어 처리하여 I/O 오버헤드 감소</li></ul></li><li><strong>이중 쓰기 버퍼</strong>:<ul><li>데이터 무결성을 보장하면서도 순차적 쓰기를 통해 I/O 효율성 향상</li></ul></li></ul><hr><p><strong>동시성 향상 기법</strong></p><ul><li><strong>MVCC(다중 버전 동시성 제어)</strong>:<ul><li>읽기 작업이 쓰기 작업을 차단하지 않도록 하여 전반적인 동시성 향상</li></ul></li><li><strong>버퍼풀 인스턴스 분할</strong>:<ul><li>내부 잠금 경합을 줄이고 병렬 처리 효율 향상</li></ul></li><li><strong>백그라운드 처리</strong>:<ul><li>페이지 클리너 스레드가 더티 페이지를 비동기적으로 디스크에 기록</li></ul></li></ul><h3 id=lsm-tree-기반-시스템의-주요-최적화-cassandra-사례>LSM Tree 기반 시스템의 주요 최적화 (Cassandra 사례)</h3><p><img src=/post/db/rdbms-nosql/img_1.png width=1355 height=854 srcset="/post/db/rdbms-nosql/img_1_hub64386be61c9330102f53e13d81bc75b_321472_480x0_resize_box_3.png 480w, /post/db/rdbms-nosql/img_1_hub64386be61c9330102f53e13d81bc75b_321472_1024x0_resize_box_3.png 1024w" loading=lazy alt="LSM Tree 기반 시스템 처리" class=gallery-image data-flex-grow=158 data-flex-basis=380px></p><p>카산드라는 아래와 같은 순서로 쓰기 작업이 수행됩니다.</p><ul><li>커밋 로그에 데이터 기록하기</li><li>멤테이블에 데이터 쓰기</li><li>멤테이블에서 데이터 플러시하기</li><li>SSTables의 디스크에 데이터 저장</li></ul><p>처음 커밋 로그에 데이터를(내구성 보장을 위해) 기록하고 멤테이블에 데이터를 쓰게되는데, 멤테이블은 쓰기를 버퍼링하고 데이터 파티션을 캐싱하는 역할도 함께 수행하게 됩니다.</p><p>멤테이블은 지정한 크기에 도달할 때 까지 정렬된 순서를 유지하며 쓰기를 캐싱하고, 한계에 도달하면 디스크에 플러시되어 SS테이블로 저장됩니다.</p><p>SS테이블은 변경 불가능하므로 데이터가 업데이트되거나 삭제될 때 이전 데이터를 삽입 또는 업데이트로 덮어쓰거나 SS테이블에서 제거하지 않습니다.</p><p>대신 새 타임스탬프가 있는 업데이트된 데이터로 새 SS테이블이 만들어지고 이전 SS테이블은 삭제 표시가 됩니다. (삭제된 데이터 조각을 툼스톤이라고 함)</p><hr><p><strong>컴팩션 전략 최적화</strong></p><p>이러한 특성으로 인해 여러 버전의 행을 여러 SS테이블에 기록할 수 있고, SS테이블이 많아지면 전체 행을 검색하기 위해 점점 더 많은 SS테이블에 액세스해야 할 수 있습니다.</p><p>이로 인해 읽기 성능이 떨어지는 것을 막기 위해 주기적으로 SS테이블을 병합하고 오래된 데이터를 폐기하는데, 이를 컴팩션이라고 합니다.</p><p>컴팩션은 백그라운드로 수행되긴 하지만 쓰기 작업을 발생시키므로 이를 최적화하는 방법들이 있습니다.</p><ul><li><strong>레벨 컴팩션(Leveled Compaction)</strong>:<ul><li>데이터를 여러 레벨로 구성하여 컴팩션 비용 분산</li></ul></li><li><strong>사이즈 단계별 컴팩션(Size-Tiered Compaction)</strong>:<ul><li>비슷한 크기의 SS테이블끼리 병합하여 효율성 향상</li></ul></li><li><strong>컴팩션 스로틀링</strong>:<ul><li>컴팩션이 다른 작업에 미치는 영향을 제한하여 일관된 성능 유지</li></ul></li></ul><hr><p><strong>읽기 성능 향상 기법</strong></p><p>컴팩션 외에도 읽기 성능을 향상시키는 기법들도 존재합니다.</p><ul><li><strong>블룸 필터</strong>:<ul><li>특정 키가 SS테이블에 없다는 것을 효율적으로 확인하여 불필요한 디스크 접근 감소</li></ul></li><li><strong>파티셔닝</strong>:<ul><li>데이터를 파티션으로 나누어 병렬 처리 및 검색 범위 축소</li></ul></li><li><strong>인덱스 요약(Index Summary)</strong>:<ul><li>각 SS테이블의 키 범위 정보를 메모리에 유지하여 검색 효율 향상</li></ul></li></ul><hr><p><strong>쓰기 최적화</strong></p><p>아래와 같은 방법들이 도움이 될 수 있습니다.</p><ul><li><strong>WAL 최적화</strong>:<ul><li>로그 압축, 그룹 커밋 등을 통한 로깅 효율성 향상</li></ul></li><li><strong>멤테이블 구현 최적화</strong>:<ul><li>효율적인 자료구조(스킵 리스트 등) 사용으로 메모리 내 작업 속도 향상</li></ul></li><li><strong>직접 I/O</strong>:<ul><li>운영체제 캐시를 우회하여 데이터베이스가 자체적으로 메모리 관리 가능</li></ul></li></ul><h2 id=어떤-상황에-어떤-저장-구조가-적합한가>어떤 상황에 어떤 저장 구조가 적합한가?</h2><p>완벽하게 적합한지 결정하기는 어렵지만, 일반적으로 아래와 같은 상황에 맞는 저장 구조를 활용하면 좋다고 알려져 있습니다.</p><h3 id=b-tree가-적합한-상황>B-Tree가 적합한 상황</h3><ul><li><strong>복잡한 트랜잭션이 필요한 경우</strong>:<ul><li>ACID 속성이 중요한 금융, 전자상거래 애플리케이션</li></ul></li><li><strong>다양한 인덱싱과 복잡한 쿼리가 필요한 경우</strong>:<ul><li>다중 인덱스, 조인, 집계 함수 등을 활용하는 분석 시스템</li></ul></li><li><strong>읽기 작업이 쓰기보다 훨씬 많은 경우</strong>:<ul><li>데이터 변경이 적고 조회가 빈번한 시스템</li></ul></li><li><strong>데이터 크기가 메모리에 대부분 캐싱될 수 있는 경우</strong>:<ul><li>데이터셋이 상대적으로 작은 시스템</li></ul></li></ul><h3 id=lsm-tree가-적합한-상황>LSM Tree가 적합한 상황</h3><ul><li><strong>대규모 쓰기 워크로드</strong>:<ul><li>로그 수집, IoT 센서 데이터, 클릭스트림 추적 등 초당 수만에서 수십만 건의 삽입이 필요한 경우</li></ul></li><li><strong>스키마리스 데이터 모델이 필요한 경우</strong>:<ul><li>빠르게 변화하는 비즈니스 요구사항에 대응해야 하는 시스템</li></ul></li><li><strong>수평적 확장성이 중요한 경우</strong>:<ul><li>샤딩을 통해 쉽게 확장해야 하는 분산 시스템</li></ul></li><li><strong>압축률이 중요한 경우</strong>:<ul><li>저장 공간 효율성이 중요한 대용량 데이터 시스템</li></ul></li></ul><h2 id=선택-시-고려사항>선택 시 고려사항</h2><p>적합한 저장 구조를 선택할 때 아래와 같은 내용을 고려한다면 조금 더 쉽게 결정할 수 있습니다.</p><h3 id=워크로드-특성>워크로드 특성</h3><ul><li><strong>읽기/쓰기 비율</strong>:<ul><li>읽기가 주로 필요하면 B-Tree, 쓰기가 많으면 LSM Tree 고려</li></ul></li><li><strong>쿼리 패턴</strong>:<ul><li>복잡한 조인과 트랜잭션이 필요하면 B-Tree, 단순 키-값 조회가 주된 작업이면 LSM Tree 적합</li></ul></li><li><strong>데이터 크기와 성장 속도</strong>:<ul><li>대용량 데이터와 빠른 성장이 예상되면 LSM Tree의 압축률과 확장성이 유리</li></ul></li></ul><h3 id=하드웨어-환경>하드웨어 환경</h3><ul><li><strong>스토리지 유형</strong>:<ul><li>HDD 환경에서는 순차적 I/O에 최적화된 LSM Tree가 유리, SSD에서는 차이가 줄어듦</li></ul></li><li><strong>메모리 용량</strong>:<ul><li>대용량 메모리가 가능한 환경에서는 B-Tree의 캐싱 효과가 극대화됨</li></ul></li><li><strong>CPU 자원</strong>:<ul><li>LSM Tree의 컴팩션은 추가 CPU 리소스를 소모하므로 CPU 제한 환경에서는 고려 필요</li></ul></li></ul><h3 id=실제-벤치마크-테스트의-중요성>실제 벤치마크 테스트의 중요성</h3><p>이론적인 성능 특성은 중요한 지침이 되지만, 실제 운영 환경에서는 예상과 다른 결과가 나올 수 있습니다.</p><ul><li><strong>실제 데이터와 패턴 사용</strong>:<ul><li>실제 애플리케이션의 데이터 분포와 쿼리 패턴을 반영한 벤치마크 수행</li></ul></li><li><strong>확장성 테스트</strong>:<ul><li>현재 데이터 크기뿐만 아니라 예상되는 미래 데이터 크기에서도 테스트</li></ul></li><li><strong>장기 실행 테스트</strong>:<ul><li>시간이 지남에 따른 성능 변화(단편화, 컴팩션 오버헤드 등) 평가</li></ul></li></ul><h2 id=결론>결론</h2><p>B-Tree와 LSM Tree는 각각 고유한 장단점을 가진 저장 구조입니다. 전통적으로 B-Tree는 읽기에, LSM Tree는 쓰기에 최적화되어 있다고 여겨지고 일반적으로 그렇지만, 현대적인 데이터베이스 엔진들은 다양한 최적화를 통해 이러한 문제들을 보완하고 있습니다.</p><p>이전 직장에서도 다양한 유형의 워크로드를 RDBMS 만으로도 처리했었고, 쓰기 작업이 불리하다고 여겨지는 RDBMS가 실제 사용했을 때 큰 문제가 발생하지 않는 이유를 살펴보니, 극단적으로 많은 처리가 필요한 상황이 아니라면 &ldquo;적합한 데이터베이스 선택"과 같은 문제는 사소한 문제인걸까? 라는 생각도 들었습니다.</p><p>더 나아가서 새로운 기술들을 적용하는 것 자체가 대부분의 상황에서 불필요할 수도 있겠다는 회의감도 새삼스럽게 드는 것 같습니다.</p><p>이러한 고민을 적용해 볼 수 있는 곳에서 꼭 일해보고 싶네요! 끝까지 읽어주셔서 감사합니다😊</p></section><footer class=article-footer><section class=article-tags><a href=/tags/database/>Database</a>
<a href=/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/>데이터베이스</a>
<a href=/tags/rdbms/>RDBMS</a>
<a href=/tags/%EA%B4%80%EA%B3%84%ED%98%95-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/>관계형 데이터베이스</a>
<a href=/tags/log-structured/>Log-Structured</a>
<a href=/tags/%EB%A1%9C%EA%B7%B8-%EA%B5%AC%EC%A1%B0/>로그 구조</a>
<a href=/tags/page-oriented/>Page-Oriented</a>
<a href=/tags/%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%A7%80%ED%96%A5/>페이지 지향</a>
<a href=/tags/b-tree/>B-Tree</a>
<a href=/tags/b+tree/>B+Tree</a>
<a href=/tags/lsm-tree/>LSM Tree</a>
<a href=/tags/%EB%A1%9C%EA%B7%B8-%EA%B5%AC%EC%A1%B0%ED%99%94-%EB%B3%91%ED%95%A9-%ED%8A%B8%EB%A6%AC/>로그 구조화 병합 트리</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class="article-list--compact links"><article><a href=/post/designing-data-intensive-application/3/1/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>저정소와 검색: 데이터베이스를 강력하게 만드는 데이터 구조</h2><footer class=article-time>데이터 중심 애플리케이션 설계</footer></div></a></article><article><a href=/post/real_mysql_4/2/1/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>InnoDB 스토리지 엔진 아키텍처(1)</h2><footer class=article-time>RealMySQL 8.0</footer></div></a></article><article><a href=/post/real_mysql_4/2/2/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>InnoDB 스토리지 엔진 아키텍처(2) - 버퍼풀</h2><footer class=article-time>RealMySQL 8.0</footer></div></a></article><article><a href=/post/real_mysql_4/2/3/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>InnoDB 스토리지 엔진 아키텍처(3)</h2><footer class=article-time>RealMySQL 8.0</footer></div></a></article></div><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/boostcamp-9th/review/challenge/4/><div class=article-image><img src=/post/boostcamp-9th/review/challenge/4/cover.1a9a8e05cdd87c13be1cd4efdcd8d800_hu19d27c1827c5e9fb407a4e610db031e0_130036_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 챌린지 과정 4주차 회고" data-key=boostcamp-9th/review/challenge/4 data-hash="md5-GpqOBc3YfBO+HNTv3NjYAA=="></div><div class=article-details><h2 class=article-title>챌린지 과정 4주차 회고</h2></div></a></article><article class=has-image><a href=/post/movielens/2/><div class=article-image><img src=/post/movielens/2/cover.b58f190c97e00f5e1877639742b37ab3_hu223669cbbbe5efa1c70286790dba8a54_16582_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post [MovieLens] 2. DB 설계" data-key=movielens/2 data-hash="md5-tY8ZDJfgD14Yd2OXQrN6sw=="></div><div class=article-details><h2 class=article-title>[MovieLens] 2. DB 설계</h2></div></a></article><article class=has-image><a href=/post/db/where-on/><div class=article-image><img src=/post/db/where-on/cover.ab18cf7cea1295bfbcb3bfc90b24de83_hu3d445aeca10173b7df51d6f3cd6c9292_48066_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post OUTER JOIN의 WHERE, ON 처리에 대한 오해와 진실" data-key=db/where-on data-hash="md5-qxjPfOoSlb+8s7/JCyTegw=="></div><div class=article-details><h2 class=article-title>OUTER JOIN의 WHERE, ON 처리에 대한 오해와 진실</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=codemario318/codemario318.github.io issue-term=pathname label=Comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Mario Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>