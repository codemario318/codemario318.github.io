<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><title>11. 뉴스 피드 시스템 설계</title><link rel=canonical href=https://codemario318.github.io/post/system-design-interview/11/><link rel=stylesheet href=/scss/style.min.cbce94e2760d14d60414e59d5a36ab2819232375817e010dbe7be2234b67da1b.css><meta property="og:title" content="11. 뉴스 피드 시스템 설계"><meta property="og:description" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><meta property="og:url" content="https://codemario318.github.io/post/system-design-interview/11/"><meta property="og:site_name" content="Mario Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><meta property="article:tag" content="System Design Interview"><meta property="article:tag" content="뉴스 피드"><meta property="article:tag" content="News Feed"><meta property="article:tag" content="API"><meta property="article:tag" content="그래프 데이터베이스"><meta property="article:tag" content="Graph Database"><meta property="article:tag" content="메시지 큐"><meta property="article:tag" content="Messege Queue"><meta property="article:tag" content="안정 해시"><meta property="article:tag" content="Consistent Hashing"><meta property="article:tag" content="Pre-computed"><meta property="article:tag" content="요청 기반 모델"><meta property="article:tag" content="On-demand Model"><meta property="article:tag" content="CDN"><meta property="article:tag" content="캐시"><meta property="article:tag" content="Cache"><meta property="article:published_time" content="2024-07-04T22:51:50+09:00"><meta property="article:modified_time" content="2024-07-04T22:51:50+09:00"><meta property="og:image" content="https://codemario318.github.io/post/system-design-interview/11/cover.png"><meta name=twitter:title content="11. 뉴스 피드 시스템 설계"><meta name=twitter:description content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codemario318.github.io/post/system-design-interview/11/cover.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-K99591YLGK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K99591YLGK",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3183752545292673" crossorigin=anonymous></script><meta name=naver-site-verification content="2315bde85c86f66092140cc465c340a2170f3187"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu760fd15c5fbb2f30cf0868dc4a5dc41a_14271_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Mario Blog</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/codemario318 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><ul class="menu sub-menu"><li><a href=/categories/backend/><span>Backend</span>
<span class=content-count>3</span></a></li><li><a href=/categories/boostcamp/><span>부스트캠프</span>
<span class=content-count>6</span></a></li><li><a href=/categories/cleancode/><span>Clean Code</span>
<span class=content-count>10</span></a></li><li><a href=/categories/common/><span>Common</span>
<span class=content-count>57</span></a></li><li><a href=/categories/data/><span>Data</span>
<span class=content-count>3</span></a></li><li><a href=/categories/db/><span>DB</span>
<span class=content-count>1</span></a></li><li><a href=/categories/frontend/><span>Frontend</span>
<span class=content-count>10</span></a></li><li><a href=/categories/golang/><span>GoLang</span>
<span class=content-count>13</span></a></li><li><a href=/categories/headfirstdesignpatterns/><span>헤드 퍼스트 디자인 패턴</span>
<span class=content-count>22</span></a></li><li><a href=/categories/infra/><span>Infra</span>
<span class=content-count>14</span></a></li><li><a href=/categories/network/><span>네트워크</span>
<span class=content-count>1</span></a></li><li><a href=/categories/node/><span>Node</span>
<span class=content-count>1</span></a></li><li><a href=/categories/problemsolving/><span>Problem Solving</span>
<span class=content-count>1</span></a></li><li><a href=/categories/project/><span>Project</span>
<span class=content-count>5</span></a></li><li><a href=/categories/realmysql/><span>Real MySQL</span>
<span class=content-count>53</span></a></li></ul><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#뉴스-피드란>뉴스 피드란?</a></li><li><a href=#1단계-문제-이해-및-설계-범위-확정>1단계: 문제 이해 및 설계 범위 확정</a></li><li><a href=#개략적-설계안-제시-및-동의-구하기>개략적 설계안 제시 및 동의 구하기</a><ol><li><a href=#뉴스-피드-api>뉴스 피드 API</a></li><li><a href=#피드-발행>피드 발행</a></li><li><a href=#뉴스-피드-생성>뉴스 피드 생성</a></li></ol></li><li><a href=#3단계-상세-설계>3단계: 상세 설계</a><ol><li><a href=#피드-발행-흐름-상세-설계>피드 발행 흐름 상세 설계</a></li><li><a href=#피드-읽기-흐름-상세-설계>피드 읽기 흐름 상세 설계</a></li><li><a href=#캐시-구조>캐시 구조</a></li></ol></li><li><a href=#4단계-마무리>4단계: 마무리</a><ol><li><a href=#데이터베이스-규모-확장>데이터베이스 규모 확장</a></li><li><a href=#그-외>그 외</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/system-design-interview/11/><img src=/post/system-design-interview/11/cover_huebcf5dd667df9af228f80687035dfdfb_164704_800x0_resize_box_3.png srcset="/post/system-design-interview/11/cover_huebcf5dd667df9af228f80687035dfdfb_164704_800x0_resize_box_3.png 800w, /post/system-design-interview/11/cover_huebcf5dd667df9af228f80687035dfdfb_164704_1600x0_resize_box_3.png 1600w" width=800 height=454 loading=lazy alt="Featured image of post 11. 뉴스 피드 시스템 설계"></a></div><div class=article-details><header class=article-category><a href=/categories/common/ style=background-color:#2a9d8f;color:#fff>Common</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/system-design-interview/11/>11. 뉴스 피드 시스템 설계</a></h2><h3 class=article-subtitle>가상 면접 사례로 배우는 대규모 시스템 설계 기초</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2024/07/04</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h2 id=뉴스-피드란>뉴스 피드란?</h2><p>페이스북의 도움말 페이지에서는 아래와 같이 뉴스 피드를 설명하고 있다.</p><blockquote><p>홈 페이지 중앙에 지속적으로 업데이트되는 스토리와 사용자 상태 정보 업데이트, 사진, 비디오, 링크, 앱 활동 팔로우하는 사람들, 페이지, 그룹으로부터 나오는 좋아요 등을 포함한다.</p></blockquote><p>뉴스 피드 시스템 설계는 아주 유명한 면접 문제이다.</p><h2 id=1단계-문제-이해-및-설계-범위-확정>1단계: 문제 이해 및 설계 범위 확정</h2><ul><li>Q. 모바일 앱, 웹 어떤걸 지원해야하는가?<ul><li>A. 둘다.</li></ul></li><li>Q. 주요 기능은?<ul><li>A. 사용자는 뉴스 피드 페이지에 새로운 스토리를 올릴 수 있어야함<ul><li>친구들이 올리는 스토리를 볼 수도 있어야함</li></ul></li></ul></li><li>Q. 어떤 순서로 스토리가 표시되는가? 최신 포스트? 토픽 점수 기반?<ul><li>A. 시간 흐름 역순으로 표시(Reverse chronological order)</li></ul></li><li>Q. 한 명의 사용자는 최대 몇 명의 친구를 가질 수 있는가?<ul><li>A. 5,000명</li></ul></li><li>Q. 트래픽 규모는?<ul><li>A. 매일 천만 명 방문한다고 가정</li></ul></li><li>Q. 피드에 이미지나 비디오 스토리도 올라올 수 있는가?<ul><li>A. 이미지나 비디오 등 미디어 파일이 포함될 수 있음</li></ul></li></ul><h2 id=개략적-설계안-제시-및-동의-구하기>개략적 설계안 제시 및 동의 구하기</h2><p>뉴스 피드 시스템 설계는 <strong>피드 발행</strong>(Feed publishing)과 <strong>뉴스 피드 생성</strong>(News feed building) 두 가지 구분으로 나눌 수 있다.</p><ul><li>피드 발행<ul><li>사용자가 스토리를 포스팅하면 해당 데이터를 캐시와 데이터베이스에 기록한다.</li><li>새 포스팅은 친구의 뉴스 피드에도 전송된다.</li></ul></li><li>뉴스 피드 생성<ul><li>뉴스 피드는 모든 친구의 포스팅을 시간 흐름 역순으로 모아서 만든다고 가정한다.</li></ul></li></ul><h3 id=뉴스-피드-api>뉴스 피드 API</h3><p>뉴스 피드 API는 HTTP 프로토콜 기반으로 클라이언트가 서버와 통신하기 위해 사용하는 수단이다.</p><ul><li>상태 정보를 업데이트 할 때</li><li>뉴스 피드를 가져올 때</li><li>친구를 추가하는 등 다양한 작업 수행</li></ul><p><strong>피드 발행 API</strong></p><p>새 스토리를 포스팅하기 위한 API다.</p><p>HTTP POST 형태로 요청을 보낸다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /v1/me/feed
</span></span></code></pre></td></tr></table></div></div><ul><li>인자<ul><li>body: 포스트 내용</li><li>Authorization 헤더: API 호출을 인증하기 위해 사용한다.</li></ul></li></ul><p><strong>피드 읽기 API</strong></p><p>뉴스 피드를 가져오는 API다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /v1/me/feed
</span></span></code></pre></td></tr></table></div></div><ul><li>인자<ul><li>Authorization 헤더: API 호출을 인증하기 위해 사용한다.</li></ul></li></ul><h3 id=피드-발행>피드 발행</h3><p><img src=/post/system-design-interview/11/img.png width=537 height=818 srcset="/post/system-design-interview/11/img_hu891d2a45b04e66955eabc83b2e6d7650_139382_480x0_resize_box_3.png 480w, /post/system-design-interview/11/img_hu891d2a45b04e66955eabc83b2e6d7650_139382_1024x0_resize_box_3.png 1024w" loading=lazy alt="피드 발행 구조" class=gallery-image data-flex-grow=65 data-flex-basis=157px></p><ul><li>사용자<ul><li>모바일 앱이나 브라우저에서 새 포스팅을 올리는 주체</li><li><code>POST /v1/me/feed</code> API를 사용</li></ul></li><li>로드밸런서(load balancer)<ul><li>트래픽을 웹 서버들로 분산</li></ul></li><li>웹 서버<ul><li>HTTP 요청을 내부 서비스로 중계하는 역할을 담당</li></ul></li><li>포스팅 저장 서비스(Post service)<ul><li>새 포스팅을 데이터베이스와 캐시에 저장</li></ul></li><li>포스팅 전송 서비스(Fanout service)<ul><li>새 포스팅을 친구의 뉴스피드에 푸시(push)</li><li>뉴스 피드 데이터는 캐시에 보관하여 빠르게 읽어갈 수 있도록 해야함</li></ul></li><li>알림 서비스(notification service)<ul><li>친구들에게 새 포스팅이 올라왔음을 알림</li><li>푸시 알림을 보냄</li></ul></li></ul><h3 id=뉴스-피드-생성>뉴스 피드 생성</h3><p><img src=/post/system-design-interview/11/img_1.png width=425 height=634 srcset="/post/system-design-interview/11/img_1_hu69fcfbc2dbdf50bdcc685e78596b2bbb_88291_480x0_resize_box_3.png 480w, /post/system-design-interview/11/img_1_hu69fcfbc2dbdf50bdcc685e78596b2bbb_88291_1024x0_resize_box_3.png 1024w" loading=lazy alt="뉴스 피드 생성 구조" class=gallery-image data-flex-grow=67 data-flex-basis=160px></p><ul><li>사용자<ul><li>뉴스 피드를 읽는 주체</li><li><code>GET /v1/me/feed</code>를 이용</li></ul></li><li>로드 밸런서<ul><li>트래픽을 웹 서버들로 분산</li></ul></li><li>웹 서버<ul><li>트래픽을 뉴스 피드 서비스로 보냄</li></ul></li><li>뉴스 피드 서비스(news feed service)<ul><li>캐시에서 뉴스 피드를 가져오는 서비스</li></ul></li><li>뉴스 피드 캐시(news feed cache)<ul><li>랜더링할 때 필요한 피드ID를 보관</li></ul></li></ul><h2 id=3단계-상세-설계>3단계: 상세 설계</h2><h3 id=피드-발행-흐름-상세-설계>피드 발행 흐름 상세 설계</h3><p>웹 서버와 포스팅 전송 서비스에 초점을 두고 확인한다.</p><p><strong>웹 서버</strong></p><p>클라이언트와 통신할 뿐 아니라 인증이나 처리율 제한 기능도 수행한다.</p><ul><li>올바른 인증 토큰을 Authorization 헤더에 넣고 API를 호출하는 사용자만 포스팅 할 수 있어야 한다.</li><li>스팸을 막고 유해한 콘텐츠가 자주 올라오는 것을 방지하기 위해 사용자가 올리 수 있는 포스팅 수를 제한을 둬야한다.</li></ul><p><strong>포스팅 전송(팬아웃) 서비스</strong></p><p>포스팅 전송, 즉 팬아웃(fanout)은 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정이다.</p><p><img src=/post/system-design-interview/11/img_2.png width=863 height=952 srcset="/post/system-design-interview/11/img_2_huda53be8af4aa5fdd5c6f7a22043667e4_267454_480x0_resize_box_3.png 480w, /post/system-design-interview/11/img_2_huda53be8af4aa5fdd5c6f7a22043667e4_267454_1024x0_resize_box_3.png 1024w" loading=lazy alt="포스팅 전송 서비스" class=gallery-image data-flex-grow=90 data-flex-basis=217px></p><p>두 가지 유형이 존재하며 각기 장단점을 가진다.</p><p><strong>푸시 모델(push model)</strong></p><p>새로운 포스팅을 기록하는 시점(쓰기 시점)에 뉴스피드를 갱신하게 된다.</p><p>다시 말해, 포스팅이 완료되면 바로 해당 사용자의 캐시에 해당 포스팅을 기록한다.</p><ul><li>장점<ul><li>뉴스피드가 실시간으로 갱신되며 친구 목록에 있는 사용자에게 <strong>즉시 전송</strong></li><li>새 포스팅이 기록되는 순간에 뉴스 피드가 이미 갱신되므로(pre-computed) 뉴스 피드를 읽는 데 드는 시간이 짧아짐</li></ul></li><li>단점<ul><li>친구가 많은 사용자의 경우 뉴스 피드를 갱신하는 데 많은 시간이 소요될 수도 있음<ul><li>핫키(Hotkey) 문제</li></ul></li><li>서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야 하므로 자원 낭비</li></ul></li></ul><p><strong>풀 모델(pull model)</strong></p><p>피드를 읽어야 하는 시점에 뉴스 피드를 갱신한다.</p><p>따라서 <strong>요청 기반</strong>(on-demand) 모델이며, 사용자가 본인 홈페이지나 타임 라인을 로딩하는 시점에 새로운 포스트를 가져오게 된다.</p><ul><li>장점<ul><li>로그인하기까지는 어떤 컴퓨팅 자원도 소모하지 않으므로 비활성화된 사용자는 이 모델이 유리하다.</li><li>데이터를 친구 각각에 푸시하는 작업이 필요 없으므로 핫키 문제도 생기지 않는다.</li></ul></li><li>단점<ul><li>뉴스 피드를 읽는 데 많은 시간이 소요될 수 있다.</li></ul></li></ul><hr><p>이번 설계안은 두 가지 방법을 결합하여 장점은 취하고 단점은 버린다.</p><ul><li>뉴스피드를 빠르게 가져올 수 있도록 하는 것은 아주 중요하므로 대부분의 사용자에 대해서 푸시 모델 사용</li><li>친구, 팔로워가 아주 많은 사용자의 경우는 해당 사용자의 포스팅을 필요할 때 가져가도록 하는 풀 모델을 사용</li><li>안정 해시(consistent hashing)을 통해 요청과 데이터를 고르게 분산하여 핫 키 문제를 완화</li></ul><p><img src=/post/system-design-interview/11/img_3.png width=643 height=597 srcset="/post/system-design-interview/11/img_3_hua09b20c3092217fe155cb7d5889b4e53_145261_480x0_resize_box_3.png 480w, /post/system-design-interview/11/img_3_hua09b20c3092217fe155cb7d5889b4e53_145261_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=107 data-flex-basis=258px></p><ol><li><strong>그래프 데이터베이스</strong>에서 친구 ID 목록을 가져온다.<ul><li>그래프 데이터베이스는 친구 관계나 친구 추천을 관리하기 적합하다.</li></ul></li><li>사용자 정보 캐시에서 친구들의 정보를 가져온후, 설정에 따라 일부 걸러낸다.<ul><li>차단 등 이유로</li></ul></li><li>친구 목록과 새 스토리의 포스팅 ID를 메시키 큐에 넣는다.</li><li>팬아웃 작업 서버가 메시지 큐에서 데이터를 꺼내 뉴스 피드 데이터를 뉴스 피드 캐시에 넣는다.<ul><li>뉴스 피드 캐시: <code>&lt;포스팅 ID, 사용자 ID></code></li><li>모든 데이터를 포함하면 메모리 요구량이 지나치게 늘어날 수 있다.</li><li>어떤 사용자가 뉴스 피드에 올라온 수천 개의 스토리를 볼 확률은 지극히 낮다.(캐시 미스 확률이 낮다.)</li></ul></li></ol><h3 id=피드-읽기-흐름-상세-설계>피드 읽기 흐름 상세 설계</h3><p><img src=/post/system-design-interview/11/img_4.png width=724 height=728 srcset="/post/system-design-interview/11/img_4_hufb1b28fc20f324cce39c94a4369c34ac_210247_480x0_resize_box_3.png 480w, /post/system-design-interview/11/img_4_hufb1b28fc20f324cce39c94a4369c34ac_210247_1024x0_resize_box_3.png 1024w" loading=lazy alt="피드 읽기 흐름" class=gallery-image data-flex-grow=99 data-flex-basis=238px></p><p>이미지나 비디오와 같은 미디어 콘텐츠는 CDN에 저장하여 빨리 읽어갈 수 있도록 한다.</p><ol><li>사용자가 뉴스 피드 읽기 요청을 보냄</li><li>로드밸런서가 요청을 웹 서버 가운데 하나로 보냄</li><li>피드를 가져오기 위해 뉴스 피드 서비스 호출</li><li>뉴스 피드 캐시에서 포스팅 ID 목록을 조회</li><li>사용자 이름, 사용자 사진 등을 사용자 캐시와 포스팅 캐시에서 가져와 완전한 뉴스 피드 생성</li><li>JSON 형태로 응답</li></ol><h3 id=캐시-구조>캐시 구조</h3><p>캐시는 <strong>뉴스 피드 시스템의 핵심 컴포넌트</strong>이다.</p><p><img src=/post/system-design-interview/11/img_5.png width=831 height=461 srcset="/post/system-design-interview/11/img_5_hu7a050117f609eaff8b50eedec13da585_109520_480x0_resize_box_3.png 480w, /post/system-design-interview/11/img_5_hu7a050117f609eaff8b50eedec13da585_109520_1024x0_resize_box_3.png 1024w" loading=lazy alt="5계층 캐시 구조" class=gallery-image data-flex-grow=180 data-flex-basis=432px></p><ul><li>뉴스피드<ul><li>뉴스 피드의 ID 보관</li></ul></li><li>콘텐츠<ul><li>포스팅 데이터를 보관</li><li>인기 콘텐츠는 따로 보관</li></ul></li><li>소셜 그래프<ul><li>사용자 간 관계 정보를 보관</li></ul></li><li>행동(action)<ul><li>포스팅에 대한 사용자의 행위에 관한 정보를 보관</li><li>좋아요, 답글 등</li></ul></li><li>횟수(counter)<ul><li>좋아요 횟수, 응답 수, 팔로워 수, 팔로잉 수 등 보관</li></ul></li></ul><h2 id=4단계-마무리>4단계: 마무리</h2><p>이번 설계안은 <strong>뉴스 피드 발행</strong>, <strong>뉴스 피드 생성</strong> 두 부분으로 구성되어 있다.</p><p>설계를 진행하고 기술을 선택할 때는 그 배경에 어떤 타협적 결정들이 있었는지 잘 이해하고 설명할 수 있어야 한다.</p><p>시간이 남는다면 <strong>규모 확장성 이슈</strong>를 논의하는 것이 좋을 수 있다.</p><h3 id=데이터베이스-규모-확장>데이터베이스 규모 확장</h3><ul><li>수직적 규모 확장 vs 수평적 규모 확장</li><li>SQL vs NoSQL</li><li>master-slave 다중화</li><li>복제본(replica)에 대한 읽기 연산</li><li>일관성 모델(consistency model)</li><li>데이터베이스 샤딩</li></ul><h3 id=그-외>그 외</h3><ul><li>웹 계층을 무상태로 운영하기</li><li>가능한 한 많은 데이터를 캐시할 방법</li><li>여러 데이터 센터를 지원할 방법</li><li>메시지 큐를 사용하여 컴포넌트 사이의 결합도 낮추기</li><li>핵심 메트릭에 대한 모니터링<ul><li>트래픽이 몰리는 시간대의 QPS</li><li>사용자가 뉴스 피드를 새로고침 할 때 지연 시간 등</li></ul></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/%EA%B0%80%EC%83%81-%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84-%EA%B8%B0%EC%B4%88/>가상 면접 사례로 배우는 대규모 시스템 설계 기초</a>
<a href=/tags/system-design-interview/>System Design Interview</a>
<a href=/tags/%EB%89%B4%EC%8A%A4-%ED%94%BC%EB%93%9C/>뉴스 피드</a>
<a href=/tags/news-feed/>News Feed</a>
<a href=/tags/api/>API</a>
<a href=/tags/%EA%B7%B8%EB%9E%98%ED%94%84-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/>그래프 데이터베이스</a>
<a href=/tags/graph-database/>Graph Database</a>
<a href=/tags/%EB%A9%94%EC%8B%9C%EC%A7%80-%ED%81%90/>메시지 큐</a>
<a href=/tags/messege-queue/>Messege Queue</a>
<a href=/tags/%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C/>안정 해시</a>
<a href=/tags/consistent-hashing/>Consistent Hashing</a>
<a href=/tags/pre-computed/>Pre-computed</a>
<a href=/tags/%EC%9A%94%EC%B2%AD-%EA%B8%B0%EB%B0%98-%EB%AA%A8%EB%8D%B8/>요청 기반 모델</a>
<a href=/tags/on-demand-model/>On-demand Model</a>
<a href=/tags/cdn/>CDN</a>
<a href=/tags/%EC%BA%90%EC%8B%9C/>캐시</a>
<a href=/tags/cache/>Cache</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class="article-list--compact links"><article><a href=https://product.kyobobook.co.kr/detail/S000001033116 target=_blank rel=noopener><div class=article-details><h2 class=article-title>가상 면접 사례로 배우는 대규모 시스템 설계 기초</h2><footer class=article-time>교보문고</footer></div></a></article></div><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/system-design-interview/5/><div class=article-image><img src=/post/system-design-interview/5/cover.19a01050cbb7e15d6051c06331fb6a04_huebcf5dd667df9af228f80687035dfdfb_164704_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 5. 안정 해시 설계" data-key=system-design-interview/5 data-hash="md5-GaAQUMu34V1gUcBjMftqBA=="></div><div class=article-details><h2 class=article-title>5. 안정 해시 설계</h2></div></a></article><article class=has-image><a href=/post/system-design-interview/1/><div class=article-image><img src=/post/system-design-interview/1/cover.19a01050cbb7e15d6051c06331fb6a04_huebcf5dd667df9af228f80687035dfdfb_164704_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 1. 사용자 수에 따른 규모 확장성" data-key=system-design-interview/1 data-hash="md5-GaAQUMu34V1gUcBjMftqBA=="></div><div class=article-details><h2 class=article-title>1. 사용자 수에 따른 규모 확장성</h2></div></a></article><article class=has-image><a href=/post/system-design-interview-2/3/><div class=article-image><img src=/post/system-design-interview-2/3/cover.eb0176bd1597a4b4423be0cc9ee612d7_huf565d8fe7a4f9f5a961306624616abfc_449360_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 3. 구글 맵" data-key=system-design-interview-2/3 data-hash="md5-6wF2vRWXpLRCO+DMnuYS1w=="></div><div class=article-details><h2 class=article-title>3. 구글 맵</h2></div></a></article><article class=has-image><a href=/post/system-design-interview-2/2/><div class=article-image><img src=/post/system-design-interview-2/2/cover.eb0176bd1597a4b4423be0cc9ee612d7_huf565d8fe7a4f9f5a961306624616abfc_449360_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 2. 주변 친구" data-key=system-design-interview-2/2 data-hash="md5-6wF2vRWXpLRCO+DMnuYS1w=="></div><div class=article-details><h2 class=article-title>2. 주변 친구</h2></div></a></article><article class=has-image><a href=/post/system-design-interview-2/1/><div class=article-image><img src=/post/system-design-interview-2/1/cover.eb0176bd1597a4b4423be0cc9ee612d7_huf565d8fe7a4f9f5a961306624616abfc_449360_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 1. 근접성 서비스" data-key=system-design-interview-2/1 data-hash="md5-6wF2vRWXpLRCO+DMnuYS1w=="></div><div class=article-details><h2 class=article-title>1. 근접성 서비스</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=codemario318/codemario318.github.io issue-term=pathname label=Comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 Mario Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>