<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><title>1. 사용자 수에 따른 규모 확장성</title><link rel=canonical href=https://codemario318.github.io/post/system-design-interview/1/><link rel=stylesheet href=/scss/style.min.cbce94e2760d14d60414e59d5a36ab2819232375817e010dbe7be2234b67da1b.css><meta property="og:title" content="1. 사용자 수에 따른 규모 확장성"><meta property="og:description" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><meta property="og:url" content="https://codemario318.github.io/post/system-design-interview/1/"><meta property="og:site_name" content="Mario Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><meta property="article:tag" content="System Design Interview"><meta property="article:tag" content="단일 서버"><meta property="article:tag" content="데이터베이스"><meta property="article:tag" content="수직적 규모 확장"><meta property="article:tag" content="vertical scaling"><meta property="article:tag" content="수평적 규모 확장"><meta property="article:tag" content="horizontal scaling"><meta property="article:tag" content="콘텐츠 전송 네트워크"><meta property="article:tag" content="CDN"><meta property="article:tag" content="무상태 웹 계층"><meta property="article:tag" content="데이터 센터"><meta property="article:tag" content="메시지 큐"><meta property="article:tag" content="로그"><meta property="article:tag" content="메트릭"><meta property="article:tag" content="자동화"><meta property="article:tag" content="데이터베이스 규모 확장"><meta property="article:tag" content="백만 사용자"><meta property="article:published_time" content="2024-04-22T14:53:50+09:00"><meta property="article:modified_time" content="2024-04-22T14:53:50+09:00"><meta property="og:image" content="https://codemario318.github.io/post/system-design-interview/1/cover.png"><meta name=twitter:title content="1. 사용자 수에 따른 규모 확장성"><meta name=twitter:description content="가상 면접 사례로 배우는 대규모 시스템 설계 기초"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codemario318.github.io/post/system-design-interview/1/cover.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-K99591YLGK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K99591YLGK",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3183752545292673" crossorigin=anonymous></script><meta name=naver-site-verification content="2315bde85c86f66092140cc465c340a2170f3187"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu760fd15c5fbb2f30cf0868dc4a5dc41a_14271_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Mario Blog</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/codemario318 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><ul class="menu sub-menu"><li><a href=/categories/backend/><span>Backend</span>
<span class=content-count>3</span></a></li><li><a href=/categories/boostcamp/><span>부스트캠프</span>
<span class=content-count>11</span></a></li><li><a href=/categories/cleancode/><span>Clean Code</span>
<span class=content-count>10</span></a></li><li><a href=/categories/common/><span>Common</span>
<span class=content-count>74</span></a></li><li><a href=/categories/data/><span>Data</span>
<span class=content-count>3</span></a></li><li><a href=/categories/db/><span>DB</span>
<span class=content-count>1</span></a></li><li><a href=/categories/frontend/><span>Frontend</span>
<span class=content-count>10</span></a></li><li><a href=/categories/golang/><span>GoLang</span>
<span class=content-count>13</span></a></li><li><a href=/categories/headfirstdesignpatterns/><span>헤드 퍼스트 디자인 패턴</span>
<span class=content-count>22</span></a></li><li><a href=/categories/infra/><span>Infra</span>
<span class=content-count>14</span></a></li><li><a href=/categories/nest/><span>Nest</span>
<span class=content-count>1</span></a></li><li><a href=/categories/network/><span>네트워크</span>
<span class=content-count>1</span></a></li><li><a href=/categories/node/><span>Node</span>
<span class=content-count>6</span></a></li><li><a href=/categories/problemsolving/><span>Problem Solving</span>
<span class=content-count>1</span></a></li><li><a href=/categories/project/><span>Project</span>
<span class=content-count>5</span></a></li><li><a href=/categories/realmysql/><span>Real MySQL</span>
<span class=content-count>53</span></a></li></ul><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#단일-서버>단일 서버</a></li><li><a href=#데이터베이스>데이터베이스</a><ol><li><a href=#어떤-데이터베이스를-사용할-것인가>어떤 데이터베이스를 사용할 것인가?</a></li></ol></li><li><a href=#수직적-규모-확장-vs-수평적-규모-확장>수직적 규모 확장 VS 수평적 규모 확장</a><ol><li><a href=#수직적-규모-확장vertical-scaling>수직적 규모 확장(vertical scaling)</a></li><li><a href=#수평적-규모-확장horizontal-scaling>수평적 규모 확장(horizontal scaling)</a></li><li><a href=#로드밸런서load-balancer>로드밸런서(Load balancer)</a></li><li><a href=#데이터베이스-다중화>데이터베이스 다중화</a></li><li><a href=#다중화를-고려한-설계>다중화를 고려한 설계</a></li></ol></li><li><a href=#캐시-cache>캐시 Cache</a><ol><li><a href=#캐시-계층>캐시 계층</a></li><li><a href=#캐시-사용-시-유의할-점>캐시 사용 시 유의할 점</a></li></ol></li><li><a href=#콘텐츠-전송-네트워크-cdn>콘텐츠 전송 네트워크 CDN</a><ol><li><a href=#cdn-사용-시-고려해야-할-사항>CDN 사용 시 고려해야 할 사항</a></li><li><a href=#cdn과-캐시가-추가된-설계>CDN과 캐시가 추가된 설계</a></li></ol></li><li><a href=#무상태stateless-웹-계층>무상태(Stateless) 웹 계층</a><ol><li><a href=#상태-정보-의존적인-아키텍처>상태 정보 의존적인 아키텍처</a></li><li><a href=#무상태-아키텍처>무상태 아키텍처</a></li><li><a href=#무상태-웹-계층을-갖는-설계>무상태 웹 계층을 갖는 설계</a></li></ol></li><li><a href=#데이터-센터>데이터 센터</a></li><li><a href=#메시지-큐message-queue>메시지 큐(Message Queue)</a></li><li><a href=#로그-메트릭-그리고-자동화>로그, 메트릭 그리고 자동화</a><ol><li><a href=#수정한-설계안>수정한 설계안</a></li></ol></li><li><a href=#데이터베이스-규모-확장>데이터베이스 규모 확장</a><ol><li><a href=#샤딩>샤딩</a></li><li><a href=#샤드를-적용한-아키텍처>샤드를 적용한 아키텍처</a></li></ol></li><li><a href=#백만-사용자-그리고-그-이상>백만 사용자, 그리고 그 이상</a></li><li><a href=#정리>정리</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/system-design-interview/1/><img src=/post/system-design-interview/1/cover_huebcf5dd667df9af228f80687035dfdfb_164704_800x0_resize_box_3.png srcset="/post/system-design-interview/1/cover_huebcf5dd667df9af228f80687035dfdfb_164704_800x0_resize_box_3.png 800w, /post/system-design-interview/1/cover_huebcf5dd667df9af228f80687035dfdfb_164704_1600x0_resize_box_3.png 1600w" width=800 height=454 loading=lazy alt="Featured image of post 1. 사용자 수에 따른 규모 확장성"></a></div><div class=article-details><header class=article-category><a href=/categories/common/ style=background-color:#2a9d8f;color:#fff>Common</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/system-design-interview/1/>1. 사용자 수에 따른 규모 확장성</a></h2><h3 class=article-subtitle>가상 면접 사례로 배우는 대규모 시스템 설계 기초</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2024/04/22</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>16 minute read</time></div></footer></div></header><section class=article-content><p>수백만 사용자를 지원하는 시스템을 설계하는 것은 도전적인 과제이며, 지속적인 계량과 끝없는 개선이 요구되는 여정이다.</p><p>이번 장은 한 명의 사용자를 지원하는 시스템에서 시작하여, 최종적으로 몇백만 사용자를 지원하는 시스템을 설계해본다.</p><h2 id=단일-서버>단일 서버</h2><p>모든 컴포넌트가 단 한대의 서버에서 실행되는 간단한 시스템부터 설계해보자.</p><p>웹 앱, 데이터베이스, 캐시 등이 전부 서버 한 대에서 실행된다.</p><p><img src=/post/system-design-interview/1/img.png width=615 height=390 srcset="/post/system-design-interview/1/img_hu499b8fa6fe43f3f924784d377eb4708e_41034_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_hu499b8fa6fe43f3f924784d377eb4708e_41034_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p><strong>사용자 요청 처리 흐름</strong><br><img src=/post/system-design-interview/1/img_1.png width=608 height=382 srcset="/post/system-design-interview/1/img_1_hua0cbd5db31f0ad82b45addc6a6db9692_42287_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_1_hua0cbd5db31f0ad82b45addc6a6db9692_42287_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=159 data-flex-basis=381px></p><ol><li>사용자는 도메인 이름(api.mysite.com)을 이용하여 웹사이트에 접속한다. 이 접속을 위해 DNS에 질의하여 IP 주소로 변환하는 과정을 치게 된다.<ul><li>DNS는 보통 서드 파티가 제공하는 유료 서비스를 이용하므로 시스템의 일부는 아니다.</li></ul></li><li>DNS 조회 결과로 IP 주소가 반환된다.</li><li>해당 IP 주소로 HTTP 요청이 전달된다.</li><li>요청을 받은 웹 서버는 HTML 페이지나 JSON 형태의 응답을 반환한다.</li></ol><p>실제 요청은 웹 앱과 모바일 앱 두가지 종류에 단말로 부터 온다.</p><ul><li>웹 애플리케이션<ul><li>비즈니스 로직, 데이터 저장 등을 처리하기 위해서 서버 구현용 언어(자바, 파이썬 등)를 사용한다.</li><li>프레젠테이션 용으로는 클라이언트 구현용 언어(HTML, 자바스크립트 등)를 사용한다.</li></ul></li><li>모바일 앱<ul><li>모바일 앱과 웹 서버 간 통신을 위해서는 HTTP 프로토콜을 이용한다.</li><li>반환될 응답 데이터의 포맷으로는 보통 JSON이 널리 쓰인다.</li></ul></li></ul><h2 id=데이터베이스>데이터베이스</h2><p>사용자가 늘면 서버 하나로는 충분하지 않아서 여러 서버를 두어야 한다.</p><ul><li>웹/모바일 트래픽 처리</li><li>데이터베이스</li></ul><p><img src=/post/system-design-interview/1/img_2.png width=612 height=377 srcset="/post/system-design-interview/1/img_2_hub3bdf37c2a22d7f06e833db20a5f8b0a_53786_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_2_hub3bdf37c2a22d7f06e833db20a5f8b0a_53786_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=162 data-flex-basis=389px></p><p>웹/모바일 트래픽 처리 서버(웹 계층)와 데이터베이스 서버(데이터 계층)를 분리하면 그 각각을 독립적으로 확장해 나갈 수 있게 된다.</p><h3 id=어떤-데이터베이스를-사용할-것인가>어떤 데이터베이스를 사용할 것인가?</h3><p>전통적인 관계형 데이터베이스와 비-관계형 데이터베이스 사이에서 고를 수 있다.</p><ul><li>관계형 데이터베이스<ul><li>관계형 데이터베이스 관리 시스템(RDBMS)이라고도 부르며, 자료를 테이블과 열, 컬럼으로 표현한다.</li><li>SQL을 사용하면 여러 테이블에 있는 데이터를 그 관계에 따라 조인(join)하여 합칠 수 있다.</li><li>ex) MySQL, Oracle, PostgreSQL 등</li></ul></li><li>비-관계형 데이터 베이스<ul><li>NoSQL이라고도 부른다.</li><li>키-값 저장소(key-value store), 그래프 저장소(graph store), 컬럼 저장소(column store), 문서 저장소(document store) 네 부류로 나뉜다.</li><li>비-관계형 데이터베이스는 일반적으로 조인 연산은 지원하지 않는다.</li><li>ex) CouchDB, Neo4j, Cassandra, HBase, Amazon DynamoDB 등</li></ul></li></ul><p>대부분의 개발자에게는 40년 이상 시장에서 살아남아 잘 사용되어온 관계형 데이터베이스가 최선이다.</p><p>하지만 구축하려는 시스템에 적합하지 않은 경우에는 관계형 데이터베이스 이외의 저장소도 살펴보아야한다.</p><ul><li>아주 낮은 응답 지연시간(latency)이 요구됨</li><li>다루는 데이터가 비정형(unstructured)이라 관계형 데이터가 아님</li><li>데이터(JSON, YAML, XML 등)를 직렬화하거나(serialize) 역직렬화(deserialize) 할 수 있기만 하면 됨</li><li>아주 많은 양의 데이터를 저장할 필요가 있음</li></ul><h2 id=수직적-규모-확장-vs-수평적-규모-확장>수직적 규모 확장 VS 수평적 규모 확장</h2><h3 id=수직적-규모-확장vertical-scaling>수직적 규모 확장(vertical scaling)</h3><p><strong>스케일 업(scale up)</strong> 이라고도 불리는 수직적 규모 확장 프로세스는 서버에 고사양 자원을 추가하는 행위를 말한다.</p><p><strong>장점</strong></p><ul><li>서버로 유입되는 트래픽의 양이 적을 때는 수직적 확장이 좋은 선택이다.</li><li>단순하다.</li></ul><p><strong>단점</strong></p><ul><li>한 대의 서버에 CPU나 메모리를 무한대로 증설할 방법이 없어 한계가 있다.</li><li>장애에 대한 자동복구(failover) 방안이나 다중화(redundancy) 방안을 제시하지 않는다.<ul><li>서버에 장애가 발생하면 완전히 중단된다.</li></ul></li></ul><h3 id=수평적-규모-확장horizontal-scaling>수평적 규모 확장(horizontal scaling)</h3><p><strong>스케일 아웃(scale out)</strong> 이라고도 불리는 수평적 규모 확장 프로세스는 더 많은 서버를 추가하여 성능을 개선하는 행위를 말한다.</p><p>수직적 규모 확장에서 언급된 단점으로 인해 대규모 애플리케이션을 지원하는 데는 수평적 규모 확장법이 보다 적절하다.</p><hr><p>수평적 규모 확장을 위해 추가적인 장치가 필요하다.</p><p>앞서 본 설계에서 사용자가 웹 서버로 바로 연결되는데,</p><ul><li>웹 서버가 다운되면 사용자는 웹 사이트에 접속할 수 없다.</li><li>너무 많은 사용자가 접속하여 웹 서버가 한계에 도달하면 응답 속도가 느려지거나 서버 접속이 불가능해질 수 있다.</li></ul><p>이런 문제를 해결하는 데는 부하 분산기 또는 로드밸런서를 도입하는 것이 최선이다.</p><h3 id=로드밸런서load-balancer>로드밸런서(Load balancer)</h3><p>로드밸런서는 부하 분산 집합(load balancing set)에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할을 한다.</p><p><img src=/post/system-design-interview/1/img_3.png width=608 height=540 srcset="/post/system-design-interview/1/img_3_huf74bbc3ffd6647fb098a2fc03966306f_85207_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_3_huf74bbc3ffd6647fb098a2fc03966306f_85207_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=112 data-flex-basis=270px></p><ul><li>사용자는 로드밸런서의 공개 IP 주소로 접속하므로, 웹 서버는 클라이언트의 접속을 직접 처리하지 않는다.</li><li>보안을 위해 서버 간 통신에는 사설 IP 주소가 이용된다.<ul><li>같은 네트워크에 속한 서버 사이의 통신에만 쓰일 수 있는 IP 주소로, 인터넷을 통해서 접속할 수 없다.</li></ul></li></ul><p>부하 분산 집합에 또 하나의 웹 서버를 추가하고 나면, 장애를 자동복구하지 못하는 문제(no failover)는 해소되며, 웹 계층의 가용성(availability)은 향상된다.</p><ul><li>서버 1이 다운되면 모든 트래픽은 서버 2로 전송된다.<ul><li>웹 사이트 전체가 다운되는 일이 방지된다.</li><li>부하를 나누기 위해 새로운 서버를 추가할 수도 있다.</li></ul></li><li>웹사이트로 유입되는 트래픽이 가파르게 증가할 경우 웹 서버 계층에 더 많은 서버를 추가하면 로드밸런스가 자동적으로 트래픽을 분산한다.</li></ul><h3 id=데이터베이스-다중화>데이터베이스 다중화</h3><p>많은 데이터베이스들이 주(master)-부(slave) 관계를 설정하여 데이터 원본은 주 서버에, 사본은 부 서버에 저장하는 방식으로 다중화를 지원한다.</p><p>쓰기 연산은 마스터에만 지원하며, 부 데이터베이스는 주 데이터베이스로부터 그 사본을 전달받아 읽기 연산만을 지원한다.</p><ul><li>데이터베이스를 변경하는 명령어(<code>INSERT</code>, <code>DELETE</code>, <code>UPDATE</code> 등)는 주 데이터베이스로만 전달되어야 한다.</li></ul><p><img src=/post/system-design-interview/1/img_4.png width=612 height=546 srcset="/post/system-design-interview/1/img_4_hu75d2f6312382855c75a554918b468d43_102326_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_4_hu75d2f6312382855c75a554918b468d43_102326_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=112 data-flex-basis=269px></p><p>데이터베이스르 다중화하면 다음과 같은 이득이 있다.</p><ul><li>더 나은 성능<ul><li>모든 데이터 변경 연산은 주 데이터베이스 서버로만 전달되는 반면 읽기 연산은 부 데이터베이스 서버들로 분산되어 병렬로 처리될 수 있는 질의(query)가 늘어나므로, 성능이 좋아진다.</li></ul></li><li>안정성<ul><li>자연 재해 등의 이유로 데이터베이스 서버 가운데 일부가 파괴되어도 데이터는 보존된다.</li></ul></li><li>가용성<ul><li>데이터를 여러 지역에 복제해 둠으로써, 하나의 데이터베이스 서버에 장애가 발생하더라도 다른 서버에 있는 데이터로 계속 서비스할 수 있다.</li></ul></li></ul><p>위와 같은 데이터계층을 구성하면 데이터베이스 서버 가운데 하나가 다운되더라도 아래와 같은 상황을 감당할 수 있다.</p><ul><li>부 서버 한대뿐인데 다운된 경우<ul><li>읽기 연산이 한시적으로 주 데이터베이스로 전달된다.</li><li>즉시 새로운 부 데이터베이스 서버가 장애 서버를 대처한다.</li></ul></li><li>부 서버 중 한대가 다운된 경우<ul><li>일기 연산이 나머지 부 데이터베이스 서버로 분산된다.</li><li>새로운 부 데이터베이스 서버가 장애 서버를 대체한다.</li></ul></li><li>주 데이터베이스 서버가 다운된 경우<ul><li>부 데이터베이스 서버 중 하나가 새로운 주 서버가 된다.</li></ul></li></ul><h3 id=다중화를-고려한-설계>다중화를 고려한 설계</h3><p>아래는 로드밸런서와 데이터베이스 다중화를 고려한 설계안이다.</p><p><img src=/post/system-design-interview/1/img_5.png width=615 height=680 srcset="/post/system-design-interview/1/img_5_hu0d3cc45b151b2f2d78ede4b0a35c84d1_160088_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_5_hu0d3cc45b151b2f2d78ede4b0a35c84d1_160088_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=90 data-flex-basis=217px></p><ol><li>사용자는 DNS로부터 로드밸런서의 공개 IP 주소를 받는다.</li><li>사용자는 해당 IP 주소를 사용해 로드밸런서에 접속한다.</li><li>HTTP 요청은 서버 1이나 서버 2로 전달된다.</li><li>웹 서버는 사용자의 데이터를 부 데이터베이스 서버에서 읽는다.</li><li>웹 서버는 데이터 변경 연산은 주 데이터베이스로 전달한다.</li></ol><h2 id=캐시-cache>캐시 Cache</h2><p>캐시를 붙여 응답 시간(latency)를 개선해볼 수 있다.</p><p>캐시는 <strong>값비싼 연산 결과</strong> 또는 <strong>자주 참조되는 데이터</strong>를 메모리 안에 두고, 뒤이은 요청이 보다 빨리 처리될 수 있도록 하는 저장소이다.</p><p>애플리케이션의 성능은 데이터베이스를 얼마나 자주 호출하느냐에 크게 좌우되는데, 캐시는 그런 문제를 완화할 수 있다.</p><h3 id=캐시-계층>캐시 계층</h3><p>캐시 계층(cache tier)은 데이터가 잠시 보관되는 곳으로 데이터베이스보다 훨씬 빠르다.</p><ul><li>데이터베이스보다 훨씬 빠르므로 성능이 개선된다.</li><li>요청 분산으로 데이터베이스의 부하를 줄일 수 있다.</li><li>캐시 계층의 규모를 독립적으로 확장시키는 것도 가능해진다.</li></ul><p><img src=/post/system-design-interview/1/img_6.png width=613 height=116 srcset="/post/system-design-interview/1/img_6_huc62d7a17723bf3e18e1d3339b357022d_33317_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_6_huc62d7a17723bf3e18e1d3339b357022d_33317_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=528 data-flex-basis=1268px></p><p>요청받은 웹 서버는 캐시에 응답이 저장되어 있는지를 확인 후 저장되어 있다면 해당 데이터 반환하고 없을 경우 데이터베이스 조회하여 결과를 반환하는데, 이러한 캐시 전략을 <strong>읽기 주도형 캐시 전략(read-through caching strategy)</strong> 이라고 부른다.</p><p>이외에도 다양한 캐시 전략이 있으며, 캐시할 데이터 종류, 크기, 액세스 패턴에 맞는 캐시 전략을 선택하면 된다.</p><ul><li>쓰기 주도형 캐시 전략 (Write-Through Cache)<ul><li>데이터를 업데이트할 때 캐시와 백엔드 데이터 소스 모두에 동시에 업데이트</li><li>데이터 일관성을 유지하면서 쓰기 작업을 처리</li><li>쓰기 작업의 경우 백엔드 저장소로의 추가적인 I/O 작업이 필요하므로 성능 저하의 가능성이 있지만, 데이터 일관성을 보장</li></ul></li><li>쓰기 지연형 캐시 전략 (Write-Behind Cache)<ul><li>데이터 업데이트를 먼저 캐시에만 적용하고, 나중에 백엔드 데이터 소스에 업데이트를 적용</li><li>이는 쓰기 작업의 지연을 최소화하여 응답 시간을 줄이는 데 도움</li><li>쓰기 지연형 캐시는 데이터 일관성을 유지하기 위해 추가적인 메커니즘을 필요</li></ul></li><li>자세한 내용의 캐시 전략 (Write-Through and Read-Through Cache):<ul><li>읽기와 쓰기 모두에 대해 캐시를 사용하는 전략</li><li>데이터가 요청될 때마다 읽기 주도형 캐시와 유사하게 작동하며, 데이터가 업데이트될 때마다 쓰기 주도형 캐시와 유사한 방식으로 작동</li></ul></li><li>캐시 앞 단의 캐시 전략 (Cache-Aside Cache):<ul><li>클라이언트가 데이터를 직접 캐시에 저장하고 검색하는 방식</li><li>캐시에 데이터가 없는 경우 클라이언트는 백엔드 데이터 소스에서 직접 데이터를 가져와서 캐시에 저장하고 응답</li><li>이 방식은 간단하고 유연하며, 응용 프로그램 코드 내에 캐시 로직을 명시적으로 구현할 수 있음</li></ul></li><li>이중 캐시 전략 (Two-Level Cache):<ul><li>두 개의 캐시 레이어를 사용하여 성능을 최적화</li><li>보통 두 개의 캐시는 크기와 접근 속도 등에서 차이가 있음</li><li>먼저 작은 고속 캐시가 데이터를 저장하고, 그 다음에 큰 용량의 캐시가 데이터를 보관</li></ul></li><li>오프힙 로컬 캐시 전략 (Off-Heap Local Cache Strategy):<ul><li>캐시를 메모리 외의 오프힙(Off-Heap) 영역에 저장하여 자바 가상 머신의 힙 메모리 한계를 초과하는 데이터 양을 처리할 수 있게 함</li><li>이는 대규모 캐시나 대용량 데이터를 다룰 때 유용</li></ul></li></ul><h3 id=캐시-사용-시-유의할-점>캐시 사용 시 유의할 점</h3><ul><li>데이터 갱신은 자주 일어나지 않지만 참조는 빈번하게 일어나는 경우 고려할 수 있다.</li><li>캐시는 데이터를 휘발성 메모리에 두므로, 영속적으로 보관할 데이터를 캐시에 두는 것은 바람직하지 않다.</li><li>데이터를 무기한 보존할 수 없으므로 만료에 대한 정책을 마련해야한다.<ul><li>너무 짧으면 데이터베이스 읽기가 자주 발생한다.</li><li>너무 길면 원본과 차이 날 가능성이 높아진다.</li></ul></li><li>원본을 갱신하는 연산과 캐시를 갱신하는 연산이 단일 트랜잭션으로 처리되지 않는 경우 일관성이 깨질 수 있다.</li><li>캐시 서버를 한 대만 두는 경우 해당 서버가 단일 장애 지점(Single Point of Failure, SPOF)이 되어버릴 가능성이 있다.<ul><li>여러 지역에 걸처 캐시 서버를 분산시켜야 한다.</li></ul></li><li>캐시 메모리가 너무 작으면 액세스 패턴에 따라 데이터가 자주 캐시에서 밀려나 성능이 떨어지게 된다.<ul><li>캐시 메모리를 과할당하면 데이터가 갑자기 늘어났을 때 생길 문제를 방지할 수 있다.</li></ul></li><li>캐시가 가득 찼을 때 추가로 데이터를 넣기 위한 데이터 방출 정책을 적절히 지정해야한다.<ul><li>가장 널리 쓰이는 것은 LRU(least Recently Used - 가장 오래 사용 안된 데이터)나 FIFO(가장 먼저 들어온) 등이 있으며 경우에 맞게 적용한다.</li></ul></li></ul><h2 id=콘텐츠-전송-네트워크-cdn>콘텐츠 전송 네트워크 CDN</h2><p>응답 시간을 개선할 방법으로 CDN(Content Delivery Network)를 적용해 볼 수 있다.</p><p>CDN은 정적 콘텐츠를 전성하는 데 쓰이는, 지리적으로 분산된 서버의 네트워크이다. (이미지, 비디오, CSS, JS 파일 등)</p><ul><li>요청 경로, 질의 문자열, 쿠키, 요청 헤더 등의 정보에 기반하여 HTML을 캐싱하는 <strong>동적 콘텐츠 캐싱</strong>도 적용해 볼 수 있다.</li></ul><p><img src=/post/system-design-interview/1/img_7.png width=605 height=231 srcset="/post/system-design-interview/1/img_7_hu799239a592ed42b7290231250760d8ad_30988_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_7_hu799239a592ed42b7290231250760d8ad_30988_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=261 data-flex-basis=628px></p><p>어떤 사용자 웹 사이트를 방문하면, 사용자에게 가장 가까운 CDN 서버가 정적 콘텐츠를 전달하며, 사용자가 CDN 서버로부터 멀어질 수록 천천히 로드될 것이다.</p><p><img src=/post/system-design-interview/1/img_8.png width=612 height=218 srcset="/post/system-design-interview/1/img_8_hu5d5fc61be434c460205659abbfd7acf0_63071_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_8_hu5d5fc61be434c460205659abbfd7acf0_63071_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=280 data-flex-basis=673px></p><ol><li>사용자 A가 이미지 URL을 이용해 <code>image.png</code>에 접근한다.(URL의 도메인은 CDN 서비스 사업자가 제공한다.)</li><li>CDN 서버의 캐시에 해당 이미지가 없는 경우 원본 서버에서 요청하여 파일을 가져온다.</li><li>원본 서버가 파일을 CDN 서버에 반환한다.<ul><li>응답 HTTP 헤더에 TTL(Time-To-Live) 값을 넣어 보낸다.</li></ul></li><li>CDN 서버는 파일을 캐시하고 사용자 A에게 반환한다.<ul><li>이미지는 TTL에 명신된 시간이 끝날 때 까지만 캐시된다.</li></ul></li><li>사용자 B가 같은 이미지를 CDN 서버에게 요청한다.</li><li>만료되지 않은 이미지에 대한 요청은 캐시를 통해 처리된다.</li></ol><h3 id=cdn-사용-시-고려해야-할-사항>CDN 사용 시 고려해야 할 사항</h3><ul><li>비용<ul><li>CDN은 보통 서드파티에 의해 운영되며, CDN으로 들어가고 나가는 데이터 전송 양에 따라 요금을 낸다.</li><li>자주 사용되지 않는 콘텐츠를 캐싱하는 것은 이득이 적으므로, CDN에서 빼는 것을 고려할 수 있다.</li></ul></li><li>적절한 만료 시한 설정<ul><li>시의성이 중요한(time-sensitive) 콘텐츠는 만료 시점을 잘 정해야한다.</li><li>너무 길면 콘텐츠의 신선도가 떨어진다.</li><li>너무 짧으면 원본 서버에 빈번히 접속되어 좋지 않다.</li></ul></li><li>CDN 장애 대처 방안<ul><li>CDN 자체가 죽었을 경우 애플리케이션이 어떻게 동작해야 하는지 고려해야 한다.</li><li>응답을 감지하여 원본 서버에서 가져오는 등의 방식으로 처리한다.</li></ul></li><li>콘텐츠 무효화 방법<ul><li>만료되지 않은 콘텐츠라도 CDN에서 제거할 수 있다.</li><li>CDN 서비스 사업자가 제공하는 API 활용</li><li>콘텐츠의 다른 버전을 서비스 하도록 오브젝트 버저닝 이용.<ul><li><code>image.png?v=2</code></li></ul></li></ul></li></ul><h3 id=cdn과-캐시가-추가된-설계>CDN과 캐시가 추가된 설계</h3><p><img src=/post/system-design-interview/1/img_9.png width=625 height=670 srcset="/post/system-design-interview/1/img_9_hu460b71978870d67db3c5f1597124e471_170383_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_9_hu460b71978870d67db3c5f1597124e471_170383_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=93 data-flex-basis=223px></p><ol><li>정적 콘텐츠를 CDN을 통해 제공하여 더 나은 성능을 보장한다.</li><li>캐시가 데이터베이스 부하를 줄여준다.</li></ol><h2 id=무상태stateless-웹-계층>무상태(Stateless) 웹 계층</h2><p>웹 계층을 수평적으로 확장하는 방법을 고민해 볼 수 있다.</p><p>이를 위해 상태 정보(사용자 세션 등)를 웹 계층에서 제거해야한다.</p><p>바람직한 전략은 상태 정보를 관계형 데이터베이스나 NoSQL 같은 지속성 저장소에 보관하고, 필요할 때 가져오도록 하는 것이다.</p><p>이렇게 구성된 웹 계층을 <strong>무상태 웹 계층</strong>이라 부른다.</p><h3 id=상태-정보-의존적인-아키텍처>상태 정보 의존적인 아키텍처</h3><p>상태 정보를 보고나하는 서버는 클라이언트 정보, 즉 상태를 유지하여 요청들 사이에 공유되도록 하지만, 무상태 서버에는 이러한 장치가 없다.</p><p><img src=/post/system-design-interview/1/img_10.png width=624 height=387 srcset="/post/system-design-interview/1/img_10_hu5fb9397f4d4b70e8494c0677a4642dc6_65604_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_10_hu5fb9397f4d4b70e8494c0677a4642dc6_65604_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=161 data-flex-basis=386px></p><p>위와 같은 경우 같은 클라이언트로부터의 요청은 항상 같은 서버로 전송되어야 한다.</p><p>로드밸런서가 이를 지원하기 위해 고정 세션이라는 기능을 제공하지만, 이는 로드밸런서에 부담을 줄 수 있다.</p><p>또한 로드 밸런서 뒷단에 서버를 추가하거나 제거하기도 까다로워지며, 이들 서버의 장애를 처리하기도 복잡해진다.</p><h3 id=무상태-아키텍처>무상태 아키텍처</h3><p><img src=/post/system-design-interview/1/img_11.png width=601 height=582 srcset="/post/system-design-interview/1/img_11_hu39f308bbb91eb0dc2a5c19d7114ea62c_76175_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_11_hu39f308bbb91eb0dc2a5c19d7114ea62c_76175_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=103 data-flex-basis=247px></p><p>무상태 아키텍처는 사용자로부터의 HTTP 요청은 어떤 웹 서버로도 전달될 수 있다.</p><p>웹 서버는 상태 정보가 필요할 경우 물리적으로 분리된 공유 저장소로부터 데이터를 가져온다.</p><h3 id=무상태-웹-계층을-갖는-설계>무상태 웹 계층을 갖는 설계</h3><p><img src=/post/system-design-interview/1/img_12.png width=592 height=593 srcset="/post/system-design-interview/1/img_12_hu8a96a4f1289cdc64fec7a7b4b0f65b88_150815_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_12_hu8a96a4f1289cdc64fec7a7b4b0f65b88_150815_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=99 data-flex-basis=239px></p><ul><li>세션 데이터를 웹 계층에서 분리하고 지속성 데이터 보관소에 저장하도록 만들었다.<ul><li>공유 저장소는 관계형 데이터베이스일 수도 있고, 캐시일 수도 있으며, NoSQL일 수도 있다.</li></ul></li><li>상태 정보가 웹 서버들로부터 제거되었으므로 자동으로 규모를 확장할 수 있다.</li></ul><h2 id=데이터-센터>데이터 센터</h2><p>애플리케이션의 사용자가 매우 많다면 가용성을 높이고 쾌적하게 사용할 수 있도록 하기 위해 여러 데이터 센터를 지원하는 것이 필수적이다.</p><p><img src=/post/system-design-interview/1/img_13.png width=605 height=612 srcset="/post/system-design-interview/1/img_13_huacec91b27a2e95c1fae44550dc9946c4_231088_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_13_huacec91b27a2e95c1fae44550dc9946c4_231088_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=98 data-flex-basis=237px></p><p><strong>지리적 라우팅</strong></p><p>장애가 없는 상황에서 사용자는 가장 가까운 데이터 센터로 안내되는데 이 절차를 지리적 라우팅(geoDNS-routing 또는 geo-routing)이라고 부른다.</p><p>geoDNS는 사용자의 위치에 따라 도메인 이름을 어떤 IP 주소로 변활할지 결정할 수 있도록 해주는 DNS 서비스다.</p><p><strong>데이터 센터 장애</strong></p><p>데이터 센터 중 하나에 심각한 장애가 발생하면 모든 트래픽은 장애가 없는 데이터 센터로 전송된다.</p><p><img src=/post/system-design-interview/1/img_14.png width=598 height=619 srcset="/post/system-design-interview/1/img_14_huae6b76823045f17d81dcfd1753a37701_207085_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_14_huae6b76823045f17d81dcfd1753a37701_207085_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=96 data-flex-basis=231px></p><p>이에 따라 다중 데이터센터 아키텍처를 만들려면 몇 가지 기술적 난제를 해결해야 한다.</p><ul><li>트래픽 우회<ul><li>올바른 데이터센터로 트래픽을 보내는 효과적인 방법을 찾아야한다.</li></ul></li><li>데이터 동기화(Synchronization)<ul><li>데이터를 여러 데이터센터에 걸쳐 다중화 하여, 장애 복구 시에도 데이터를 동기화 할 수 있도록 한다.</li></ul></li><li>테스트와 배포<ul><li>여러 데이터 센터를 사용하도록 시스템이 구성된 상황이라면 웹 사이트 또는 애플리케이션을 여러 위치에서 테스트 해보는 것이 중요하다.</li><li>자동화된 배포 도구는 모든 데이터 센터에 동일한 서비스가 설치되도록 하는 데 중요한 일을 한다.</li></ul></li></ul><h2 id=메시지-큐message-queue>메시지 큐(Message Queue)</h2><p>시스템을 더 큰 규모로 확장하기 위해서는 시스템의 컴포넌트를 분리하여, 각기 독립적으로 확장될 수 있어야 한다.</p><p>메시지 큐는 분산 시스템이 이 문제를 풀기 위해 채용하고 있는 핵심 전략 가운데 하나다.</p><p><img src=/post/system-design-interview/1/img_15.png width=606 height=141 srcset="/post/system-design-interview/1/img_15_huc34a000f73eb7366f54fab25c10cd600_37954_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_15_huc34a000f73eb7366f54fab25c10cd600_37954_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=429 data-flex-basis=1031px></p><p>메시지 큐는 메시지의 무손실을 보장하는 비동기 통신을 지원하는 컴포넌트로 메시지의 버퍼 역할을 하며, 비동기적으로 전송한다.</p><ol><li>생산자 또는 발행자라고 불리는 입력 서비스가 메시지를 만들어 메시지 큐에 발행한다.</li><li>소비자 혹은 구독자라 불리는 서비스 혹은 서버가 메시지를 받아 그에 맞는 동작을 수행한다.</li></ol><hr><p>메시지 큐를 이용하면 서비스 또는 서버 간 결합이 느슨해져서, 규모 확장성이 보장되어야 하는 안정적 애플리케이션을 구성하기 좋다.</p><ul><li>생산자는 소비자 프로세스가 다운되어 있어도 메시지를 발행할 수 있다.</li><li>소비자는 생산자 서비스가 가용한 상태가 아니더라도 메시지를 수신할 수 있다.</li></ul><p>큐가 커지면 더 많은 작업 프로세스를 추가해야 처리 시간을 줄일 수 있으며, 큐가 거의 항상 비어있는 상태라면, 작업 프로세스의 수를 줄일 수 있다.</p><h2 id=로그-메트릭-그리고-자동화>로그, 메트릭 그리고 자동화</h2><p>웹 사이트와 함께 사업 규모가 커지고 나면, 로그나 메트릭, 자동화 같은 도구에 필수적으로 투자해야한다.</p><ul><li>로그<ul><li>시스템의 오류와 문제들을 쉽게 찾아낼 수 있게 돕는다.</li><li>로그를 단일 서비스로 모아주는 도구를 활용하면 더 편리하게 검색하고 조회할 수 있다.</li></ul></li><li>메트릭<ul><li>사업 현황에 관한 유용한 정보를 얻을 수도 있고, 시스템의 현재 상태를 쉽게 파악할 수 있다.</li><li>호스트 단위 메트릭: CPU, 메모리, 디스크 I/O,에 관한 메트릭</li><li>종합 메트릭: 데이터베이스 계층의 성능, 캐시 계층의 성능 등</li><li>핵심 비즈니스 메트릭: 일별 능동 사용자, 수익, 재방문 등</li></ul></li><li>자동화<ul><li>시스템이 크고 복잡해지면 생산성을 높이기 위해 자동화 도구를 활용해야한다.</li><li>지속적 통합을 활용한 검증 절차 수행 및 빌드, 테스트, 배포 절차 자동화 등</li></ul></li></ul><h3 id=수정한-설계안>수정한 설계안</h3><p><img src=/post/system-design-interview/1/img_16.png width=595 height=741 srcset="/post/system-design-interview/1/img_16_hu91dcf9847683962bf50eb168546423cd_177817_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_16_hu91dcf9847683962bf50eb168546423cd_177817_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=80 data-flex-basis=192px></p><ul><li>메시지 큐는 각 컴포넌트가 보다 느슨히 결합될 수 있도록 하고, 결함에 대한 내성을 높인다.</li><li>로그, 모니터링, 메트릭, 자동화 등을 지원하기 위한 장치를 추가한다.</li></ul><h2 id=데이터베이스-규모-확장>데이터베이스 규모 확장</h2><p>저장할 데이터가 많아지면 데이터베이스에 대한 부하도 증가한다.</p><p>데이터베이스의 규모를 확장하는데는 앞서 언급했던 수직적 규모 확장과 수평적 규모 확장을 고려할 수 있다.</p><p><strong>수평적 확장</strong></p><p>기존 서버에 더 많은, 고성능의 자원을 증설하는 방법이다.</p><p>스택오버플로는 천만 명의 사용자 전부를 단 한 대의 마스터 데이터베이스로 처리했다.</p><p>하지만 언급했던대로 몇가지 심각한 약점이 있다.</p><ul><li>무한 증설할 수는 없다.</li><li>SPOF로 인한 위험성이 크다.</li><li>비용이 많이 든다.</li></ul><p><strong>수평적 확장</strong></p><p>데이터베이스의 수평적 확장은 샤딩(sharding)이라고도 부르는데, 더 많은 서버를 추가함으로써 성능을 향상시킬 수 있도록 한다.</p><h3 id=샤딩>샤딩</h3><ul><li>대규모 데이터베이스를 샤드(shard)라고 부르는 작은 단위로 분할하는 기술을 일컫는다.</li><li>모든 샤드는 같은 스키마를 쓰지만 보관되는 데이터 사이에는 중복이 없다.</li></ul><p><img src=/post/system-design-interview/1/img_17.png width=369 height=266 srcset="/post/system-design-interview/1/img_17_huc997d539c0fa3f28c4bae7dad9a2068b_33539_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_17_huc997d539c0fa3f28c4bae7dad9a2068b_33539_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=138 data-flex-basis=332px></p><p>위의 예시에서 <code>user_id % 4</code>를 해시 함수로 사용하여 데이터가 보관되는 샤드를 정한다.</p><p>이처럼 샤딩 전략을 구현할 때 고려해야 할 가장 중요한 것은 <strong>샤딩 키</strong>를 어떻게 정하냐 하는 것이다.</p><ul><li>샤딩 키(파티션 키)는 데이터가 어떻게 분살될지 정하는 하나 이상의 컬럼으로 구성된다.</li><li>샤딩 키를 통해 올바른 데이터베이스에 질의를 보내어 데이터 조회나 변경을 처리하므로 효율을 높일 수 있다.</li></ul><p>샤딩 키를 정할 때는 데이터를 고르게 분할 할 수 있도록 하는 게 가장 중요하다.</p><p><strong>주의사항</strong></p><p>샤딩은 데이터베이스 규모 확장을 실현하는 휼륭한 기술이지만 완벽하지 않으며, 도입하면 시스템이 복잡해지고 풀어야 할 새로운 문제도 생긴다.</p><ul><li>데이터의 재 샤딩<ul><li>데이터가 너무 많아져서 하나의 샤드로는 더 이상 감당하기 어려울 때</li><li>샤드 소진: 샤드 간 데이터 분포가 균등하지 못하여 어떤 샤드에 할당된 공간 소모가 다른 사드에 비해 빨리 진행될 때</li><li>이러한 형상이 발생하면 샤드 키를 계산하는 함수를 변경하고 데이터를 재배치 하여야 한다.</li></ul></li><li>유명인사 문제(핫스팟 키 문제)<ul><li>특정 샤드에 질의가 집중되어 서버에 과부하가 걸리는 문제다.</li><li>특정 샤드의 원인에 대해 샤드를 하나씩 할당해야 할 수도 있고, 더 잘개 쪼개야 할 수도 있다.</li></ul></li><li>조인과 비정규화<ul><li>데이터베이스를 여러 샤드 서버로 쪼개고 나면, 여러 샤드에 걸친 데이터를 조인하기가 힘들어진다.</li><li>데이터베이스를 비정규화하여 하나의 테이블에서 질의가 수행될 수 있도록 하는 것이다.</li></ul></li></ul><h3 id=샤드를-적용한-아키텍처>샤드를 적용한 아키텍처</h3><p><img src=/post/system-design-interview/1/img_18.png width=643 height=800 srcset="/post/system-design-interview/1/img_18_hu3cfaabe2145c01222e45ae94975b52ee_217530_480x0_resize_box_3.png 480w, /post/system-design-interview/1/img_18_hu3cfaabe2145c01222e45ae94975b52ee_217530_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=80 data-flex-basis=192px></p><ul><li>데이터베이스에 대한 부하를 줄이기 위해 굳이 관계형 데이터베이스가 요구되지 않는 기능들은 NoSQL로 이전할 수 있다.</li></ul><h2 id=백만-사용자-그리고-그-이상>백만 사용자, 그리고 그 이상</h2><p>시스템의 규모를 확장하는 것은 지속적이고 반복적인 과정이며, 이번 장에서 다룬 내용을 반복하다 보면 원하는 규모의 시스템을 달성할 수 있게 된다.</p><p>그러나 수백만 사용자 이상을 지원하려면 새로운 전략을 도입해야 하고 지속적으로 시스템을 가다듬어야 할 것이다.</p><ul><li>시스템 최적화 및 마이크로서비스 등</li></ul><h2 id=정리>정리</h2><ul><li>웹 계층은 무상태 계층으로</li><li>모든 계층에 다중화 도입</li><li>가능한 한 많은 데이터를 캐시할 것</li><li>여러 데이터 센터를 지원할 것</li><li>정적 콘텐츠는 CDN을 통해 서비스할 것</li><li>데이터 계층은 샤딩을 통해 그 규모를 확장할 것</li><li>각 계층은 독립적 서비스로 분할할 것</li><li>시스템을 지속적으로 모니터링하고, 자동화 도구들을 활용할 것</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/%EA%B0%80%EC%83%81-%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84-%EA%B8%B0%EC%B4%88/>가상 면접 사례로 배우는 대규모 시스템 설계 기초</a>
<a href=/tags/system-design-interview/>System Design Interview</a>
<a href=/tags/%EB%8B%A8%EC%9D%BC-%EC%84%9C%EB%B2%84/>단일 서버</a>
<a href=/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/>데이터베이스</a>
<a href=/tags/%EC%88%98%EC%A7%81%EC%A0%81-%EA%B7%9C%EB%AA%A8-%ED%99%95%EC%9E%A5/>수직적 규모 확장</a>
<a href=/tags/vertical-scaling/>Vertical Scaling</a>
<a href=/tags/%EC%88%98%ED%8F%89%EC%A0%81-%EA%B7%9C%EB%AA%A8-%ED%99%95%EC%9E%A5/>수평적 규모 확장</a>
<a href=/tags/horizontal-scaling/>Horizontal Scaling</a>
<a href=/tags/%EC%BD%98%ED%85%90%EC%B8%A0-%EC%A0%84%EC%86%A1-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/>콘텐츠 전송 네트워크</a>
<a href=/tags/cdn/>CDN</a>
<a href=/tags/%EB%AC%B4%EC%83%81%ED%83%9C-%EC%9B%B9-%EA%B3%84%EC%B8%B5/>무상태 웹 계층</a>
<a href=/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%84%BC%ED%84%B0/>데이터 센터</a>
<a href=/tags/%EB%A9%94%EC%8B%9C%EC%A7%80-%ED%81%90/>메시지 큐</a>
<a href=/tags/%EB%A1%9C%EA%B7%B8/>로그</a>
<a href=/tags/%EB%A9%94%ED%8A%B8%EB%A6%AD/>메트릭</a>
<a href=/tags/%EC%9E%90%EB%8F%99%ED%99%94/>자동화</a>
<a href=/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EA%B7%9C%EB%AA%A8-%ED%99%95%EC%9E%A5/>데이터베이스 규모 확장</a>
<a href=/tags/%EB%B0%B1%EB%A7%8C-%EC%82%AC%EC%9A%A9%EC%9E%90/>백만 사용자</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class="article-list--compact links"><article><a href=https://product.kyobobook.co.kr/detail/S000001033116 target=_blank rel=noopener><div class=article-details><h2 class=article-title>가상 면접 사례로 배우는 대규모 시스템 설계 기초</h2><footer class=article-time>교보문고</footer></div></a></article></div><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/system-design-interview/11/><div class=article-image><img src=/post/system-design-interview/11/cover.19a01050cbb7e15d6051c06331fb6a04_huebcf5dd667df9af228f80687035dfdfb_164704_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 11. 뉴스 피드 시스템 설계" data-key=system-design-interview/11 data-hash="md5-GaAQUMu34V1gUcBjMftqBA=="></div><div class=article-details><h2 class=article-title>11. 뉴스 피드 시스템 설계</h2></div></a></article><article class=has-image><a href=/post/system-design-interview-2/4/><div class=article-image><img src=/post/system-design-interview-2/4/cover.eb0176bd1597a4b4423be0cc9ee612d7_huf565d8fe7a4f9f5a961306624616abfc_449360_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 4. 분산 메시지 큐" data-key=system-design-interview-2/4 data-hash="md5-6wF2vRWXpLRCO+DMnuYS1w=="></div><div class=article-details><h2 class=article-title>4. 분산 메시지 큐</h2></div></a></article><article class=has-image><a href=/post/system-design-interview-2/3/><div class=article-image><img src=/post/system-design-interview-2/3/cover.eb0176bd1597a4b4423be0cc9ee612d7_huf565d8fe7a4f9f5a961306624616abfc_449360_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 3. 구글 맵" data-key=system-design-interview-2/3 data-hash="md5-6wF2vRWXpLRCO+DMnuYS1w=="></div><div class=article-details><h2 class=article-title>3. 구글 맵</h2></div></a></article><article class=has-image><a href=/post/system-design-interview/5/><div class=article-image><img src=/post/system-design-interview/5/cover.19a01050cbb7e15d6051c06331fb6a04_huebcf5dd667df9af228f80687035dfdfb_164704_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 5. 안정 해시 설계" data-key=system-design-interview/5 data-hash="md5-GaAQUMu34V1gUcBjMftqBA=="></div><div class=article-details><h2 class=article-title>5. 안정 해시 설계</h2></div></a></article><article class=has-image><a href=/post/system-design-interview-2/13/><div class=article-image><img src=/post/system-design-interview-2/13/cover.eb0176bd1597a4b4423be0cc9ee612d7_huf565d8fe7a4f9f5a961306624616abfc_449360_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 13. 증권 거래소" data-key=system-design-interview-2/13 data-hash="md5-6wF2vRWXpLRCO+DMnuYS1w=="></div><div class=article-details><h2 class=article-title>13. 증권 거래소</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=codemario318/codemario318.github.io issue-term=pathname label=Comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Mario Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>